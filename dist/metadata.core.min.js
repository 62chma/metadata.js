(function(e,t,n,r,i){var s={},o=function(t){return e.Function("return "+t)()},u=e.document,a,f=function(t,i){var o={exports:{}};s[t]=1,n[t]=o.exports;if(!i)i=c(1,t,i)[1]||e[t];else if(typeof i=="function"){var u=p;r[t]&&r[t].sandbox&&typeof u=="function"&&(u=a),i=i(u,o.exports,o)||o.exports}return i=i,n[t]=i},l={},c=function(e,t,n,r){var i=l[e],s;if(i)for(var o=0,u=i.length;o<u;o++)s=i[o](t,n,r)||s,s&&(t=s[0]||t,n=s[1]||n,r=s[2]||r);return s||[t,n,r]},h=function(e,t){l[e]||(l[e]=[]),l[e].push(t)},p=function(e){var t=n[e],r=[e,t];return r&&(e=r[0],t=r[1]),s[e]&&t?t:(typeof t=="string"&&t.indexOf("(function(")===0&&(t=o(t)),f(e,t))},d={exports:{}};for(var v in n)s[v]=0;(function(){h(1,function(t,r){try{return r=n[t]=(e.importScripts||require)(t)||{},[t,r]}catch(i){return[t,r]}})})(),function(){}(),t(p,d.exports,d)})(this,function(require,exports,module){function MetaEngine(){this.version="0.9.201",this.toString=function(){return"Oknosoft data engine. v:"+this.version}}function Messages(){this.toString=function(){return"Интернационализация сообщений"},typeof window!="undefined"&&"dhtmlx"in window&&(this.show_msg=function(e,t){if(!e)return;if(typeof e=="string"){if($p.iface.synctxt){$p.iface.synctxt.show_message(e);return}e={type:"info",text:e}}t&&typeof t.setText=="function"&&t.setText(e.text),dhtmlx.message(e)},this.check_soap_result=function(e){if(!e)return $p.msg.show_msg({type:"alert-error",text:$p.msg.empty_response,title:$p.msg.error_critical}),!0;if(e.error=="limit_query")return $p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.limit_query.replace("%1",e.queries).replace("%2",e.queries_avalable),title:$p.msg.srv_overload}),!0;if(e.error=="network"||e.error=="empty")return $p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.error_network,title:$p.msg.error_critical}),!0;if(e.error&&e.error_description)return $p.iface.docs.progressOff(),e.error_description.indexOf("Недостаточно прав")!=-1&&(e.error_type="alert-warning",e.error_title=$p.msg.error_rights),$p.msg.show_msg({type:e.error_type||"alert-error",text:e.error_description,title:e.error_title||$p.msg.error_critical}),!0;if(e.error&&!e.messages)return $p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-error",title:$p.msg.error_critical,text:$p.msg.unknown_error.replace("%1","unknown_error")}),!0},this.show_not_implemented=function(){$p.msg.show_msg({type:"alert-warning",text:$p.msg.not_implemented,title:$p.msg.main_title})})}function InterfaceObjs(){this.toString=function(){return"Объекты интерфейса пользователя"},this.clear_svgs=function(e){typeof e=="string"&&(e=document.getElementById(e));while(e.firstChild)e.removeChild(e.firstChild)},this.get_offset=function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},this.normalize_xml=function(e){if(!e)return"";var t={"&":"&amp;",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;"};return e.replace(/[&"'<>]/g,function(e){return t[e]})},this.scale_svg=function(e,t,n){var r,i,s,o,u,a,f,l,c,h={};u=e.indexOf(">"),f=e.substring(5,u),s=f.split(" "),o=e.substr(u+1),o=o.substr(0,o.length-6);for(r in s){e=s[r].split("=");if(e[0]=="width"||e[0]=="height")e[1]=Number(e[1].replace(/"/g,"")),h[e[0]]=e[1]}return(a=f.indexOf("viewBox="))!=-1?(l=f.substring(a+9),c='viewBox="'+l.substring(0,l.indexOf('"'))+'"'):c='viewBox="0 0 '+(h.width-n)+" "+(h.height-n)+'"',i=t/(h.height-n),h.height=t,h.width=Math.round(h.width*i),'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+h.width+'" height="'+h.height+'" xml:space="preserve" '+c+">"+o+"</svg>"},this.bind_help=function(e,t){function n(e){if(!e.help_path){$p.msg.show_msg({title:"Справка",type:"alert-info",text:$p.msg.not_implemented});return}}e instanceof dhtmlXCellObject||(!e.help_path&&t&&(e.help_path=t),e.button("help").show(),e.button("help").enable(),e.attachEvent("onHelp",n))},this.set_hash=function(e,t,n,r){e||(e=""),t||(t=""),n||(n=""),r||(r="");var i="obj="+e+"&ref="+t+"&frm="+n+"&view="+r;location.hash.substr(1)==i?this.hash_route():location.hash=i},this.hash_route=function(e){var t=$p.job_prm.parse_url(),n=$p.eve.hash_route.execute(t),r;n!==!1&&(!$p.iface.before_route||$p.iface.before_route(e)!==!1)&&$p.ajax.authorized&&(t.ref&&typeof _md!="undefined"?(r=_md.mgr_by_class_name(t.obj),r&&r[t.frm||"form_obj"]($p.iface.docs,t.ref)):t.view&&$p.iface.swith_view&&$p.iface.swith_view(t.view));if(e)return $p.cancel_bubble(e)},this.oninit=null,this.ontimer=null,setTimeout(function(){$p.iface.ontimer&&typeof $p.iface.ontimer=="function"&&setInterval($p.iface.ontimer,9e4)},2e4)}function Modifiers(){var e=[];this.push=function(t){e.push(t)},this.detache=function(t){var n=e.indexOf(t);n!=-1&&e.splice(n,1)},this.execute=function(t){var n,r;return e.forEach(function(e){typeof e=="function"?r=e(t):r=require(e)(t),n!==!1&&(n=r)}),r}}function AppEvents(){this.toString=function(){return"События при начале работы программы"},this.__define("onload",{value:new Modifiers,enumerable:!1,configurable:!1}),this.__define("hash_route",{value:new Modifiers,enumerable:!1,configurable:!1})}function JobPrm(){function e(){return $p.wsql.get_user_param("rest_path")||$p.job_prm.rest_path||"/a/zd/%1/odata/standard.odata/"}this.parse_url=function(){function e(e){var t={},n=[],r;if(e.substr(0,1)==="#"||e.substr(0,1)==="?")e=e.substr(1);if(e.length>2){r=decodeURI(e).split("&");for(var i in r){n=r[i].split("=");if(n[0]=="m")try{t[n[0]]=JSON.parse(n[1])}catch(s){t[n[0]]={}}else t[n[0]]=n[1]||""}}return t}return e(location.search)._mixin(e(location.hash))},this.check_browser_compatibility=!0,this.check_app_installed=!1,this.check_dhtmlx=!0,this.use_builder=!1,this.offline=!1,this.local_storage_prefix="",this.url_prm=this.parse_url(),typeof $p.settings=="function"&&$p.settings(this,$p.modifiers);for(var t in this)t!=="url_prm"&&typeof this[t]!="function"&&this.url_prm.hasOwnProperty[t]&&(this[t]=this.url_prm[t]);this.hs_url=function(){var e=this.hs_path||"/a/zd/%1/hs/upzp",t=$p.wsql.get_user_param("zone","number");return t?e.replace("%1",t):e.replace("%1/","")},this.rest_url=function(){var t=e(),n=$p.wsql.get_user_param("zone","number");return n?t.replace("%1",n):t.replace("%1/","")},this.irest_url=function(){var t=e(),n=$p.wsql.get_user_param("zone","number");return t=t.replace("odata/standard.odata","hs/rest"),n?t.replace("%1",n):t.replace("%1/","")}}function WSQL(){function e(e,t){if(t=="object"){try{e=JSON.parse(e)}catch(n){e={}}return e}return t=="number"?$p.fix_number(e,!0):t=="date"?$p.fix_date(e,!0):t=="boolean"?$p.fix_boolean(e):e}var t=this,n={},r=0;t.exec=function(e,n,i,s){if(r<10){r++,setTimeout(function(){t.exec(e,n,i,s)},1e3);return}if(r<100)throw new TypeError("alasql init error");Array.isArray(n)||(n=[n]);var o,u=[];try{i?alasql(e,n,function(e){i(e,s)}):alasql(e,n)}catch(a){i&&i(a)}},t.promise=function(e,t){return new Promise(function(n,r){alasql(e,t||[],function(e,t){t?r(t):n(e)})})},t.set_user_param=function(e,t){return new Promise(function(r,i){var s=t;typeof t=="object"?s=JSON.stringify(t):t===!1&&(s=""),typeof localStorage!="undefined"&&localStorage.setItem($p.job_prm.local_storage_prefix+e,s),n[e]=t,r()})},t.get_user_param=function(t,r){return!n.hasOwnProperty(t)&&typeof localStorage!="undefined"&&(n[t]=e(localStorage.getItem($p.job_prm.local_storage_prefix+t),r)),n[t]},t.save_options=function(e,n){return t.set_user_param(e+"_"+n.name,n)},t.restore_options=function(e,n){var r=t.get_user_param(e+"_"+n.name,"object");for(var i in r)if(typeof r[i]!="object")n[i]=r[i];else{n[i]||(n[i]={});for(var s in r[i])n[i][s]=r[i][s]}return n},t.init_params=function(){var e=[{p:"user_name",v:"",t:"string"},{p:"user_pwd",v:"",t:"string"},{p:"browser_uid",v:$p.generate_guid(),t:"string"},{p:"zone",v:$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1,t:"number"},{p:"enable_save_pwd",v:"",t:"boolean"},{p:"reset_local_data",v:"",t:"boolean"},{p:"autologin",v:"",t:"boolean"},{p:"cache_cat_date",v:0,t:"number"},{p:"files_date",v:20151115e4,t:"number"},{p:"margin",v:60,t:"number"},{p:"discount",v:15,t:"number"},{p:"offline",v:$p.job_prm.offline||"",t:"boolean"},{p:"skin",v:"dhx_web",t:"string"},{p:"rest_path",v:"",t:"string"}],n;return $p.job_prm.additional_params&&(e=e.concat($p.job_prm.additional_params)),localStorage.getItem($p.job_prm.local_storage_prefix+"zone")||(n=$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1),$p.job_prm.url_prm.hasOwnProperty("zone")&&(n=$p.fix_number($p.job_prm.url_prm.zone,!0)),n!==undefined&&t.set_user_param("zone",n),e.forEach(function(e){(t.get_user_param(e.p,e.t)==undefined||!t.get_user_param(e.p,e.t)&&e.p.indexOf("url")!=-1)&&t.set_user_param(e.p,$p.job_prm.hasOwnProperty(e.p)?$p.job_prm[e.p]:e.v)}),t.set_user_param("cache_cat_date",0),t.set_user_param("reset_local_data",""),new Promise(function(e,t){typeof alasql!="undefined"?$p.job_prm.create_tables?$p.job_prm.create_tables_sql?alasql($p.job_prm.create_tables_sql,[],function(){r=1e3,delete $p.job_prm.create_tables_sql,e()}):$p.ajax.get($p.job_prm.create_tables).then(function(t){alasql(t.response,[],function(){r=1e3,e()})}):e():e()})},t.drop_tables=function(e){function t(){i--,i<=0?setTimeout(e,10):n()}function n(){var e=s[i-1].tableid;e.substr(0,1)=="_"?t():alasql("drop table IF EXISTS "+e,[],t)}function r(e){s=e,(i=e.length)?n():t()}var i=0,s=[];alasql("SHOW TABLES",[],r)},t.backup_database=function(e){},t.restore_database=function(){},t.idx_connect=function(e,n){return new Promise(function(r,i){var s=indexedDB.open(e,1);s.onerror=function(e){i(e)},s.onsuccess=function(){r(s.result)},s.onupgradeneeded=function(r){return r.currentTarget.result.createObjectStore(n,{keyPath:"ref"}),t.idx_connect(e,n)}})},t.idx_save=function(e,n,r){return new Promise(function(i,s){function o(t){var n=t.transaction([r],"readwrite").objectStore(r).put(e instanceof DataObj?e._obj:e);n.onerror=function(e){s(e)},n.onsuccess=function(){i(n.result)}}!r&&e._manager&&(r=e._manager.table_name),n?o(n):t.idx_connect(t.idx_name||$p.job_prm.local_storage_prefix||"md",r).then(o)})},t.idx_get=function(e,n,r){return new Promise(function(i,s){function o(t){var n=t.transaction([r],"readonly").objectStore(r).get(e);n.onerror=function(e){s(e)},n.onsuccess=function(){i(n.result)}}n?o(n):t.idx_connect(t.idx_name||$p.job_prm.local_storage_prefix||"md",r).then(o)})},t.idx_delete=function(e,n,r){return new Promise(function(i,s){function o(t){var n=t.transaction([r],"readwrite").objectStore(r).delete(e instanceof DataObj?e.ref:e);n.onerror=function(e){s(e)},n.onsuccess=function(){i(n.result)}}!r&&e._manager&&(r=e._manager.table_name),n?o(n):t.idx_connect(t.idx_name||$p.job_prm.local_storage_prefix||"md",r).then(o)})},typeof alasql!="undefined"?t.aladb=new alasql.Database("md"):r=1e3}function _load(e){function t(){if(i.cachable)return $p.wsql.promise(i.get_sql_struct(e),[]).then($p.iface.data_to_tree)}function n(){}function r(){if(i.cachable)return $p.wsql.promise(i.get_sql_struct(e),[]).then(function(t){return $p.iface.data_to_grid.call(i,t,e)})}var i=_md.mgr_by_class_name(e.class_name),s;return e.action=="get_tree"&&(s=t())?s:e.action=="get_orders"&&(s=n())?s:e.action=="get_selection"&&(s=r())?s:$p.job_prm.offline?Promise.reject(Error($p.msg.offline_request)):(e.browser_uid=$p.wsql.get_user_param("browser_uid"),$p.ajax.post_ex($p.job_prm.hs_url(),JSON.stringify(e),!0).then(function(e){return e.response}))}function Meta(e,t){function n(e){for(var t in e)for(var n in e[t]){r[t][n]||(r[t][n]={});for(var i in e[t][n])r[t][n][i]?typeof r[t][n][i]=="object"&&r[t][n][i]._mixin(e[t][n][i]):r[t][n][i]=e[t][n][i]}}var r=e instanceof XMLHttpRequest?JSON.parse(e.response):e,i;t&&n(t instanceof XMLHttpRequest?JSON.parse(t.response):t),e=null,t=require("log"),typeof t=="string"&&(t=JSON.parse(t)),n(t),t=null,this.get=function(e,t){var n=e.split("."),i={multiline_mode:!1,note:"",synonym:"",tooltip:"",type:{is_ref:!1,types:["string"]}};return t?(n[0]=="doc"&&t=="number_doc"?(i.synonym="Номер",i.tooltip="Номер документа",i.type.str_len=11):n[0]=="doc"&&t=="date"?(i.synonym="Дата",i.tooltip="Дата документа",i.type.date_part="date_time",i.type.types[0]="date"):n[0]=="doc"&&t=="posted"?(i.synonym="Проведен",i.type.types[0]="boolean"):n[0]=="cat"&&t=="id"?i.synonym="Код":n[0]=="cat"&&t=="name"?i.synonym="Наименование":t=="deleted"?(i.synonym="Пометка удаления",i.type.types[0]="boolean"):t=="is_folder"?(i.synonym="Это группа",i.type.types[0]="boolean"):t=="lc_changed"?(i.synonym="Изменено в 1С",i.tooltip="Время записи в 1С",i.type.types[0]="number",i.type.digits=15,i.type.fraction_figits=0):t?i=r[n[0]][n[1]].fields[t]:i=r[n[0]][n[1]],i):r[n[0]][n[1]]},this.get_classes=function(){var e={};for(var t in r){e[t]=[];for(var n in r[t])e[t].push(n)}return e},this.create_tables=function(e){function t(t){typeof t=="number"?(r--,r==0?(e&&setTimeout(e,10),alasql.utils.saveFile("create_tables.sql",u)):n()):t.hasOwnProperty("message")&&($p.iface.docs.progressOff(),$p.msg.show_msg({title:$p.msg.error_critical,type:"alert-error",text:t.message}))}function n(){var e=i[r-1],n=e["class"][e.name].get_sql_struct();u+=n+";\n",t(1)}var r=0,i=[],s=this.get_classes(),o,u="USE md;\nCREATE TABLE IF NOT EXISTS refs (ref CHAR);\n";for(o in s.cat)i.push({"class":_cat,name:s.cat[o]});r=i.length;for(o in s.ireg)i.push({"class":_ireg,name:s.ireg[o]}),r++;for(o in s.doc)i.push({"class":_doc,name:s.doc[o]}),r++;for(o in s.enm)i.push({"class":_enm,name:s.enm[o]}),r++;for(o in s.cch)i.push({"class":_cch,name:s.cch[o]}),r++;for(o in s.cacc)i.push({"class":_cacc,name:s.cacc[o]}),r++;$p.wsql.exec(u),n()},this.sql_type=function(e,t,n){var r;return t=="type"&&e.table_name=="cch_properties"||t=="svg"&&e.table_name=="cat_production_params"?r=" JSON":n.is_ref||n.hasOwnProperty("str_len")?r=" CHAR":n.date_part?r=" Date":n.hasOwnProperty("digits")?n.fraction_figits==0?r=" INT":r=" FLOAT":n.types.indexOf("boolean")!=-1?r=" BOOLEAN":r=" CHAR",r},this.sql_mask=function(e,t){return", "+(t?"_t_.":"")+("`"+e+"`")},this.mgr_by_class_name=function(e){if(e){var t=e.split(".");if(t[1]&&$p[t[0]])return $p[t[0]][t[1]]}},this.value_mgr=function(e,t,n,r,i){function s(e){return e&&n.types.length==1&&(n._mgr=e),e}var o,u,a,f,l;if(n._mgr)return n._mgr;if(n.types.length==1){a=n.types[0].split(".");if(a.length>1&&$p[a[0]])return s($p[a[0]][a[1]])}else if(i&&i.type){a=i.type.split(".");if(a.length>1&&$p[a[0]])return s($p[a[0]][a[1]])}o=e.property||e.param;if(t!="value"||!o){f=[],n.types.forEach(function(e){a=e.split("."),a.length>1&&$p[a[0]][a[1]]&&f.push($p[a[0]][a[1]])});if(f.length==1)return s(f[0]);if(r)return f;if((o=e[t])instanceof DataObj)return o._manager;if($p.is_guid(o)&&o!=$p.blank.guid)for(var c in f){l=f[c];if(l.get(o,!1,!0))return l}}else{u=_cch.properties.get(o,!1);if($p.is_data_obj(u)){if(u.is_new())return _cat.property_values;for(f in u.type.types)if(u.type.types[f].indexOf(".")>-1){a=u.type.types[f].split(".");break}return a&&a.length>1&&$p[a[0]]?s($p[a[0]][a[1]]):u.type}}},this.control_by_type=function(e){var t;return e.is_ref?e.types.join().indexOf("enm.")==-1?t="ocombo":t="refc":e.date_part?t="dhxCalendar":e.digits?e.fraction_figits<5?t="calck":t="edn":e.types[0]=="boolean"?t="ch":e.hasOwnProperty("str_len")&&(e.str_len>=100||e.str_len==0)?t="txt":t="ed",t},this.ts_captions=function(e,t,n){n||(n={});var r=this.get(e).tabular_sections[t],i=this.get(e).form,s=r.fields,o;if(i&&i.obj){if(!i.obj.tabular_sections[t])return;n._mixin(i.obj.tabular_sections[t])}else{t==="contact_information"&&(s={type:"",kind:"",presentation:""}),n.fields=["row"],n.headers="№",n.widths="40",n.min_widths="",n.aligns="",n.sortings="na",n.types="cntr";for(var u in s)o=r.fields[u],o.hide||(n.fields.push(u),n.headers+=","+(o.synonym?o.synonym.replace(/,/g," "):u),n.types+=","+this.control_by_type(o.type),n.sortings+=",na")}return!0},this.syns_js=function(e){var t={DeletionMark:"deleted",Description:"name",DataVersion:"data_version",IsFolder:"is_folder",Number:"number_doc",Date:"date","Дата":"date",Posted:"posted",Code:"id",Parent_Key:"parent",Owner_Key:"owner",Owner:"owner",Ref_Key:"ref","Ссылка":"ref",LineNumber:"row"};return t[e]?t[e]:r.syns_js[r.syns_1с.indexOf(e)]||e},this.syns_1с=function(e){var t={deleted:"DeletionMark",name:"Description",data_version:"DataVersion",is_folder:"IsFolder",number_doc:"Number",date:"Date",posted:"Posted",id:"Code",ref:"Ref_Key",parent:"Parent_Key",owner:"Owner_Key",row:"LineNumber"};return t[e]?t[e]:r.syns_1с[r.syns_js.indexOf(e)]||e},this.printing_plates=function(e){if(e)for(var t in e.doc)r.doc[t].printing_plates=e.doc[t]},_md=$p.md=this;for(i in r.enm)_enm[i]=new EnumManager(r.enm[i],"enm."+i);for(i in r.cat)_cat[i]=new CatManager("cat."+i);for(i in r.doc)_doc[i]=new DocManager("doc."+i);for(i in r.ireg)i=="$log"?_ireg[i]=new LogManager("ireg."+i):_ireg[i]=new InfoRegManager("ireg."+i);for(i in r.dp)_dp[i]=new DataProcessorsManager("dp."+i);for(i in r.cch)_cch[i]=new ChartOfCharacteristicManager("cch."+i);for(i in r.cacc)_cacc[i]=new ChartOfAccountManager("cacc."+i);return $p.modifiers.execute($p),{md_date:r.md_date,cat_date:r.cat_date}}function DataManager(class_name){var _metadata=_md.get(class_name),_cachable,_async_write=_metadata.async_write,_events={after_create:[],after_load:[],before_save:[],after_save:[],value_change:[]};class_name.indexOf("enm.")!=-1?_cachable=!0:$p.job_prm.offline?_cachable=!0:class_name.indexOf("doc.")!=-1||class_name.indexOf("dp.")!=-1||class_name.indexOf("rep.")!=-1?_cachable=!1:_cachable=!0,!$p.job_prm.offline&&_metadata.hasOwnProperty("cachable")&&(_cachable=_metadata.cachable),this.__define({cachable:{value:_cachable,writable:!0,enumerable:!1},async_write:{value:_async_write,writable:!1,enumerable:!1},class_name:{value:class_name,writable:!1,enumerable:!1},alatable:{get:function(){return $p.wsql.aladb.tables[this.table_name]?$p.wsql.aladb.tables[this.table_name].data:[]},enumerable:!1},metadata:{value:function(e){return e?_metadata.fields[e]||_metadata.tabular_sections[e]:_metadata},enumerable:!1},attache_event:{value:function(e,t,n){n?_events[e].push(t):_events[e].push(t)},enumerable:!1},handle_event:{value:function(e,t,n){var r;return _events[t].forEach(function(t){r!==!1&&(r=t.call(e,n))}),r},enumerable:!1}});var _obj_сonstructor=this._obj_сonstructor||DataObj;if(!(this instanceof EnumManager)){var obj_сonstructor_name=class_name.split(".")[1];this._obj_сonstructor=eval("(function "+obj_сonstructor_name.charAt(0).toUpperCase()+obj_сonstructor_name.substr(1)+"(attr, manager){manager._obj_сonstructor.superclass.constructor.call(this, attr, manager)})"),this._obj_сonstructor._extend(_obj_сonstructor);if(this instanceof InfoRegManager){delete this._obj_сonstructor.prototype.deleted,delete this._obj_сonstructor.prototype.ref,delete this._obj_сonstructor.prototype.lc_changed;for(var f in this.metadata().dimensions)this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0});for(var f in this.metadata().resources)this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0})}else{this._ts_сonstructors={};for(var f in this.metadata().fields)this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0});for(var f in this.metadata().tabular_sections){var row_сonstructor_name=obj_сonstructor_name.charAt(0).toUpperCase()+obj_сonstructor_name.substr(1)+f.charAt(0).toUpperCase()+f.substr(1)+"Row";this._ts_сonstructors[f]=eval("(function "+row_сonstructor_name+"(owner) 			{owner._owner._manager._ts_сonstructors[owner._name].superclass.constructor.call(this, owner)})"),this._ts_сonstructors[f]._extend(TabularSectionRow);for(var rf in this.metadata().tabular_sections[f].fields)this._ts_сonstructors[f].prototype.__define(rf,{get:new Function("return this._getter('"+rf+"')"),set:new Function("v","this._setter('"+rf+"',v)"),enumerable:!0});this._obj_сonstructor.prototype.__define(f,{get:new Function("return this._getter_ts('"+f+"')"),set:new Function("v","this._setter_ts('"+f+"',v)"),enumerable:!0})}}}_obj_сonstructor=null}function RefDataManager(e){var t=this,n={};RefDataManager.superclass.constructor.call(t,e),t.push=function(e,t){t&&t!=e.ref?(delete n[e.ref],n[t]=e):n[e.ref]=e},t.all=function(){return n},t.each=function(e){for(var t in n){if(!t||t==$p.blank.guid)continue;if(e.call(this,n[t])==1)break}},t.get=function(e,r,i){var s=n[e]||n[e=$p.fix_guid(e)];if(!s){if(i)return;s=new t._obj_сonstructor(e,t,!0)}return r===!1?s:r===undefined&&e===$p.blank.guid?s:!t.cachable||s.is_new()?s.load():r?Promise.resolve(s):s},t.create=function(e,r){function i(){}if(!e||typeof e!="object")e={};if(!e.ref||!$p.is_guid(e.ref)||$p.is_empty_guid(e.ref))e.ref=$p.generate_guid();var s=n[e.ref];if(!s){s=new t._obj_сonstructor(e,t);if(!t.cachable&&r){var o={};return $p.ajax.default_attr(o,$p.job_prm.irest_url()),o.url+=t.rest_name+"/Create()",$p.ajax.get_ex(o.url,o).then(function(e){return s._mixin(JSON.parse(e.response),undefined,["ref"])})}if(r){var u=s._obj;for(var a in t.metadata().fields)u[a]==undefined&&(u[a]="")}}return Promise.resolve(s)},t.delete_loc=function(e){var r;delete n[e];for(var i in t.alatable)if(t.alatable[i].ref==e){r=i;break}r!=undefined&&t.alatable.splice(r,1)},t.find=function(e){return $p._find(n,e)},t.find_rows=function(e,r){return $p._find_rows.call(t,n,e,r)},t.save=function(e){return e&&(e.specify||$p.is_guid(e.ref)&&!t.cachable)?_load({class_name:t.class_name,action:e.action||"save",attr:e}).then(JSON.parse):Promise.reject()},t.load_array=function(e,r){var i,s;for(var o in e){i=$p.fix_guid(e[o]);if(!(s=n[i]))new t._obj_сonstructor(e[o],t);else if(s.is_new()||r)s._mixin(e[o]),s._set_loaded()}},t.predefined=function(e){var n=t.metadata().predefined[e];return n?t.get(n.ref):undefined},t.first_folder=function(e){for(var r in n){var i=n[r];if(i.is_folder&&(!e||$p.is_equal(e,i.owner)))return i}return t.get()}}function DataProcessorsManager(e){DataProcessorsManager.superclass.constructor.call(this,e),this.create=function(){return new this._obj_сonstructor({},this)}}function EnumManager(e,t){EnumManager.superclass.constructor.call(this,t),this._obj_сonstructor=EnumObj,this.push=function(e,t){this.__define(t,{value:e,enumerable:!1})},this.get=function(e){if(e instanceof EnumObj)return e;if(!e||e==$p.blank.guid)e="_";var t=this[e];return t||(t=new EnumObj({name:e},this)),t},this.each=function(e){this.alatable.forEach(function(t){t.ref&&t.ref!=$p.blank.guid&&e.call(this[t.ref])})};for(var n in e)new EnumObj(e[n],this)}function RegisterManager(e){var t={};this._obj_сonstructor=RegisterRow,RegisterManager.superclass.constructor.call(this,e),this.push=function(e,n){n&&n!=e.ref?(delete t[e.ref],t[n]=e):t[e.ref]=e},this.get=function(e,n,r){e||(e={}),e.action="select";var i=alasql(this.get_sql_struct(e),e._values),s;delete e.action,delete e._values;if(i.length)if(r)s=t[this.get_ref(i[0])];else{s=[];for(var o in i)s.push(t[this.get_ref(i[o])])}return n?Promise.resolve(s):s},this.load_array=function(e){var n,r,i=[];for(var s in e)n=this.get_ref(e[s]),(r=t[n])?r._mixin(e[s]):new this._obj_сonstructor(e[s],this),i.push(t[n]);return i},this.find_rows=function(e,t){return $p._find_rows.call(this,this.alatable,e,t)}}function InfoRegManager(e){InfoRegManager.superclass.constructor.call(this,e)}function LogManager(){LogManager.superclass.constructor.call(this,"ireg.$log");var e;this.record=function(t){if(t instanceof Error){console&&console.log(t);var n=t;t={"class":"error",note:n.toString()}}typeof t!="object"&&(t={note:t}),t.date=Date.now()+$p.eve.time_diff(),e||(e=alasql.compile("select MAX(`sequence`) as `sequence` from `ireg_$log` where `date` = ?"));var r=e([t.date]);!r.length||r[0].sequence===undefined?t.sequence=0:t.sequence=r[0].sequence+1,t.class||(t.class="note"),alasql("insert into `ireg_$log` (`date`, `sequence`, `class`, `note`, `obj`) values (?, ?, ?, ?, ?)",[t.date,t.sequence,t.class,t.note,t.obj?JSON.stringify(t.obj):""])},this.backup=function(e,t){},this.restore=function(e,t){},this.clear=function(e,t){},this.show=function(e){},this.get_sql_struct=function(e){if(e&&e.action=="get_selection"){var t="select * from `ireg_$log`";return e.date_from?e.date_till?t+=" where `date` >= ? and `date` <= ?":t+=" where `date` >= ?":e.date_till&&(t+=" where `date` <= ?"),t}return LogManager.superclass.get_sql_struct.call(this,e)},this.caption_flds=function(e){function t(e,t,n,r,i,s){this.id=e,this.width=t,this.type=n,this.align=r,this.sort=i,this.caption=s}var n='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>',r=[],i=this.metadata(),s="";r.push(new t("date","140","ro","left","server","Дата")),r.push(new t("class","100","ro","left","server","Класс")),r.push(new t("note","*","ro","left","server","Событие"));if(e.get_header){s="<head>";for(var o in r)s+=n.replace("%1",r[o].id).replace("%2",r[o].width).replace("%3",r[o].type).replace("%4",r[o].align).replace("%5",r[o].sort).replace("%6",r[o].caption);s+="</head>"}return{head:s,acols:r}},this.data_to_grid=function(e,t){var n="<?xml version='1.0' encoding='UTF-8'?><rows total_count='%1' pos='%2' set_parent='%3'>".replace("%1",e.length).replace("%2",t.start).replace("%3",t.set_parent||""),r=this.caption_flds(t),i=$p.eve.time_diff();return n+=r.head,e.forEach(function(e){n+='<row id="'+e.date+"_"+e.sequence+'"><cell>'+$p.dateFormat(e.date-i,$p.dateFormat.masks.date_time)+(e.sequence?"."+e.sequence:"")+"</cell>"+"<cell>"+e.class+"</cell><cell>"+e.note+"</cell></row>"}),n+"</rows>"}}function AccumRegManager(e){AccumRegManager.superclass.constructor.call(this,e)}function CatManager(e){this._obj_сonstructor=CatObj,CatManager.superclass.constructor.call(this,e),this.metadata().hierarchical&&this.metadata().group_hierarchy&&this._obj_сonstructor.prototype.__define("is_folder",{get:function(){return this._obj.is_folder||!1},set:function(e){this._obj.is_folder=$p.fix_boolean(e)},enumerable:!0})}function ChartOfCharacteristicManager(e){this._obj_сonstructor=CatObj,ChartOfCharacteristicManager.superclass.constructor.call(this,e)}function ChartOfAccountManager(e){this._obj_сonstructor=CatObj,ChartOfAccountManager.superclass.constructor.call(this,e)}function DocManager(e){this._obj_сonstructor=DocObj,DocManager.superclass.constructor.call(this,e)}function TabularSection(e,t){t._obj[e]||(t._obj[e]=[]),this.__define("_name",{value:e,enumerable:!1}),this.__define("_owner",{value:t,enumerable:!1}),this.__define("_obj",{value:t._obj[e],writable:!1,enumerable:!1})}function TabularSectionRow(e){var t={};this.__define("_owner",{value:e,enumerable:!1}),this.__define("_obj",{value:t,writable:!1,enumerable:!1})}function DataObj(e,t){var n,r,i={},s={data_version:""},o=!(this instanceof EnumObj);!(t instanceof DataProcessorsManager)&&!(t instanceof EnumManager)&&(r=t.get(e,!1,!0));if(r)return r;t instanceof EnumManager?s.ref=n=e.name:t instanceof RegisterManager?n=t.get_ref(e):(s.ref=n=$p.fix_guid(e),s.deleted=!1,s.lc_changed=0),this.__define("_manager",{value:t,enumerable:!1}),this.__define("is_new",{value:function(){return o},enumerable:!1}),this.__define("_set_loaded",{value:function(e){o=!1,t.push(this,e)},enumerable:!1}),this.__define("_obj",{value:s,writable:!1,enumerable:!1}),this.__define("_ts_",{value:function(e){return i[e]||(i[e]=new TabularSection(e,this)),i[e]},enumerable:!1}),t.alatable&&t.push&&(t.alatable.push(s),t.push(this,n))}function CatObj(e,t){var n="";CatObj.superclass.constructor.call(this,e,t),this.__define("presentation",{get:function(){return this.name||this.id?this.name||this.id||this._metadata.obj_presentation:n},set:function(e){e&&(n=String(e))},enumerable:!1}),e&&typeof e=="object"&&(e._not_set_loaded?(delete e._not_set_loaded,this._mixin(e)):(this._mixin(e),!$p.is_empty_guid(this.ref)&&(e.id||e.name)&&this._set_loaded(this.ref)))}function DocObj(e,t){var n="";DocObj.superclass.constructor.call(this,e,t),this.__define("presentation",{get:function(){return this.number_str||this.number_doc?this._metadata.obj_presentation+" №"+(this.number_str||this.number_doc)+" от "+$p.dateFormat(this.date,$p.dateFormat.masks.ru):n},set:function(e){e&&(n=String(e))},enumerable:!1}),e&&typeof e=="object"&&this._mixin(e),!$p.is_empty_guid(this.ref)&&e.number_doc&&this._set_loaded(this.ref)}function DataProcessorObj(e,t){DataProcessorObj.superclass.constructor.call(this,e,t);var n,r=t.metadata();for(n in r.fields)e[n]=$p.fetch_type("",r.fields[n].type);for(n in r.tabular_sections)e[n]=[];this._mixin(e),this.unload=function(){for(n in this)this[n]instanceof TabularSection?(this[n].clear(),delete this[n]):typeof this[n]!="function"&&delete this[n]}}function EnumObj(e,t){EnumObj.superclass.constructor.call(this,e,t),e&&typeof e=="object"&&this._mixin(e)}function RegisterRow(e,t){RegisterRow.superclass.constructor.call(this,e,t),e&&typeof e=="object"&&this._mixin(e)}function Rest(){this.filter_date=function(e,t,n){t||(t=new Date("2015-01-01"));var r=e+" gt datetime'"+$p.dateFormat(t,$p.dateFormat.masks.isoDateTime)+"'";return n&&(r+=" and "+e+" lt datetime'"+$p.dateFormat(n,$p.dateFormat.masks.isoDateTime)+"'"),r},this.to_data=function(e,t){var n={},r=t.metadata().fields,i=t.metadata().tabular_sections,s,o,u,a,f,l,c;t instanceof RefDataManager?(e.hasOwnProperty("DeletionMark")&&(n.deleted=e.DeletionMark),e.hasOwnProperty("DataVersion")&&(n.data_version=e.DataVersion),e.hasOwnProperty("Ref_Key")&&(n.ref=e.Ref_Key)):r=[]._mixin(t.metadata().dimensions)._mixin(t.metadata().resources),t instanceof DocManager?(e.hasOwnProperty("Number")?n.number_doc=e.Number||e.number_doc:e.hasOwnProperty("number_doc")&&(n.number_doc=e.number_doc),e.hasOwnProperty("Date")?n.date=e.Date:e.hasOwnProperty("date")&&(n.date=e.date),e.hasOwnProperty("Posted")?n.posted=e.Posted:e.hasOwnProperty("posted")&&(n.posted=e.posted)):(t.metadata().main_presentation_name&&(e.hasOwnProperty("Description")?n.name=e.Description:e.hasOwnProperty("name")&&(n.name=e.name)),t.metadata().code_length&&(e.hasOwnProperty("Code")?n.id=e.Code:e.hasOwnProperty("id")&&(n.id=e.id)));for(o in r){f=_md.syns_1с(o),f.indexOf("_Key")==-1&&r[o].type.is_ref&&e[f+"_Key"]&&(f+="_Key");if(!e.hasOwnProperty(f))continue;n[o]=e[f]}for(s in i){l=s=="extra_fields"?s:_md.syns_1с(s);if(!e.hasOwnProperty(l))continue;n[s]=[],e[l]&&(e[l].sort(function(e,t){return e.LineNumber>t.LineNumber}),e[l].forEach(function(e){a={};for(u in i[s].fields)f=s!="extra_fields"||u!="property"&&u!="value"?_md.syns_1с(u):u,f.indexOf("_Key")==-1&&i[s].fields[u].type.is_ref&&e[f+"_Key"]&&(f+="_Key"),a[u]=e[f];n[s].push(a)}))}return n},this.ajax_to_data=function(e,t){return $p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){var n=[];return e.value.forEach(function(e){n.push(_rest.to_data(e,t))}),n})},this.build_select=function(e,t){function n(e,r){typeof r=="function"?s+=r(t,e):(o=_md.syns_1с(e),u=_md.get(t.class_name,e),u&&(u=u.type,u.is_ref&&o.indexOf("_Key")==-1&&u.types.length&&u.types[0].indexOf("enm.")==-1&&(o+="_Key"),u.types.length&&(["boolean","number"].indexOf(typeof r)!=-1?s+=o+" eq "+r:u.is_ref||r instanceof DataObj?s+=o+" eq guid'"+r+"'":typeof r=="string"?s+=o+" eq '"+r+"'":typeof r=="object"&&(r.hasOwnProperty("like")?s+=o+" like '%"+r.like+"%'":r.hasOwnProperty("not")&&(s+=" not ("+n(e,r.not)+") ")))))}function r(e){for(var t in e){s?s+=" and ":s="&$filter=";if(t=="or"&&Array.isArray(e[t])){var r=!0;e[t].forEach(function(e){r?(s+=" ( ",r=!1):s+=" or ";var t=Object.keys(e)[0];n(t,e[t])}),s+=" ) "}else n(t,e[t])}}var i,s,o,u,a="";e||(e={}),e.fields&&(e.fields.forEach(function(e){e=="ref"?o="Ref_Key":(o=_md.syns_1с(e),u=_md.get(t.class_name,e).type,u.is_ref&&o.indexOf("_Key")==-1&&u.types.length&&u.types[0].indexOf("enm.")==-1&&(o+="_Key")),i?i+=",":i="&$select=",i+=o}),a+=i),e.selection&&(typeof e.selection!="function"&&(Array.isArray(e.selection)?e.selection.forEach(r):r(e.selection)),s&&(a+=s)),$p.job_prm.rest&&t.rest_name.indexOf("Module_")==-1&&t.rest_name.indexOf("DataProcessor_")==-1&&t.rest_name.indexOf("Report_")==-1&&a.indexOf(" like ")==-1&&a.indexOf(" in ")==-1?$p.ajax.default_attr(e,$p.job_prm.rest_url()):$p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=t.rest_name+"?allowedOnly=true&$format=json&$top="+(e.top||300)+a},this.load_array=function(e,t){return _rest.build_select(e,t),_rest.ajax_to_data(e,t)},this.load_obj=function(e){var t={};return $p.ajax.default_attr(t,!e._metadata.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),t.url+=e._manager.rest_name+"(guid'"+e.ref+"')?$format=json",$p.ajax.get_ex(t.url,t).then(function(e){return JSON.parse(e.response)}).then(function(t){return e._mixin(_rest.to_data(t,e._manager))._set_loaded(),e}).catch(function(t){if(t.status==404)return e;$p.record_log(t)})},this.save_irest=function(e,t){var n=JSON.stringify(e),r=(t.post!=undefined?",post="+t.post:"")+(t.operational!=undefined?",operational="+t.operational:"");return $p.ajax.default_attr(t,$p.job_prm.irest_url()),t.url+=e._manager.rest_name+"(guid'"+e.ref+"'"+r+")",$p.ajax.post_ex(t.url,n,t).then(function(e){return JSON.parse(e.response)}).then(function(t){return e._mixin(t)})},this.save_rest=function(e,t){var n=e.to_atom(),r;return $p.ajax.default_attr(t,$p.job_prm.rest_url()),r=t.url+e._manager.rest_name,t.url=r+"(guid'"+e.ref+"')?$format=json&$select=Ref_Key,DeletionMark",$p.ajax.get_ex(t.url,t).catch(function(e){return e.status==404?{response:JSON.stringify({is_new:!0})}:Promise.reject(e)}).then(function(e){return JSON.parse(e.response)}).then(function(i){return i.is_new?$p.ajax.post_ex(r,n,t):$p.ajax.patch_ex(r+"(guid'"+e.ref+"')",n,t)}).then(function(t){var n=require("xml_to_json").parseString(t.response,{mergeCDATA:!1,grokAttr:!0,grokText:!1,normalize:!0,xmlns:!1,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!1,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!1});if(n.entry&&n.entry.content&&n.entry.updated){var r=n.entry.content.properties,i={},s;i.lc_changed=new Date(n.entry.updated._text);for(var o in r){if(o.indexOf("_")==0)continue;if(s=r[o].element){i[o]=[];if(Array.isArray(s))for(var u in s){i[o][u]={};for(var a in s[u])a.indexOf("_")!=0&&(i[o][u][a]=s[u][a]._text==="false"?!1:s[u][a]._text)}else{i[o][0]={};for(var a in s)a.indexOf("_")!=0&&(i[o][0][a]=s[a]._text==="false"?!1:s[a]._text)}}else i[o]=r[o]._text==="false"?!1:r[o]._text}return _rest.to_data(i,e._manager)}}).then(function(t){return e._mixin(t)})}}function only_in_browser(w){var eve=$p.eve,iface=$p.iface,msg=$p.msg,stepper={},timer_setted=!1,cache;eve.set_offline=function(e){var t=$p.job_prm.offline;$p.job_prm.offline=!!e||!!$p.wsql.get_user_param("offline","boolean"),t!=$p.job_prm["offline"]&&(t=$p.job_prm.offline)},eve.on_rotate=function(e){$p.device_orient=w.orientation==0||w.orientation==180?"portrait":"landscape",typeof e!="undefined"&&w.dhx4.callEvent("onOrientationChange",[$p.device_orient])},typeof w.orientation=="undefined"?$p.device_orient=w.innerWidth>w.innerHeight?"landscape":"portrait":eve.on_rotate(),w.addEventListener("orientationchange",eve.on_rotate,!1),$p.__define("device_type",{get:function(){var e=$p.wsql.get_user_param("device_type");return e||(e=function(e){return e<1024?"phone":e<1280?"tablet":"desktop"}(Math.max(screen.width,screen.height)),$p.wsql.set_user_param("device_type",e)),e},set:function(e){$p.wsql.set_user_param("device_type",e)},enumerable:!1,configurable:!1}),w.addEventListener("online",eve.set_offline),w.addEventListener("offline",function(){eve.set_offline(!0)}),w.addEventListener("load",function(){function do_reload(){$p.ajax.authorized||(eve.redirect=!0,location.reload(!0))}function do_cache_update_msg(e){!stepper.wnd_appcache&&$p.iface.appcache?$p.iface.appcache.create(stepper):timer_setted||(timer_setted=!0,setTimeout(do_reload,25e3)),$p.iface.appcache&&(stepper.loaded=e.loaded||0,stepper.total=e.total||140,$p.iface.appcache.update()),stepper.do_break&&($p.iface.appcache.close(),setTimeout(do_reload,1e3))}setTimeout(function(){function IPInfo(){function e(){this.geocode=function(e){return Promise.resolve(!1)}}var t,n,r="",i;this.__define("yageocoder",{get:function(){return t||(t=new e),t},enumerable:!1,configurable:!1}),this.__define("ggeocoder",{get:function(){return n},enumerable:!1,configurable:!1}),this.__define({addr:{get:function(){return r}},parts:{get:function(){return i}},components:{value:function(e,t){var n,r,i,s="",o="",u="";for(n in t){r=t[n];for(i in r.types)switch(r.types[i]){case"route":r.short_name.indexOf("Unnamed")==-1&&(s=r.short_name+(s?" "+s:""),o=r.long_name.replace("улица","").trim());break;case"administrative_area_level_1":e.region=r.long_name;break;case"administrative_area_level_2":e.city=r.short_name,e.city_long=r.long_name;break;case"locality":u=(u?u+" ":"")+r.short_name;break;case"street_number":s=(s?s+" ":"")+r.short_name;break;case"postal_code":e.postal_code=r.short_name;break;default:}}e.region&&e.region==e.city_long?e.city.indexOf(u)==-1?e.city=u:e.city="":u&&e.city.indexOf(u)==-1&&e.region.indexOf(u)==-1&&(s=u+", "+s);if(!e.street||e.street.indexOf(o)==-1)e.street=s;return e}}}),this.location_callback=function(){n=new google.maps.Geocoder,navigator.geolocation.getCurrentPosition(function(e){$p.ipinfo.latitude=e.coords.latitude,$p.ipinfo.longitude=e.coords.longitude;var t=new google.maps.LatLng($p.ipinfo.latitude,$p.ipinfo.longitude);n.geocode({latLng:t},function(e,t){t==google.maps.GeocoderStatus.OK&&(!e[1]||e[0].address_components.length>=e[1].address_components.length?i=e[0]:i=e[1],r=i.formatted_address,dhx4.callEvent("geo_current_position",[$p.ipinfo.components({},i.address_components)]))})},$p.record_log,{timeout:3e4})}}function navigate(e){e&&(location.origin+location.pathname).indexOf(e)==-1&&location.replace(e)}function init_params(){$p.wsql.init_params().then(function(){function e(){var e,t,n,r=!0,i=!0,s=new RegExp("metadata.js$"),o=new RegExp("metadata.min.js$");for(e in document.scripts){if(document.scripts[e].src.match(s)){n=s,t=document.scripts[e].src;break}if(document.scripts[e].src.match(o)){n=o,t=document.scripts[e].src;break}}for(e=0;e<document.styleSheets.length;e++)document.styleSheets[e].href&&(document.styleSheets[e].href.indexOf("dhtmlx_")!=-1?r=!1:document.styleSheets[e].href.indexOf("metadata.css")!=-1&&(i=!1));dhtmlx.skin=$p.wsql.get_user_param("skin")||"dhx_web",r&&$p.load_script(t.replace(n,dhtmlx.skin=="dhx_web"?"dhtmlx_web.css":"dhtmlx_terrace.css"),"link"),i&&$p.load_script(t.replace(n,"metadata.css"),"link"),$p.job_prm.additional_css&&$p.job_prm.additional_css.forEach(function(e){(dhx4.isIE||e.indexOf("ie_only")==-1)&&$p.load_script(e,"link")}),dhtmlx.image_path=t.replace(n,"imgs/"),dhtmlx.skin_suffix=function(){return dhtmlx.skin.replace("dhx","")+"/"},dhx4.ajax.cache=!0,$p.iface.__define("w",{value:new dhtmlXWindows,enumerable:!1}),$p.iface.w.setSkin(dhtmlx.skin),$p.iface.__define("popup",{value:new dhtmlXPopup,enumerable:!1})}"dhtmlx"in w&&e(),eve.stepper={step:0,count_all:0,cat_date:0,step_size:57,files:0,cat_ini_date:$p.wsql.get_user_param("cache_cat_date","number")||0},eve.set_offline(!navigator.onLine),eve.update_files_version();if(document.documentElement.webkitRequestFullScreen&&navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)&&($p.job_prm.request_full_screen||$p.wsql.get_user_param("request_full_screen"))){var t=function(){document.documentElement.webkitRequestFullScreen(),w.removeEventListener("touchstart",t)};w.addEventListener("touchstart",t,!1)}if($p.job_prm.use_builder||$p.job_prm.use_wrapper)$p.wrapper=document.getElementById("owb_wrapper"),$p.risdiv=document.getElementById("risdiv"),$p.ft=document.getElementById("msgfooter"),$p.ft&&($p.ft.style.display="none");eve.onload.execute($p),document&&document.querySelector("#splash")&&document.querySelector("#splash").parentNode.removeChild(document.querySelector("#splash")),$p.job_prm.use_builder&&$p.ft?dhtmlxEvent($p.ft,"click",function(e){$p.cancel_bubble(e),e.qualifier=="ready"?iface.oninit():$p.eve.builder_click&&$p.eve.builder_click(e)}):setTimeout(iface.oninit,100),$p.msg.russian_names();if($p.wsql.get_user_param("use_service_worker","boolean")&&typeof navigator!="undefined"&&"serviceWorker"in navigator&&location.protocol.indexOf("https")!=-1)navigator.serviceWorker.register("metadata_service_worker.js",{scope:"/"}).then(function(e){$p.record_log("serviceWorker register succeeded")}).catch($p.record_log);else if(cache=w.applicationCache)cache.addEventListener("noupdate",function(e){},!1),cache.addEventListener("cached",function(e){timer_setted=!0,$p.iface.appcache&&$p.iface.appcache.close()},!1),cache.addEventListener("downloading",do_cache_update_msg,!1),cache.addEventListener("progress",do_cache_update_msg,!1),cache.addEventListener("updateready",function(e){try{cache.swapCache(),$p.iface.appcache&&$p.iface.appcache.close()}catch(e){}do_reload()},!1),cache.addEventListener("error",$p.record_log,!1)})}$p.job_prm=new JobPrm,navigator.geolocation&&$p.job_prm.use_google_geo&&($p.ipinfo=new IPInfo,!window.google||!window.google.maps?$p.eve.onload.push(function(){setTimeout(function(){$p.load_script(location.protocol+"//maps.google.com/maps/api/js?callback=$p.ipinfo.location_callback","script",function(){})},100)}):location_callback()),$p.job_prm.allow_post_message&&w.addEventListener("message",function(event){if($p.job_prm.allow_post_message=="*"||$p.job_prm.allow_post_message==event.origin)if(typeof event.data=="string")try{var res=eval(event.data);if(res&&event.source){if(typeof res=="object")res=JSON.stringify(res);else if(typeof res=="function")return;event.source.postMessage(res,"*")}}catch(e){$p.record_log(e)}}),eve.socket.connect();if($p.job_prm.check_browser_compatibility&&(!w.JSON||!w.indexedDB||!w.localStorage)){eve.redirect=!0,msg.show_msg({type:"alert-error",text:msg.unsupported_browser,title:msg.unsupported_browser_title}),setTimeout(function(){location.replace(msg.store_url_od)},6e3);return}if($p.job_prm.check_app_installed&&w.chrome&&w.chrome.app&&!w.chrome.app.isInstalled&&!location.hostname.match(/.local/)){eve.redirect=!0,msg.show_msg({type:"alert-error",text:msg.unsupported_mode,title:msg.unsupported_mode_title}),setTimeout(function(){location.replace(msg.store_url_od)},6e3);return}setTimeout(function(){typeof Promise!="function"?$p.load_script("//cdn.jsdelivr.net/es6-promise/latest/es6-promise.min.js","script",function(){ES6Promise.polyfill(),init_params()}):init_params()},20)},20)},!1),w.onbeforeunload=function(){if(!eve.redirect)return msg.onbeforeunload},w.addEventListener("popstat",$p.iface.hash_route),w.addEventListener("hashchange",$p.iface.hash_route)}function SocketMsg(){function e(e){if(e&&e.type=="react")try{var t=_md?_md.mgr_by_class_name(e.class_name):null;t&&t.load_array([e.obj],!0)}catch(n){$p.record_log(n)}}var t,n,r,i=0,s=this;s.connect=function(e){t||(t=$p.job_prm.parse_url().socket_uid||""),e&&(i=0),i++;if($p.job_prm.ws_url)if(!n||!r)try{n=new WebSocket($p.job_prm.ws_url),n.onopen=function(){r=!0,n.send(JSON.stringify({socket_uid:t,zone:$p.wsql.get_user_param("zone"),browser_uid:$p.wsql.get_user_param("browser_uid"),_side:"js",_mirror:!0}))},n.onclose=function(){r=!1,setTimeout(s.connect,i<3?3e4:6e5)},n.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(n){t=e.data}s.handlers.execute(t)},n.onerror=$p.record_log}catch(o){setTimeout(s.connect,i<3?3e4:6e5),$p.record_log(o)}},s.handlers=new Modifiers,s.send=function(e){n&&r&&(e?"object"!=typeof e&&(e={data:e}):e={},e.socket_uid=t,e._side="js",n.send(JSON.stringify(e)))},typeof window!="undefined"&&s.handlers.push(e)}$p=new MetaEngine,typeof define=="function"&&define.amd?define("$p",$p):typeof module=="object"&&module&&(module.exports=$p),typeof window!="undefined"?$p.load_script=function(e,t,n){var r=document.createElement(t);t=="script"?(r.type="text/javascript",r.src=e,n?(r.async=!0,r.addEventListener("load",n,!1)):r.async=!1):(r.type="text/css",r.rel="stylesheet",r.href=e),document.head.appendChild(r)}:typeof WorkerGlobalScope=="undefined"&&(typeof localStorage=="undefined"&&(localStorage=(new require("node-localstorage")).LocalStorage("./localstorage")),typeof window=="undefined"&&typeof alasql=="undefined"&&(alasql=require("alasql"))),Object.defineProperty(Object.prototype,"__define",{value:function(e,t){return t?Object.defineProperty(this,e,t):Object.defineProperties(this,e),this},enumerable:!1}),Object.prototype.__define("_extend",{value:function(e){var t=function(){};t.prototype=e.prototype,this.prototype=new t,this.prototype.constructor=this,this.__define("superclass",{value:e.prototype,enumerable:!1})},enumerable:!1}),Object.prototype.__define("_mixin",{value:function(e,t,n){var r={},i,s;if(t&&t.length)for(i=0;i<t.length;i++){s=t[i];if(n&&n.indexOf(s)!=-1)continue;if(typeof r[s]=="undefined"||r[s]!=e[s])this[s]=e[s]}else for(s in e){if(n&&n.indexOf(s)!=-1)continue;if(typeof r[s]=="undefined"||r[s]!=e[s])this[s]=e[s]}return this},enumerable:!1}),Object.prototype.__define("_clone",{value:function(){if(!this||"object"!=typeof this)return this;var e,t,n="function"==typeof this.pop?[]:{};for(e in this)this.hasOwnProperty(e)&&(t=this[e],t?"function"==typeof t||t instanceof DataObj||t instanceof DataManager?n[e]=t:"object"==typeof t?n[e]=t._clone():n[e]=t:n[e]=t);return n},enumerable:!1}),!Object.observe&&!Object.unobserve&&!Object.getNotifier&&Object.__define({observe:{value:function(e,t){e._observers||e.__define({_observers:{value:[],enumerable:!1},_notis:{value:[],enumerable:!1}}),e._observers.push(t)},enumerable:!1},unobserve:{value:function(e,t){if(!e._observers)return;for(var n in e._observers)if(e._observers[n]===t){e._observers.splice(n,1);break}},enumerable:!1},getNotifier:{value:function(e){var t;return{notify:function(n){if(!e._observers)return;e._notis.push(n),t||(t=!0,setTimeout(function(){e._observers.forEach(function(t){t(e._notis)}),e._notis.length=0,t=!1},10))}}},enumerable:!1}}),$p.dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(e,t){e=String(e),t=t||2;while(e.length<t)e="0"+e;return e};return function(i,s,o){var u=$p.dateFormat;s||(s=$p.dateFormat.masks.ru),arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)&&(s=i,i=undefined),i=i?new Date(i):new Date,isNaN(i)&&(i=new Date(0)),s=String(u.masks[s]||s||u.masks["default"]),s.slice(0,4)=="UTC:"&&(s=s.slice(4),o=!0);var a=o?"getUTC":"get",f=i[a+"Date"](),l=i[a+"Day"](),c=i[a+"Month"](),h=i[a+"FullYear"](),p=i[a+"Hours"](),d=i[a+"Minutes"](),v=i[a+"Seconds"](),m=i[a+"Milliseconds"](),g=o?0:i.getTimezoneOffset(),y={d:f,dd:r(f),ddd:u.i18n.dayNames[l],dddd:u.i18n.dayNames[l+7],m:c+1,mm:r(c+1),mmm:u.i18n.monthNames[c],mmmm:u.i18n.monthNames[c+12],yy:String(h).slice(2),yyyy:h,h:p%12||12,hh:r(p%12||12),H:p,HH:r(p),M:d,MM:r(d),s:v,ss:r(v),l:r(m,3),L:r(m>99?Math.round(m/10):m),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:o?"UTC":(String(i).match(t)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+r(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10]};return s.replace(e,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}(),$p.dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",atom:"yyyy-mm-dd'T'HH:MM:ss'Z'",ru:"dd.mm.yyyy HH:MM",short_ru:"dd.mm.yyyy",date:"dd.mm.yy",date_time:"dd.mm.yy HH:MM"},$p.ajax=new function(){function e(e,t,n,r,i){return new Promise(function(s,o){var u=new XMLHttpRequest;typeof window!="undefined"&&dhx4.isIE&&(t=encodeURI(t));if(r){var a,f;typeof r=="object"&&r.username&&r.hasOwnProperty("password")?(a=r.username,f=r.password):$p.ajax.username&&$p.ajax.authorized?(a=$p.ajax.username,f=$p.ajax.password):(a=$p.wsql.get_user_param("user_name"),f=$p.wsql.get_user_param("user_pwd"),!a&&$p.job_prm&&$p.job_prm.guest_name&&(a=$p.job_prm.guest_name,f=$p.job_prm.guest_pwd)),u.open(e,t,!0,a,f),u.withCredentials=!0,u.setRequestHeader("Authorization","Basic "+btoa(unescape(encodeURIComponent(a+":"+f))))}else u.open(e,t,!0);i&&i.call(this,u),e!="GET"?!this.hide_headers&&!r.hide_headers&&(u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.setRequestHeader("X-Requested-With","XMLHttpRequest")):n=null,u.onload=function(){u.status==200&&(u.response instanceof Blob||u.response.substr(0,9)!=="<!DOCTYPE")?(u.responseURL==undefined&&(u.responseURL=t),s(u)):u.response?o({message:u.statusText,description:u.response,status:u.status}):o(Error(u.statusText))},u.onerror=function(){o(Error("Network Error"))},u.send(n)})}this.username="",this.password="",this.authorized=!1,this.get=function(n){return e.call(this,"GET",n)},this.post=function(n,r){return arguments.length==1?r="":arguments.length==2&&typeof r=="function"?(onLoad=r,r=""):r=String(r),e.call(this,"POST",n,r)},this.get_ex=function(n,r,i){return e.call(this,"GET",n,null,r,i)},this.post_ex=function(n,r,i,s){return e.call(this,"POST",n,r,i,s)},this.put_ex=function(n,r,i,s){return e.call(this,"PUT",n,r,i,s)},this.patch_ex=function(n,r,i,s){return e.call(this,"PATCH",n,r,i,s)},this.delete_ex=function(n,r,i){return e.call(this,"DELETE",n,null,r,i)},this.get_and_show_blob=function(e,t,n){function r(t){return e=window.URL.createObjectURL(t.response),s=window.open(e,"wnd_print",i),s.onload=function(t){window.URL.revokeObjectURL(e)},s}var i="menubar=no,toolbar=no,location=no,status=no,directories=no,resizable=yes,scrollbars=yes",s;return!n||n.toLowerCase().indexOf("post")!=-1?this.post_ex(e,typeof t=="object"?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(r):this.get_ex(e,t,function(e){e.responseType="blob"}).then(r)},this.get_and_save_blob=function(e,t,n){return this.post_ex(e,typeof t=="object"?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(function(e){require("filesaver").saveAs(e.response,n)})},this.default_attr=function(e,t){e.url||(e.url=t),e.username||(e.username=this.username),e.password||(e.password=this.password),e.hide_headers=!0}},$p.m={point_pos:function(e,t,n,r,i,s){return Math.abs(n-i)<.2?(e-n)*(r-s):Math.abs(r-s)<.2?(t-r)*(i-n):(t-r)*(i-n)-(s-r)*(e-n)},arc_cntr:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d;if(s){var v=e,m=t;e=n,t=r,n=v,r=m}return e!=n?(o=(e*e-n*n-r*r+t*t)/(2*(e-n)),u=(r-t)/(e-n),a=u*u+1,f=-2*((e-o)*u+t),l=(e-o)*(e-o)-i*i+t*t,c=(-f+Math.sqrt(f*f-4*a*l))/(2*a),h=o+u*c,p=(-f-Math.sqrt(f*f-4*a*l))/(2*a),d=o+u*p):(o=(t*t-r*r-n*n+e*e)/(2*(t-r)),u=(n-e)/(t-r),a=u*u+1,f=-2*((t-o)*u+e),l=(t-o)*(t-o)-i*i+e*e,h=(-f-Math.sqrt(f*f-4*a*l))/(2*a),c=o+u*h,d=(-f+Math.sqrt(f*f-4*a*l))/(2*a),p=o+u*d),$p.m.point_pos(h,c,e,t,n,r)>0?{x:h,y:c}:{x:d,y:p}},arc_point:function(e,t,n,r,i,s,o){var u={x:(e+n)/2,y:(t+r)/2};if(i>0){var a=e-n,f=t-r,l=i*i-(a*a+f*f)/4,c,h,p;l>=0&&(p=$p.m.arc_cntr(e,t,n,r,i,s),a=p.x-u.x,f=u.y-p.y,c=Math.sqrt(a*a+f*f),o?h=i+Math.sqrt(l):h=i-Math.sqrt(l),u.x+=a*h/c,u.y+=f*h/c)}return u}},$p.blank=new function(){this.date=new Date("0001-01-01"),this.guid="00000000-0000-0000-0000-000000000000",this.by_type=function(e){var t;return e.is_ref?t=$p.blank.guid:e.date_part?t=$p.blank.date:e.digits?t=0:e.types&&e.types[0]=="boolean"?t=!1:t="",t}},$p.is_guid=function(e){return typeof e!="string"||e.length<36?!1:(e.length>36&&(e=e.substr(0,36)),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e))},$p.is_empty_guid=function(e){return!e||e===$p.blank.guid},$p.generate_guid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t=="x"?n:n&7|8).toString(16)})},$p.fix_guid=function(e,t){if(!e||typeof e!="string"){if(e instanceof DataObj)return e.ref;if(e&&typeof e=="object")if(e.presentation){if(e.ref)return e.ref;if(e.name)return e.name}else e=typeof e.ref=="object"&&e.ref.hasOwnProperty("ref")?e.ref.ref:e.ref}return $p.is_guid(e)||t===!1?e:t?$p.generate_guid():$p.blank.guid},$p.fix_number=function(e,t){var n=parseFloat(e);return isNaN(n)?t?0:e:n},$p.fix_boolean=function(e){return typeof e=="string"?!!e&&e.toLowerCase()!="false":!!e},$p.fix_date=function(e,t){var n=/(^\d{1,4}[\.|\\/|-]\d{1,2}[\.|\\/|-]\d{1,4})(\s*(?:0?[1-9]:[0-5]|1(?=[012])\d:[0-5])\d\s*[ap]m)?$/;if(e instanceof Date)return e;if(e&&typeof e=="string"&&n.test(e.substr(0,10))){var r=e.split(" "),i=r[0].split("."),s,o;i.length==1&&(i=r[0].split("/"),i.length==1&&(i=r[0].split("-")));if(i.length==3&&i[2].length==4){o=i[2]+"-"+i[1]+"-"+i[0];for(var u=1;u<r.length;u++)o+=" "+r[u];s=new Date(o)}else s=new Date(e);if(s&&s.getFullYear()>0)return s}return t?$p.blank.date:e},$p.date_add_day=function(e,t){var n=new Date;return n.setDate(e.getDate()+t),n},$p.cancel_bubble=function(e){var t=e||event;return t&&t.stopPropagation&&t.stopPropagation(),t&&!t.cancelBubble&&(t.cancelBubble=!0),!1},$p.msg=new Messages,$p.iface=new InterfaceObjs,$p.Modifiers=Modifiers,$p.eve=new AppEvents,$p.__define("modifiers",{value:new Modifiers,enumerable:!1,configurable:!1}),$p.wsql=new WSQL;var msg=$p.msg;$p.dateFormat.i18n={dayNames:["Вс","Пн","Вт","Ср","Чт","Пт","Сб","Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],monthNames:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек","Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"]},typeof window!="undefined"&&"dhx4"in window&&(dhx4.dateFormat.ru="%d.%m.%Y",dhx4.dateLang="ru",dhx4.dateStrings={ru:{monthFullName:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShortName:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFullName:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShortName:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]}}),$p.msg.russian_names=function(){$p.job_prm.russian_names&&(window.__define({"Метаданные":{get:function(){return _md},enumerable:!1},"Справочники":{get:function(){return _cat},enumerable:!1},"Документы":{get:function(){return _doc},enumerable:!1},"РегистрыСведений":{get:function(){return _ireg},enumerable:!1},"РегистрыНакопления":{get:function(){return _areg},enumerable:!1},"РегистрыБухгалтерии":{get:function(){return _aссreg},enumerable:!1},"Обработки":{get:function(){return _dp},enumerable:!1},"Отчеты":{get:function(){return _rep},enumerable:!1},"ОбластьКонтента":{get:function(){return $p.iface.docs},enumerable:!1},"Сообщить":{get:function(){return $p.msg.show_msg},enumerable:!1},"Истина":{value:!0,enumerable:!1},"Ложь":{value:!1,enumerable:!1}}),DataManager.prototype.__define({"ФормаВыбора":{get:function(){return this.form_selection},enumerable:!1},"ФормаОбъекта":{get:function(){return this.form_obj},enumerable:!1},"Найти":{get:function(){return this.find},enumerable:!1},"НайтиСтроки":{get:function(){return this.find_rows},enumerable:!1},"НайтиПоНаименованию":{get:function(){return this.by_name},enumerable:!1}}),DataObj.prototype.__define({"ФормаОбъекта":{get:function(){return this.form_obj},enumerable:!1}}))},$p.fias=function(){},function(e){e.toString=function(){return"Коды адресного классификатора"},e.types=["владение","здание","помещение"],e[1010]={name:"дом",type:1,order:1,fid:2,syn:[" д."," д "," дом"]},e[1020]={name:"владение",type:1,order:2,fid:1,syn:[" вл."," вл "," влад."," влад "," владен."," владен "," владение"]},e[1030]={name:"домовладение",type:1,order:3,fid:3},e[1050]={name:"корпус",type:2,order:1,syn:[" к."," к "," корп."," корп ","корпус"]},e[1060]={name:"строение",type:2,order:2,fid:1,syn:[" стр."," стр "," строен."," строен ","строение"]},e[1080]={name:"литера",type:2,order:3,fid:3,syn:[" л."," л "," лит."," лит ","литера"]},e[1070]={name:"сооружение",type:2,order:4,fid:2,syn:[" соор."," соор "," сооруж."," сооруж ","сооружение"]},e[1040]={name:"участок",type:2,order:5,syn:[" уч."," уч ","участок"]},e[2010]={name:"квартира",type:3,order:1,syn:["кв.","кв ","кварт.","кварт ","квартира","-"]},e[2030]={name:"офис",type:3,order:2,syn:["оф.","оф ","офис","-"]},e[2040]={name:"бокс",type:3,order:3},e[2020]={name:"помещение",type:3,order:4},e[2050]={name:"комната",type:3,order:5,syn:["комн.","комн ","комната"]},e[101e5]={name:"Почтовый индекс"},e[102e5]={name:"Адресная точка"},e[103e5]={name:"Садовое товарищество"},e[104e5]={name:"Элемент улично-дорожной сети, планировочной структуры дополнительного адресного элемента"},e[105e5]={name:"Промышленная зона"},e[106e5]={name:"Гаражно-строительный кооператив"},e[107e5]={name:"Территория"}}($p.fias),msg.store_url_od="https://chrome.google.com/webstore/detail/hcncallbdlondnoadgjomnhifopfaage",msg.align_node_right="Уравнять вертикально вправо",msg.align_node_bottom="Уравнять горизонтально вниз",msg.align_node_top="Уравнять горизонтально вверх",msg.align_node_left="Уравнять вертикально влево",msg.align_set_right="Установить размер сдвигом вправо",msg.align_set_bottom="Установить размер сдвигом вниз",msg.align_set_top="Установить размер сдвигом вверх",msg.align_set_left="Установить размер сдвигом влево",msg.align_invalid_direction="Неприменимо для элемента с данной ориентацией",msg.argument_is_not_ref="Аргумент не является ссылкой",msg.addr_title="Ввод адреса",msg.cache_update_title="Обновление кеша браузера",msg.cache_update="Выполняется загрузка измененных файлов<br/>и их кеширование в хранилище браузера",msg.delivery_area_empty="Укажите район доставки",msg.empty_login_password="Не указаны имя пользователя или пароль",msg.empty_response="Пустой ответ сервера",msg.empty_geocoding="Пустой ответ геокодера. Вероятно, отслеживание адреса запрещено в настройках браузера",msg.error_auth="Авторизация пользователя не выполнена",msg.error_critical="Критическая ошибка",msg.error_metadata="Ошибка загрузки метаданных конфигурации",msg.error_network="Ошибка сети или сервера - запрос отклонен",msg.error_rights="Ограничение доступа",msg.file_size="Запрещена загрузка файлов<br/>размером более ",msg.file_confirm_delete="Подтвердите удаление файла ",msg.file_new_date="Файлы на сервере обновлены<br /> Рекомендуется закрыть браузер и войти<br />повторно для применения обновления",msg.file_new_date_title="Версия файлов",msg.init_catalogues="Загрузка справочников с сервера",msg.init_catalogues_meta=": Метаданные объектов",msg.init_catalogues_tables=": Реструктуризация таблиц",msg.init_catalogues_nom=": Базовые типы + номенклатура",msg.init_catalogues_sys=": Технологические справочники",msg.init_login="Укажите имя пользователя и пароль",msg.requery="Повторите попытку через 1-2 минуты",msg.limit_query="Превышено число обращений к серверу<br/>Запросов за минуту:%1<br/>Лимит запросов:%2<br/>"+msg.requery,msg.long_operation="Длительная операция",msg.main_title="Окнософт: заказ дилера ",msg.meta_cat="Справочники",msg.meta_doc="Документы",msg.meta_cch="Планы видов характеристик",msg.meta_cacc="Планы счетов",msg.meta_ireg="Регистры сведений",msg.meta_areg="Регистры накопления",msg.meta_mgr="Менеджер",msg.meta_cat_mgr="Менеджер справочников",msg.meta_doc_mgr="Менеджер документов",msg.meta_enn_mgr="Менеджер перечислений",msg.meta_ireg_mgr="Менеджер регистров сведений",msg.meta_areg_mgr="Менеджер регистров накопления",msg.meta_accreg_mgr="Менеджер регистров бухгалтерии",msg.meta_dp_mgr="Менеджер обработок",msg.meta_reports_mgr="Менеджер отчетов",msg.meta_charts_of_accounts_mgr="Менеджер планов счетов",msg.meta_charts_of_characteristic_mgr="Менеджер планов видов характеристик",msg.meta_extender="Модификаторы объектов и менеджеров",msg.no_metadata="Не найдены метаданные объекта '%1'",msg.no_selected_row="Не выбрана строка табличной части '%1'",msg.no_dhtmlx="Библиотека dhtmlx не загружена",msg.not_implemented="Не реализовано в текущей версии",msg.offline_request="Запрос к серверу в автономном режиме",msg.onbeforeunload="Окнософт: легкий клиент. Закрыть программу?",msg.order_sent_title="Подтвердите отправку заказа",msg.order_sent_message="Отправленный заказ нельзя изменить.<br/>После проверки менеджером<br/>он будет запущен в работу",msg.request_title="Окнософт: Запрос регистрации",msg.request_message="Заявка зарегистрирована. После обработки менеджером будет сформировано ответное письмо",msg.select_from_list="Выбор из списка",msg.select_grp="Укажите группу, а не элемент",msg.select_elm="Укажите элемент, а не группу",msg.select_file_import="Укажите файл для импорта",msg.srv_overload="Сервер перегружен",msg.sub_row_change_disabled="Текущая строка подчинена продукции.<br/>Строку нельзя изменить-удалить в документе<br/>только через построитель",msg.sync_script="Обновление скриптов приложения:",msg.sync_data="Синхронизация с сервером выполняется:<br />* при первом старте программы<br /> * при обновлении метаданных<br /> * при изменении цен или технологических справочников",msg.sync_break="Прервать синхронизацию",msg.sync_no_data="Файл не содержит подходящих элементов для загрузки",msg.unsupported_browser_title="Браузер не поддерживается",msg.unsupported_browser="Несовместимая версия браузера<br/>Рекомендуется Google Chrome",msg.supported_browsers="Рекомендуется Chrome, Safari или Opera",msg.unsupported_mode_title="Режим не поддерживается",msg.unsupported_mode="Программа не установлена<br/> в <a href='"+msg.store_url_od+"'>приложениях Google Chrome</a>",msg.unknown_error="Неизвестная ошибка в функции '%1'",msg.value="Значение",msg.bld_constructor="Конструктор объектов графического построителя",msg.bld_title="Графический построитель",msg.bld_empty_param="Не заполнен обязательный параметр <br />",msg.bld_not_product="В текущей строке нет изделия построителя",msg.bld_not_draw="Отсутствует эскиз или не указана система профилей",msg.bld_wnd_title="Построитель изделия № ",msg.bld_from_blocks_title="Выбор типового блока",msg.bld_from_blocks="Текущее изделие будет заменено конфигурацией типового блока. Продолжить?",msg.bld_split_imp="В параметрах продукции<br />'%1'<br />запрещены незамкнутые контуры<br />Для включения деления импостом,<br />установите это свойство в 'Истина'",$p.is_data_obj=function(e){return e&&e instanceof DataObj},$p.fetch_type=function(e,t){var n=e;return t.is_ref?n=$p.fix_guid(e):t.date_part?n=$p.fix_date(e,!0):t.digits?n=$p.fix_number(e,!0):t.types[0]=="boolean"&&(n=$p.fix_boolean(e)),n},$p.is_equal=function(e,t){return e==t?!0:typeof e==typeof t?!1:$p.fix_guid(e,false)==$p.fix_guid(t,false)},$p._find=function(e,t){var n,r,i;if(typeof t!="object")for(r in e){n=e[r];for(var s in n)if(typeof n[s]!="function"&&$p.is_equal(n[s],t))return n}else for(r in e){n=e[r],i=!0;for(var s in t)if(typeof n[s]!="function"&&!$p.is_equal(n[s],t[s])){i=!1;break}if(i)return n}},$p._find_rows=function(e,t,n){var r,i,s,o,u=[],a,f=0;t&&(t._top?(a=t._top,delete t._top):a=300);for(s in e){i=e[s],r=!0;if(t)if(typeof t=="function")r=t(i);else for(o in t){if(o.substr(0,1)=="_")continue;if(typeof t[o]=="function"){r=t[o](i,o);if(!r)break}else if(o=="or"&&Array.isArray(t[o])){r=t[o].some(function(e){var t=Object.keys(e)[0];return e[t].hasOwnProperty("like")?i[t].toLowerCase().indexOf(e[t].like.toLowerCase())!=-1:$p.is_equal(i[t],e[t])});if(!r)break}else if(t[o].hasOwnProperty("like")){if(i[o].toLowerCase().indexOf(t[o].like.toLowerCase())==-1){r=!1;break}}else if(t[o].hasOwnProperty("not")){if($p.is_equal(i[o],t[o].not)){r=!1;break}}else if(t[o].hasOwnProperty("in")){r=t[o].in.some(function(e){return $p.is_equal(e,i[o])});if(!r)break}else if(!$p.is_equal(i[o],t[o])){r=!1;break}}if(r){if(n){if(n.call(this,i)===!1)break}else u.push(i);if(a){f++;if(f>=a)break}}}return u};var _cat=$p.cat=new function(){this.toString=function(){return $p.msg.meta_cat_mgr}},_enm=$p.enm=new function(){this.toString=function(){return $p.msg.meta_enn_mgr}},_doc=$p.doc=new function(){this.toString=function(){return $p.msg.meta_doc_mgr}},_ireg=$p.ireg=new function(){this.toString=function(){return $p.msg.meta_ireg_mgr}},_areg=$p.areg=new function(){this.toString=function(){return $p.msg.meta_areg_mgr}},_aссreg=$p.aссreg=new function(){this.toString=function(){return $p.msg.meta_accreg_mgr}},_dp=$p.dp=new function(){this.toString=function(){return $p.msg.meta_dp_mgr}},_rep=$p.rep=new function(){this.toString=function(){return $p.msg.meta_reports_mgr}},_cacc=$p.cacc=new function(){this.toString=function(){return $p.msg.meta_charts_of_accounts_mgr}},_cch=$p.cch=new function(){this.toString=function(){return $p.msg.meta_charts_of_characteristic_mgr}},_md;$p.Meta=Meta,$p.record_log=function(e){$p.ireg&&$p.ireg.$log?$p.ireg.$log.record(e):console.log(e)},_cat.load_soap_to_grid=function(e,t,n){function r(e){e.substr(0,1)=="{"&&(e=JSON.parse(e)),typeof e=="string"?t.parse(e,function(){n&&n(e)},"xml"):n&&n(e)}t.xmlFileUrl="exec";var i=_md.mgr_by_class_name(e.class_name);!i.cachable&&($p.job_prm.rest||$p.job_prm.irest_enabled||e.rest)?i.rest_selection(e).then(r).catch($p.record_log):_load(e).then(r).catch($p.record_log)},DataManager.prototype.__define("family_name",{get:function(){return $p.msg["meta_"+this.class_name.split(".")[0]+"_mgr"].replace($p.msg.meta_mgr+" ","")},enumerable:!1}),DataManager.prototype.register_ex=function(){},DataManager.prototype.sync_grid=function(e,t){var n;!this.cachable&&($p.job_prm.rest||$p.job_prm.irest_enabled||t.rest)&&(t.action=="get_tree"?n=this.rest_tree():t.action=="get_selection"&&(n=this.rest_selection()))},DataManager.prototype.get_option_list=function(e,t){function n(t){return $p.is_equal(t.value,e)&&(t.selected=!0),t}var r=this,i=[],s=0,o,u,a;t.presentation&&(o=r.metadata().input_by_string)&&(u=t.presentation.like,delete t.presentation,t.or=[],o.forEach(function(e){a={},a[e]={like:u},t.or.push(a)}));if(r.cachable||t&&t._local)return r.find_rows(t,function(e){i.push(n({text:e.presentation,value:e.ref}))}),Promise.resolve(i);var f={selection:t,top:t._top};return delete t._top,r instanceof DocManager?f.fields=["ref","date","number_doc"]:r.metadata().main_presentation_name?f.fields=["ref","name"]:f.fields=["ref","id"],_rest.load_array(f,r).then(function(e){return e.forEach(function(e){i.push(n({text:r instanceof DocManager?e.number_doc+" от "+$p.dateFormat(e.date,$p.dateFormat.masks.ru):e.name||e.id,value:e.ref}))}),i})},DataManager.prototype.tabular_captions=function(e,t){},DataManager.prototype.get_property_grid_xml=function(e,t,n){var r=this,i,s,o,u,a,f,l,c="<rows>",h=function(){if(e)return;o=r.metadata();if(o.form&&o.form.obj&&o.form.obj.head)e=o.form.obj.head;else{e={" ":[]},t instanceof CatObj?(o.code_length&&e[" "].push("id"),o.main_presentation_name&&e[" "].push("name")):t instanceof DocObj&&(e[" "].push("number_doc"),e[" "].push("date"));if(!t.is_folder)for(i in o.fields)o.fields[i].hide||e[" "].push(i);o.tabular_sections.extra_fields&&(e["Дополнительные реквизиты"]=[])}},p=function(e,t){$p.is_data_obj(e)?f=e.presentation:f=e,t.type.is_ref||(t.type.date_part?f=$p.dateFormat(f,""):t.type.types[0]=="boolean"&&(f=f?"1":"0"))},d=function(e){a=_md.control_by_type(o.type),p(e,o)},v=function(e,i){if(i){var s=e.property||e.param||e["Параметр"],h=e["value"]!=undefined?e.value:e["Значение"];s.empty()?(l=i+"|"+"empty",a="ro",f="",o={synonym:"?"}):(o={synonym:s.presentation,type:s.type},l=i+"|"+s.ref,d(h),a=="edn"&&(a="calck"),s.mandatory&&(a+='" class="cell_mandatory'))}else if(typeof e=="object")o={synonym:e.synonym},l=e.id,a=e.type,f="",e.hasOwnProperty("txt")?f=e.txt:(u=t[l])!==undefined&&p(u,_md.get(r.class_name,l));else if(n&&n.meta&&(o=n.meta[e])!==undefined)l=e,d(u=t[e]);else{if((u=t[e])===undefined)return;o=_md.get(r.class_name,l=e),d(u)}c+='<row id="'+l+'"><cell>'+(o.synonym||o.name)+'</cell><cell type="'+a+'">'+f+"</cell></row>"};h();for(i in e){i!=" "&&(c+='<row open="1"><cell>'+i+"</cell>");for(s in e[i])v(e[i][s]);if(n&&i==n.title&&t[n.ts]){var m=!1;t[n.ts].find_rows(n.selection,function(e){v(e,n.ts)})}i!=" "&&(c+="</row>")}return c+="</rows>",c},DataManager.prototype.__define("table_name",{get:function(){return this.class_name.replace(".","_")},enumerable:!1}),DataManager.prototype.print=function(e,t,n){function r(e){n&&n.progressOff&&n.progressOff(),e&&e.focus()}n&&n.progressOn&&n.progressOn();var i={};$p.ajax.default_attr(i,$p.job_prm.irest_url()),i.url+=this.rest_name+"(guid'"+$p.fix_guid(e)+"')"+"/Print(model="+t+", browser_uid="+$p.wsql.get_user_param("browser_uid")+")",$p.ajax.get_and_show_blob(i.url,i,"get").then(r).catch($p.record_log),setTimeout(r,3e3)},DataManager.prototype.printing_plates=function(){var e={},t=this;return $p.job_prm.offline?Promise.resolve({}):(t.metadata().printing_plates&&(t._printing_plates=t.metadata().printing_plates),t._printing_plates?Promise.resolve(t._printing_plates):($p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=t.rest_name+"/Print()",$p.ajax.get_ex(e.url,e).then(function(e){return t.__define("_printing_plates",{value:JSON.parse(e.response),enumerable:!1}),t._printing_plates}).catch(function(e){return{}})))},RefDataManager._extend(DataManager),RefDataManager.prototype.get_sql_struct=function(e){function t(){function t(){var e=[],t="_t_.ref, _t_.`deleted`";return s.form&&s.form.selection?s.form.selection.fields.forEach(function(t){e.push(t)}):i instanceof DocManager?(e.push("posted"),e.push("date"),e.push("number_doc")):(s.hierarchical&&s.group_hierarchy?e.push("is_folder"):e.push("0 as is_folder"),i instanceof ChartOfAccountManager?(e.push("id"),e.push("name as presentation")):s.main_presentation_name?e.push("name as presentation"):s.code_length?e.push("id as presentation"):e.push("'...' as presentation"),s.has_owners&&e.push("owner"),s.code_length&&e.push("id")),e.forEach(function(e){e.indexOf(" as ")!=-1?t+=", "+e:t+=_md.sql_mask(e,!0)}),t}function n(){var e="",t;if(s.form&&s.form.selection)for(var n in s.form.selection.fields){if(s.form.selection.fields[n].indexOf(" as ")==-1||s.form.selection.fields[n].indexOf("_t_.")!=-1)continue;t=s.form.selection.fields[n].split(" as "),t[0]=t[0].split("."),t[0].length>1&&(e&&(e+="\n"),e+="left outer join "+t[0][0]+" on "+t[0][0]+".ref = _t_."+t[1])}return e}function r(){var t;i instanceof ChartOfAccountManager?t=" WHERE ("+(h?0:1):s.hierarchical?s.has_owners?t=" WHERE ("+(a||h?1:0)+" OR _t_.parent = '"+f+"') AND ("+(l==$p.blank.guid?1:0)+" OR _t_.owner = '"+l+"') AND ("+(h?0:1):t=" WHERE ("+(a||h?1:0)+" OR _t_.parent = '"+f+"') AND ("+(h?0:1):s.has_owners?t=" WHERE ("+(l==$p.blank.guid?1:0)+" OR _t_.owner = '"+l+"') AND ("+(h?0:1):t=" WHERE ("+(h?0:1);if(i.sql_selection_where_flds)t+=i.sql_selection_where_flds(h);else if(i instanceof DocManager)t+=" OR _t_.number_doc LIKE '"+h+"'";else{if(s.main_presentation_name||i instanceof ChartOfAccountManager)t+=" OR _t_.name LIKE '"+h+"'";s.code_length&&(t+=" OR _t_.id LIKE '"+h+"'")}return t+=") AND (_t_.ref != '"+$p.blank.guid+"')",e.selection&&typeof e.selection!="function"&&e.selection.forEach(function(e){for(var n in e)typeof e[n]=="function"?t+="\n AND "+e[n](i,n)+" ":s.fields.hasOwnProperty(n)?e[n]===!0?t+="\n AND _t_."+n+" ":e[n]===!1?t+="\n AND (not _t_."+n+") ":typeof e[n]=="string"||typeof e[n]=="object"?t+="\n AND (_t_."+n+" = '"+e[n]+"') ":t+="\n AND (_t_."+n+" = "+e[n]+") ":n=="is_folder"&&s.hierarchical&&s.group_hierarchy}),t}function o(){return i instanceof ChartOfAccountManager?"ORDER BY id":s.hierarchical?s.group_hierarchy?"ORDER BY _t_.is_folder desc, is_initial_value, presentation":"ORDER BY _t_.parent desc, is_initial_value, presentation":"ORDER BY is_initial_value, presentation"}function u(){function t(t){t?(p=e.set_parent=t.parent.ref,f=p,a=!1):(!!h||!!a)&&i.class_name=="cat.base_blocks"&&(l==$p.blank.guid&&(l=_cat.bases.predefined("main")),f=i.first_folder(l).ref),h&&h.indexOf("%")==-1&&(h="%"+h+"%")}s.has_owners&&(l=e.owner,e.selection&&typeof e.selection!="function"&&e.selection.forEach(function(e){e.owner&&(l=typeof e.owner=="object"?e.owner.valueOf():e.owner,delete e.owner)}),l||(l=$p.blank.guid)),c!=$p.blank.guid&&a?s.hierarchical?t(i.get(c,!1)):t():t()}var a=!e.parent,f=e.parent||$p.blank.guid,l,c=e.initial_value||$p.blank.guid,h=e.filter||"",p=$p.blank.guid;u();var d;return i.sql_selection_list_flds?d=i.sql_selection_list_flds(c):d=("SELECT %2, case when _t_.ref = '"+c+"' then 0 else 1 end as is_initial_value FROM `"+i.table_name+"` AS _t_ %j %3 %4 LIMIT 300").replace("%2",t()).replace("%j",n()),d.replace("%3",r()).replace("%4",o())}function n(){var e="CREATE TABLE IF NOT EXISTS `"+i.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, `deleted` BOOLEAN, lc_changed INT";i instanceof DocManager?e+=", posted BOOLEAN, date Date, number_doc CHAR":e+=", id CHAR, name CHAR, is_folder BOOLEAN";for(u in s.fields)e+=_md.sql_mask(u)+_md.sql_type(i,u,s.fields[u].type);for(u in s.tabular_sections)e+=", `ts_"+u+"` JSON";return e+=")",e}function r(){var e=["ref","deleted","lc_changed"],t="INSERT INTO `"+i.table_name+"` (ref, `deleted`, lc_changed",n="(?";i.class_name.substr(0,3)=="cat"?(t+=", id, name, is_folder",e.push("id"),e.push("name"),e.push("is_folder")):i.class_name.substr(0,3)=="doc"&&(t+=", posted, date, number_doc",e.push("posted"),e.push("date"),e.push("number_doc"));for(u in s.fields)t+=_md.sql_mask(u),e.push(u);for(u in s.tabular_sections)t+=", `ts_"+u+"`",e.push("ts_"+u);t+=") VALUES ";for(u=1;u<e.length;u++)n+=", ?";return n+=")",t+=n,{sql:t,fields:e,values:n}}var i=this,s=i.metadata(),o={},u,a=e&&e.action?e.action:"create_table";return a=="create_table"?o=n():["insert","update","replace"].indexOf(a)!=-1?o[i.table_name]=r():a=="select"?o="SELECT * FROM `"+i.table_name+"` WHERE ref = ?":a=="select_all"?o="SELECT * FROM `"+i.table_name+"`":a=="delete"?o="DELETE FROM `"+i.table_name+"` WHERE ref = ?":a=="drop"?o="DROP TABLE IF EXISTS `"+i.table_name+"`":a=="get_tree"?!e.filter||e.filter.is_folder?o="SELECT ref, parent, name as presentation FROM `"+i.table_name+"` WHERE is_folder order by parent, name":o="SELECT ref, parent, name as presentation FROM `"+i.table_name+"` order by parent, name":a=="get_selection"&&(o=t()),o},RefDataManager.prototype.caption_flds=function(e){function t(e,t,n,r,i,s){this.id=e,this.width=t,this.type=n,this.align=r,this.sort=i,this.caption=s}var n='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>',r=[],i=this.metadata(),s="";i.form&&i.form.selection?r=i.form.selection.cols:this instanceof DocManager?(r.push(new t("date","120","ro","left","server","Дата")),r.push(new t("number_doc","120","ro","left","server","Номер"))):this instanceof ChartOfAccountManager?(r.push(new t("id","120","ro","left","server","Код")),r.push(new t("presentation","*","ro","left","server","Наименование"))):r.push(new t("presentation","*","ro","left","server","Наименование"));if(e.get_header&&r.length){s="<head>";for(var o in r)s+=n.replace("%1",r[o].id).replace("%2",r[o].width).replace("%3",r[o].type).replace("%4",r[o].align).replace("%5",r[o].sort).replace("%6",r[o].caption);s+="</head>"}return{head:s,acols:r}},DataProcessorsManager._extend(DataManager),EnumManager._extend(RefDataManager),EnumManager.prototype.get_sql_struct=function(e){var t,n=e&&e.action?e.action:"create_table";return n=="create_table"?t="CREATE TABLE IF NOT EXISTS `"+this.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, sequence INT, synonym CHAR)":["insert","update","replace"].indexOf(n)!=-1?(t={},t[this.table_name]={sql:"INSERT INTO `"+this.table_name+"` (ref, sequence, synonym) VALUES (?, ?, ?)",fields:["ref","sequence","synonym"],values:"(?, ?, ?)"}):n=="delete"&&(t="DELETE FROM `"+this.table_name+"` WHERE ref = ?"),t},EnumManager.prototype.get_option_list=function(e,t){function n(t){return $p.is_equal(t.value,e)&&(t.selected=!0),t}var r=[],i="";if(t)for(var s in t){if(s.substr(0,1)=="_")continue;i=t[s]}return typeof i=="object"&&(i.like?i=i.like:i=""),i=i.toLowerCase(),this.alatable.forEach(function(e){if(i)if(!e.synonym||e.synonym.toLowerCase().indexOf(i)==-1)return;r.push(n({text:e.synonym||"",value:e.ref}))}),Promise.resolve(r)},RegisterManager._extend(DataManager),RegisterManager.prototype.get_sql_struct=function(e){function t(){var e="CREATE TABLE IF NOT EXISTS `"+i.table_name+"` (",t=!0;for(u in s.dimensions)t?(e+="`"+u+"`",t=!1):e+=_md.sql_mask(u),e+=_md.sql_type(i,u,s.dimensions[u].type);for(u in s.resources)e+=_md.sql_mask(u)+_md.sql_type(i,u,s.resources[u].type);e+=", PRIMARY KEY (",t=!0;for(u in s.dimensions)t?(e+="`"+u+"`",t=!1):e+=_md.sql_mask(u);return e+="))",e}function n(){var e="INSERT OR REPLACE INTO `"+i.table_name+"` (",t=[],n=!0;for(u in s.dimensions)n?(e+=u,n=!1):e+=", "+u,t.push(u);for(u in s.resources)e+=", "+u,t.push(u);e+=") VALUES (?";for(u=1;u<t.length;u++)e+=", ?";return e+=")",{sql:e,fields:t}}function r(){var t="SELECT * FROM `"+i.table_name+"` WHERE ",n=!0;e._values=[];for(var r in e){if(r=="action"||r=="_values")continue;n?n=!1:t+=" and ",t+="`"+r+"`"+"=?",e._values.push(e[r])}return n&&(t+="1"),t}var i=this,s=i.metadata(),o={},u,a=e&&e.action?e.action:"create_table";return a=="create_table"?o=t():a in{insert:"",update:"",replace:""}?o[i.table_name]=n():a=="select"?o=r():a=="select_all"?o=r():a=="delete"?o="DELETE FROM `"+i.table_name+"` WHERE ref = ?":a=="drop"&&(o="DROP TABLE IF EXISTS `"+i.table_name+"`"),o},RegisterManager.prototype.get_ref=function(e){var t="",n,r=this.metadata().dimensions;e instanceof RegisterRow&&(e=e._obj);for(var i in r)t+=t?"_":"",r[i].type.is_ref?t+=$p.fix_guid(e[i]):!e[i]&&r[i].type.digits?t+="0":r[i].date_part?t+=$p.dateFormat(e[i]||$p.blank.date,$p.dateFormat.masks.atom):e[i]!=undefined?t+=String(e[i]):t+="$";return t},InfoRegManager._extend(RegisterManager),InfoRegManager.prototype.slice_first=function(e){},InfoRegManager.prototype.slice_last=function(e){},LogManager._extend(InfoRegManager),AccumRegManager._extend(RegisterManager),CatManager._extend(RefDataManager),CatManager.prototype.by_name=function(e){var t;return this.find_rows({name:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.by_id=function(e){var t;return this.find_rows({id:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.path=function(e){var t=[],n;e instanceof DataObj?n=e:n=this.get(e,!1,!0),n&&t.push({ref:n.ref,presentation:n.presentation});if(n&&this.metadata().hierarchical)for(;;){n=n.parent;if(n.empty())break;t.push({ref:n.ref,presentation:n.presentation})}return t},ChartOfCharacteristicManager._extend(CatManager),ChartOfAccountManager._extend(CatManager),DocManager._extend(RefDataManager),TabularSection.prototype.toString=function(){return"Табличная часть "+this._owner._manager.class_name+"."+this._name},TabularSection.prototype.get=function(e){return this._obj[e]._row},TabularSection.prototype.count=function(){return this._obj.length},TabularSection.prototype.clear=function(e){for(var t in this._obj)delete this._obj[t];this._obj.length=0,e||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.del=function(e){var t,n=this._obj,r=0;if(typeof e=="undefined")return;if(typeof e=="number")t=e;else if(n[e.row-1]._row===e)t=e.row-1;else for(var i in n)if(n[i]._row===e){t=Number(i),delete n[i]._row;break}if(t==undefined)return;n.splice(t,1);for(var i in n)r++,n[i].row=r;Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.find=function(e){var t=$p._find(this._obj,e);if(t)return t._row},TabularSection.prototype.find_rows=function(e,t){var n=this,r=t?function(e){return t.call(n,e._row)}:null;return $p._find_rows.call(n,n._obj,e,r)},TabularSection.prototype.swap=function(e,t){var n=this._obj[e];this._obj[e]=this._obj[t],this._obj[t]=n,Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.add=function(e,t){var n=new this._owner._manager._ts_сonstructors[this._name](this);e||(e={});for(var r in n._metadata.fields)n[r]=e[r]||"";return n._obj.row=this._obj.push(n._obj),n._obj.__define("_row",{value:n,enumerable:!1}),t||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name}),e=null,n},TabularSection.prototype.each=function(e){var t=this;t._obj.forEach(function(n){return e.call(t,n._row)})},TabularSection.prototype.load=function(e){var t=this,n;t.clear(!0),e instanceof TabularSection?n=e._obj:Array.isArray(e)&&(n=e),n&&n.forEach(function(e){t.add(e,!0)}),Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.sync_grid=function(e,t){var n={rows:[]},r=[];for(var i=0;i<e.getColumnCount();i++)r.push(e.getColumnId(i));e.clearAll(),this.find_rows(t,function(e){var t=[];r.forEach(function(n){$p.is_data_obj(e[n])?t.push(e[n].presentation):t.push(e[n])}),n.rows.push({id:e.row,data:t})});try{e.parse(n,"json")}catch(s){}e.callEvent("onGridReconstructed",[])},TabularSection.prototype.toJSON=function(){return this._obj},TabularSectionRow.prototype.__define("_metadata",{get:function(){return this._owner._owner._metadata.tabular_sections[this._owner._name]},enumerable:!1}),TabularSectionRow.prototype.__define("row",{get:function(){return this._obj.row||0},enumerable:!0}),TabularSectionRow.prototype.__define("_clone",{value:function(){return(new this._owner._owner._manager._ts_сonstructors[this._owner._name](this._owner))._mixin(this._obj)},enumerable:!1}),TabularSectionRow.prototype._getter=DataObj.prototype._getter,TabularSectionRow.prototype._setter=function(e,t){if(this._obj[e]==t)return;Object.getNotifier(this._owner._owner).notify({type:"row",row:this,tabular:this._owner._name,name:e,oldValue:this._obj[e]}),DataObj.prototype.__setter.call(this,e,t)},DataObj.prototype.valueOf=function(){return this.ref},DataObj.prototype.toJSON=function(){return this._obj},DataObj.prototype._getter=function(e){var t=this._metadata.fields[e].type,n,r;if(e=="type"&&typeof this._obj[e]=="object")return this._obj[e];if(e=="ref")return this._obj[e];if(!t.is_ref)return t.date_part?$p.fix_date(this._obj[e],!0):t.digits?$p.fix_number(this._obj[e],!0):t.types[0]=="boolean"?$p.fix_boolean(this._obj[e]):this._obj[e]||"";if(n=_md.value_mgr(this._obj,e,t))return n instanceof DataManager?n.get(this._obj[e],!1):$p.fetch_type(this._obj[e],n);if(this._obj[e])return console.log([e,t,this._obj]),null},DataObj.prototype.__setter=function(e,t){var n=this._metadata.fields[e].type,r;e=="type"&&t.types?this._obj[e]=t:e=="ref"?this._obj[e]=$p.fix_guid(t):n.is_ref?(this._obj[e]=$p.fix_guid(t),r=_md.value_mgr(this._obj,e,n,!1,t),r?r instanceof EnumManager?typeof t=="string"?this._obj[e]=t:t?typeof t=="object"&&(this._obj[e]=t.ref||t.name||""):this._obj[e]="":t&&t.presentation?(t.type&&!(t instanceof DataObj)&&delete t.type,r.create(t)):r instanceof DataManager||(this._obj[e]=$p.fetch_type(t,r)):typeof t!="object"&&(this._obj[e]=t)):n.date_part?this._obj[e]=$p.fix_date(t,!0):n.digits?this._obj[e]=$p.fix_number(t,!0):n.types[0]=="boolean"?this._obj[e]=$p.fix_boolean(t):this._obj[e]=t},DataObj.prototype.__notify=function(e){Object.getNotifier(this).notify({type:"update",name:e,oldValue:this._obj[e]})},DataObj.prototype._setter=function(e,t){if(this._obj[e]==t)return;this.__notify(e),this.__setter(e,t)},DataObj.prototype._getter_ts=function(e){return this._ts_(e)},DataObj.prototype._setter_ts=function(e,t){var n=this._ts_(e);n instanceof TabularSection&&Array.isArray(t)&&n.load(t)},DataObj.prototype.load=function(){function e(e){typeof e=="string"&&(e=JSON.parse(e));if($p.msg.check_soap_result(e))return;var n=$p.fix_guid(e);return t.is_new()&&!$p.is_empty_guid(n)&&t._set_loaded(n),t._mixin(e)}var t=this;return t._manager.cachable&&!t.is_new()?Promise.resolve(t):t.ref==$p.blank.guid?(t instanceof CatObj?t.id="000000000":t.number_doc="000000000",Promise.resolve(t)):$p.job_prm.rest||$p.job_prm.irest_enabled?_rest.load_obj(t):_load({class_name:t._manager.class_name,action:"load",ref:t.ref}).then(e)},DataObj.prototype.save=function(e,t){var n;return this._manager.handle_event(this,"before_save")===!1?Promise.resolve(this):(this instanceof DocObj&&$p.blank.date==this.date&&(this.date=new Date),$p.job_prm.offline?n=function(e){return Promise.resolve(e)}:n=$p.job_prm.irest_enabled?_rest.save_irest:_rest.save_rest,n(this,{post:e,operational:t}).then(function(e){return e._manager.handle_event(e,"after_save")}))},DataObj.prototype.empty=function(){return $p.is_empty_guid(this._obj.ref)},DataObj.prototype.__define("_metadata",{get:function(){return this._manager.metadata()},enumerable:!1}),DataObj.prototype.__define("ref",{get:function(){return this._obj.ref},set:function(e){this._obj.ref=$p.fix_guid(e)},enumerable:!0,configurable:!0}),DataObj.prototype.__define("deleted",{get:function(){return this._obj.deleted},set:function(e){this.__notify("deleted"),this._obj.deleted=!!e},enumerable:!0,configurable:!0}),DataObj.prototype.__define("data_version",{get:function(){return this._obj.data_version||""},set:function(e){this.__notify("data_version"),this._obj.data_version=String(e)},enumerable:!0}),DataObj.prototype.__define("lc_changed",{get:function(){return this._obj.lc_changed||0},set:function(e){this.__notify("lc_changed"),this._obj.lc_changed=$p.fix_number(e,!0)},enumerable:!0,configurable:!0}),CatObj._extend(DataObj),CatObj.prototype.__define("id",{get:function(){return this._obj.id||""},set:function(e){this.__notify("id"),this._obj.id=e},enumerable:!0}),CatObj.prototype.__define("name",{get:function(){return this._obj.name||""},set:function(e){this.__notify("name"),this._obj.name=String(e)},enumerable:!0}),DocObj._extend(DataObj),DocObj.prototype.__define("number_doc",{get:function(){return this._obj.number_doc||""},set:function(e){this.__notify("number_doc"),this._obj.number_doc=e},enumerable:!0}),DocObj.prototype.__define("date",{get:function(){return this._obj.date||$p.blank.date},set:function(e){this.__notify("date"),this._obj.date=$p.fix_date(e,!0)},enumerable:!0}),DocObj.prototype.__define("posted",{get:function(){return this._obj.posted||!1},set:function(e){this.__notify("posted"),this._obj.posted=$p.fix_boolean(e)},enumerable:!0}),DataProcessorObj._extend(DataObj),EnumObj._extend(DataObj),EnumObj.prototype.__define("order",{get:function(){return this._obj.sequence},set:function(e){this._obj.sequence=parseInt(e)},enumerable:!0}),EnumObj.prototype.__define("name",{get:function(){return this._obj.ref},set:function(e){this._obj.ref=String(e)},enumerable:!0}),EnumObj.prototype.__define("synonym",{get:function(){return this._obj.synonym||""},set:function(e){this._obj.synonym=String(e)},enumerable:!0}),EnumObj.prototype.__define("presentation",{get:function(){return this.synonym||this.name},enumerable:!1}),EnumObj.prototype.empty=function(){return this.ref=="_"},RegisterRow._extend(DataObj),RegisterRow.prototype.__define("_metadata",{get:function(){var e=this._manager.metadata();return e.fields||(e.fields={}._mixin(e.dimensions)._mixin(e.resources)),e},enumerable:!1}),RegisterRow.prototype.__define("ref",{get:function(){return this._manager.get_ref(this)},enumerable:!0});var _rest=$p.rest=new Rest;DataManager.prototype.__define("rest_name",{get:function(e){var t=this.class_name.split("."),n={cat:"Catalog",doc:"Document",ireg:"InformationRegister",areg:"AccumulationRegister",cch:"ChartOfCharacteristicTypes",cacc:"ChartOfAccounts"};return n[t[0]]+"_"+_md.syns_1с(t[1])+(e||"")},enumerable:!1}),DataManager.prototype.rest_tree=function(e){var t=this,n=t.metadata(),r=[],i=[],s,o,u,a;return $p.ajax.default_attr(e,!n.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),e.url+=this.rest_name+"?allowedOnly=true&$format=json&$top=1000&$select=Ref_Key,DeletionMark,Parent_Key,Description&$filter=IsFolder eq true",$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){for(var t=0;t<e.value.length;t++)o=e.value[t],s={ref:o.Ref_Key,deleted:o.DeletionMark,parent:o.Parent_Key,presentation:o.Description},i.push(s);return $p.iface.data_to_tree(i)})},DataManager.prototype.rest_selection=function(e){function t(){var e="$select=Ref_Key,DeletionMark";return r.form&&r.form.selection?r.form.selection.fields.forEach(function(e){i.push(e)}):n instanceof DocManager?(i.push("posted"),i.push("date"),i.push("number_doc")):(r.hierarchical&&r.group_hierarchy?i.push("is_folder"):i.push("0 as is_folder"),r.main_presentation_name?i.push("name as presentation"):r.code_length?i.push("id as presentation"):i.push("'...' as presentation"),r.has_owners&&i.push("owner"),r.code_length&&i.push("id")),i.forEach(function(t){var r;if(t.indexOf(" as ")!=-1){r=t.split(" as ")[0].split(".");if(r.length==1)t=r[0];else{if(r[0]!="_t_")return;t=r[1]}}if(t=="0")return;a=_md.syns_1с(t),_md.get(n.class_name,t).type.is_ref&&a.indexOf("_Key")==-1&&_md.get(n.class_name,t).type.types.length&&_md.get(n.class_name,t).type.types[0].indexOf("enm.")==-1&&(a+="_Key"),e+=","+a}),i.push("ref"),i.push("deleted"),e}if(e.action=="get_tree")return this.rest_tree(e);var n=this,r=n.metadata(),i=[],s=[],o,u,a,f,l=t(),c;return $p.ajax.default_attr(e,!r.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),e.url+=this.rest_name+"?allowedOnly=true&$format=json&$top=1000&"+l,_md.get(n.class_name,"date")&&(e.url+="&$filter="+_rest.filter_date("Date",e.date_from,e.date_till),c=!0),e.parent&&(e.url+=c?" and ":"&$filter=",e.url+="Parent_Key eq guid'"+e.parent+"'",c=!0),$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(t){for(var r=0;r<t.value.length;r++)u=t.value[r],o={},i.forEach(function(e){var t;if(e=="ref"){o[e]=u.Ref_Key;return}e.indexOf(" as ")!=-1?(t=e.split(" as ")[1],e=e.split(" as ")[0].split("."),e=e[e.length-1]):t=e,a=_md.syns_1с(e),f=_md.get(n.class_name,e),a.indexOf("_Key")==-1&&f.type.is_ref&&f.type.types.length&&f.type.types[0].indexOf("enm.")==-1&&(a+="_Key");if(f.type.date_part)o[t]=$p.dateFormat(u[a],$p.dateFormat.masks[f.type.date_part]);else if(f.type.is_ref)if(!u[a]||u[a]==$p.blank.guid)o[t]="";else{var r=_md.value_mgr(o,e,f.type,!1,u[a]);r?o[t]=r.get(u[a]).presentation:o[t]=""}else o[t]=u[a]}),s.push(o);return $p.iface.data_to_grid.call(n,s,e)})},InfoRegManager.prototype.rest_slice_last=function(e){e.period||(e.period=$p.date_add_day(new Date,1));var t=this,n=t.metadata(),r="Period=datetime'"+$p.dateFormat(e.period,$p.dateFormat.masks.isoDateTime)+"'",i="";for(var s in n.dimensions){if(e[s]===undefined)continue;var o=_md.syns_1с(s),u=n.dimensions[s];o.indexOf("_Key")==-1&&u.type.is_ref&&u.type.types.length&&u.type.types[0].indexOf("enm.")==-1?(o+="_Key",i&&(i+=" and "),i+=o+" eq guid'"+e[s].ref+"'"):(i&&(i+=" and "),u.type.digits?i+=o+" eq "+$p.fix_number(e[s]):u.type.date_part?i+=o+" eq datetime'"+$p.dateFormat(e[s],$p.dateFormat.masks.isoDateTime)+"'":i+=o+" eq '"+e[s]+"'")}return i&&(r+=",Condition='"+i+"'"),$p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=this.rest_name+"/SliceLast(%sl)?allowedOnly=true&$format=json&$top=1000".replace("%sl",r),_rest.ajax_to_data(e,t).then(function(e){return t.load_array(e)})},DataObj.prototype.to_atom=function(e){function t(e){var t=e._metadata.fields,n=e instanceof TabularSectionRow?"\n	<d:":"\n<d:";for(i in t){s=t[i],f=_md.syns_1с(i),l=e[i];if(l instanceof EnumObj)l=l.empty()?"":l.name;else if(l instanceof DataObj)f.indexOf("_Key")==-1&&(f+="_Key"),l=l.ref;else if(s.type.date_part)l.getFullYear()<1e3?l="0001-01-01T00:00:00Z":l=$p.dateFormat(l,$p.dateFormat.masks.atom);else if(l==undefined)continue;r+=n+f+">"+l+"</d:"+f+">"}}var n='<entry><category term="StandardODATA.%n" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"/>				\n<title type="text"/><updated>%d</updated><author/><summary/><content type="application/xml">				\n<m:properties xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">			%p			\n</m:properties></content></entry>'.replace("%n",this._manager.rest_name).replace("%d",$p.dateFormat(new Date,$p.dateFormat.masks.atom)),r="\n<d:Ref_Key>"+this.ref+"</d:Ref_Key>"+"\n<d:DeletionMark>"+this.deleted+"</d:DeletionMark>"+"\n<d:DataVersion>"+this.data_version+"</d:DataVersion>",i,s,o,u,a,f,l;this instanceof DocObj?(r+="\n<d:Date>"+$p.dateFormat(this.date,$p.dateFormat.masks.atom)+"</d:Date>",r+="\n<d:Number>"+this.number_doc+"</d:Number>"):(this._metadata.main_presentation_name&&(r+="\n<d:Description>"+this.name+"</d:Description>"),this._metadata.code_length&&(r+="\n<d:Code>"+this.id+"</d:Code>"),this._metadata.hierarchical&&this._metadata.group_hierarchy&&(r+="\n<d:IsFolder>"+this.is_folder+"</d:IsFolder>")),t(this);for(o in this._metadata.tabular_sections)a=this._metadata.tabular_sections[o],f="StandardODATA."+this._manager.rest_name+"_"+_md.syns_1с(o)+"_RowType",u=this[o],u.count()?(r+="\n<d:"+_md.syns_1с(o)+' m:type="Collection('+f+')">',u.each(function(e){r+='\n	<d:element m:type="'+f+'">',r+="\n	<d:LineNumber>"+e.row+"</d:LineNumber>",t(e),r+="\n	</d:element>"}),r+="\n</d:"+_md.syns_1с(o)+">"):r+="\n<d:"+_md.syns_1с(o)+' m:type="Collection('+f+')" />';return n.replace("%p",r)},typeof window!="undefined"&&only_in_browser(window),$p.eve.socket=new SocketMsg,$p.eve.steps={load_meta:0,authorization:1,create_managers:2,process_access:3,load_data_files:4,load_data_db:5,load_data_wsql:6,save_data_wsql:7},$p.eve.ontimer=function(){$p.eve.update_files_version()},setInterval($p.eve.ontimer,18e4),$p.eve.update_files_version=function(){if(!$p.job_prm||$p.job_prm.offline||!$p.job_prm.data_url)return;$p.job_prm.files_date||($p.job_prm.files_date=$p.wsql.get_user_param("files_date","number")),$p.ajax.get($p.job_prm.data_url+"sync.json?v="+Date.now()).then(function(e){var t=JSON.parse(e.response);!$p.job_prm.confirmation&&$p.job_prm.files_date!=t.files_date&&($p.wsql.set_user_param("files_date",t.files_date),$p.job_prm.confirmation=!0,dhtmlx.confirm({title:$p.msg.file_new_date_title,text:$p.msg.file_new_date,ok:"Перезагрузка",cancel:"Продолжить",callback:function(e){delete $p.job_prm.confirmation,e&&($p.eve.redirect=!0,location.reload(!0))}}))}).catch($p.record_log)},$p.eve.pop=function(){function e(e){return _load({action:"get_cachable_portion",cache_cat_date:n,step_size:$p.eve.stepper.step_size,step:e||0})}function t(e){$p.eve.stepper.cat_ini_date>$p.wsql.get_user_param("cache_cat_date","number")&&$p.wsql.set_user_param("cache_cat_date",$p.eve.stepper.cat_ini_date),e&&setTimeout(function(){$p.eve.pop(!0)},1e4)}var n=$p.eve.stepper.cat_ini_date;return $p.job_prm.offline||!$p.job_prm.irest_enabled?Promise.resolve(!1):Promise.resolve(!1)},$p.eve.push=function(){},$p.eve.from_json_to_data_obj=function(e){var t=$p.eve.stepper,n;typeof e=="string"?e=JSON.parse(e):e instanceof XMLHttpRequest&&(e.response?e=JSON.parse(e.response):e={});if(t.do_break)$p.iface.sync.close(),$p.eve.redirect=!0,location.reload(!0);else if(e.cat_date||e.force){e.cat_date>t.cat_ini_date&&(t.cat_ini_date=e.cat_date),e.cat_date>t.cat_date&&(t.cat_date=e.cat_date),e.count_all&&(t.count_all=e.count_all),e.current&&(t.current=e.current);for(n in e.cch)_cch[n]&&_cch[n].load_array(e.cch[n]);for(n in e.cacc)_cacc[n]&&_cacc[n].load_array(e.cacc[n]);for(n in e.cat)_cat[n]&&_cat[n].load_array(e.cat[n]);for(n in e.doc)_doc[n]&&_doc[n].load_array(e.doc[n]);for(n in e.ireg)_ireg[n]&&_ireg[n].load_array(e.ireg[n]);for(n in e.areg)_areg[n]&&_areg[n].load_array(e.areg[n]);return e.current&&e.current>=t.step_size}},$p.eve.reduce_promices=function(e,t){return e.reduce(function(e,n){return e.then(function(){return n}).then(t).catch(t)},Promise.resolve())},$p.eve.js_time_diff=-(new Date("0001-01-01")).valueOf(),$p.eve.time_diff=function(){var e=$p.wsql.get_user_param("time_diff","number");return!e||isNaN(e)||e<621355716e5||e>62135622e6?$p.eve.js_time_diff:e},$p.eve.log_in=function(e){var t=$p.eve.stepper,n={},r=[],i,s,o,u=$p.job_prm.data_url||"/data/";return e($p.eve.steps.load_meta),$p.ajax.default_attr(n,$p.job_prm.irest_url()),$p.job_prm.offline||r.push($p.ajax.get_ex(n.url,n)),r.push($p.ajax.get(u+"meta.json?v="+$p.job_prm.files_date)),r.push($p.ajax.get(u+"meta_patch.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(r,function(t){t instanceof XMLHttpRequest&&t.status==200?t.responseURL.indexOf("/hs/rest")!=-1?$p.job_prm.irest_enabled=!0:t.responseURL.indexOf("meta.json")!=-1?(e($p.eve.steps.create_managers),i=JSON.parse(t.response)):t.responseURL.indexOf("meta_patch.json")!=-1&&(s=JSON.parse(t.response)):$p.record_log(t)}).then(function(){if(!i)throw Error("Ошибка чтения файла метаданных");return new Meta(i,s)}).then(function(n){return i=s=null,e($p.eve.steps.authorization),$p.job_prm.offline?n:$p.job_prm.rest||$p.job_prm.irest_enabled?$p.job_prm.irest_enabled?{root:!0}:$p.ajax.get_ex($p.job_prm.rest_url()+"?$format=json",!0).then(function(e){return{root:!0}}):_load({action:"get_meta",cache_cat_date:t.cat_ini_date,now_js:Date.now(),margin:$p.wsql.get_user_param("margin","number"),ipinfo:$p.ipinfo.hasOwnProperty("latitude")?JSON.stringify($p.ipinfo):""})}).catch(function(e){throw $p.iface.auth.onerror&&$p.iface.auth.onerror(e),e}).then(function(t){e($p.eve.steps.load_data_files);if($p.job_prm.offline)return t;$p.ajax.authorized=!0,typeof t=="string"&&(t=JSON.parse(t));if($p.msg.check_soap_result(t))return;return $p.wsql.get_user_param("enable_save_pwd")?$p.wsql.set_user_param("user_pwd",$p.ajax.password):$p.wsql.get_user_param("user_pwd")&&$p.wsql.set_user_param("user_pwd",""),$p.wsql.set_user_param("time_diff",t["now_1с"]-t.now_js),t.cat&&t.cat.clrs&&(_md.get("cat.clrs").predefined.white.ref=t.cat.clrs.predefined.white.ref),t.cat&&t.cat.bases&&(_md.get("cat.bases").predefined.main.ref=t.cat.bases.predefined.main.ref),t}).then(function(e){return o=e,t.zone=($p.job_prm.demo?"1":$p.wsql.get_user_param("zone"))+"/",$p.ajax.get(u+"zones/"+t.zone+"p_0.json?v="+$p.job_prm.files_date)}).then(function(e){var n=JSON.parse(e.response);t.files=n.files-1,t.step_size=n.files>0?Math.round(n.count_all/n.files):57,t.cat_ini_date=n.cat_date,$p.eve.from_json_to_data_obj(n)}).then(function(){r=[];for(var e=1;e<=t.files;e++)r.push($p.ajax.get(u+"zones/"+t.zone+"p_"+e+".json?v="+$p.job_prm.files_date));return r.push($p.ajax.get(u+"zones/"+t.zone+"ireg.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(r,$p.eve.from_json_to_data_obj)}).then(function(){return e($p.eve.steps.load_data_db),t.step_size=57,$p.eve.pop()}).then(function(){o.access&&(o.access.force=!0,$p.eve.from_json_to_data_obj(o.access)),_md.printing_plates(o.printing_plates),$p.ajax.hasOwnProperty("root")&&delete $p.ajax.root,$p.ajax.__define("root",{value:!!o.root,writable:!1,enumerable:!1})}).then(function(){e($p.eve.steps.save_data_wsql)})},$p.eve.auto_log_in=function(){var e=$p.eve.stepper,t=$p.job_prm.data_url||"/data/",n=[],r,i,s,o;return e.zone=$p.wsql.get_user_param("zone")+"/",n.push($p.ajax.get(t+"meta.json?v="+$p.job_prm.files_date)),n.push($p.ajax.get(t+"meta_patch.json?v="+$p.job_prm.files_date)),n.push($p.ajax.get(t+"zones/"+e.zone+"p_0.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(n,function(e){e instanceof XMLHttpRequest&&e.status==200?e.responseURL.indexOf("meta.json")!=-1?r=JSON.parse(e.response):e.responseURL.indexOf("meta_patch.json")!=-1?i=JSON.parse(e.response):e.responseURL.indexOf("p_0.json")!=-1&&(s=JSON.parse(e.response)):$p.record_log(e)}).then(function(){if(!r)throw Error("Ошибка чтения файла метаданных");return new $p.Meta(r,i)}).then(function(t){e.files=s.files-1,e.step_size=s.files>0?Math.round(s.count_all/s.files):57,e.cat_ini_date=s.cat_date,$p.eve.from_json_to_data_obj(s)}).then(function(){n=[];for(var r=1;r<=e.files;r++)n.push($p.ajax.get(t+"zones/"+e.zone+"p_"+r+".json?v="+$p.job_prm.files_date));return n.push($p.ajax.get(t+"zones/"+e.zone+"ireg.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(n,$p.eve.from_json_to_data_obj)}).then(function(){e.step_size=57})}},{xml_to_json:function(e,t,n){var r=function(){this.version="1.3";var e={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},t=new RegExp(/(?!xmlns)^.*:/),n=new RegExp(/^\s+|\s+$/g);return this.grokType=function(e){return/^\s*$/.test(e)?null:/^(?:true|false)$/i.test(e)?e.toLowerCase()==="true":isFinite(e)?parseFloat(e):e},this.parseString=function(e,t){return this.parseXML(this.stringToXML(e),t)},this.parseXML=function(i,s){for(var o in s)e[o]=s[o];var u={},a=0,f="";e.xmlns&&i.namespaceURI&&(u[e.namespaceKey]=i.namespaceURI);if(i.attributes&&i.attributes.length>0){var l={};for(a;a<i.attributes.length;a++){var c=i.attributes.item(a);v={};var h="";e.stripAttrPrefix?h=c.name.replace(t,""):h=c.name,e.grokAttr?v[e.valueKey]=this.grokType(c.value.replace(n,"")):v[e.valueKey]=c.value.replace(n,""),e.xmlns&&c.namespaceURI&&(v[e.namespaceKey]=c.namespaceURI),e.attrsAsObject?l[h]=v:u[e.attrKey+h]=v}e.attrsAsObject&&(u[e.attrKey]=l)}if(i.hasChildNodes())for(var p,d,v,m=0;m<i.childNodes.length;m++)p=i.childNodes.item(m),p.nodeType===4?e.mergeCDATA?f+=p.nodeValue:u.hasOwnProperty(e.cdataKey)?(u[e.cdataKey].constructor!==Array&&(u[e.cdataKey]=[u[e.cdataKey]]),u[e.cdataKey].push(p.nodeValue)):e.childrenAsArray?(u[e.cdataKey]=[],u[e.cdataKey].push(p.nodeValue)):u[e.cdataKey]=p.nodeValue:p.nodeType===3?f+=p.nodeValue:p.nodeType===1&&(a===0&&(u={}),e.stripElemPrefix?d=p.nodeName.replace(t,""):d=p.nodeName,v=r.parseXML(p),u.hasOwnProperty(d)?(u[d].constructor!==Array&&(u[d]=[u[d]]),u[d].push(v)):(e.childrenAsArray?(u[d]=[],u[d].push(v)):u[d]=v,a++));else f||(e.childrenAsArray?(u[e.textKey]=[],u[e.textKey].push(null)):u[e.textKey]=null);if(f)if(e.grokText){var g=this.grokType(f.replace(n,""));g!==null&&g!==undefined&&(u[e.textKey]=g)}else e.normalize?u[e.textKey]=f.replace(n,"").replace(/\s+/g," "):u[e.textKey]=f.replace(n,"");return u},this.xmlToString=function(e){try{var t=e.xml?e.xml:(new XMLSerializer).serializeToString(e);return t}catch(n){return null}},this.stringToXML=function(e){try{var t=null;if(window.DOMParser){var n=new DOMParser;return t=n.parseFromString(e,"text/xml"),t}return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t}catch(r){return null}},this}();typeof n!="undefined"&&n!==null&&n.exports?n.exports=r:typeof define=="function"&&define.amd&&define(function(){return r})},log:{ireg:{$log:{name:"$log",note:"",synonym:"Журнал событий",dimensions:{date:{synonym:"Дата",multiline_mode:!1,tooltip:"Время события",type:{types:["number"],digits:15,fraction_figits:0}},sequence:{synonym:"Порядок",multiline_mode:!1,tooltip:"Порядок следования",type:{types:["number"],digits:6,fraction_figits:0}}},resources:{"class":{synonym:"Класс",multiline_mode:!1,tooltip:"Класс события",type:{types:["string"],str_len:100}},note:{synonym:"Комментарий",multiline_mode:!0,tooltip:"Текст события",type:{types:["string"],str_len:0}},obj:{synonym:"Объект",tooltip:"Объект, к которому относится событие",type:{types:["string"],str_len:0}}}}}}},{},{})