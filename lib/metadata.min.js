(function(e,t,n,r,i){var s={},o=function(t){return e.Function("return "+t)()},u=e.document,a,f=function(t,i){var o={exports:{}};s[t]=1,n[t]=o.exports;if(!i)i=i||e[t];else if(typeof i=="function"){var u=l;r[t]&&r[t].sandbox&&typeof u=="function"&&(u=a),i=i(u,o.exports,o)||o.exports}return i=i,n[t]=i},l=function(e){var t=n[e],r=[e,t];return r&&(e=r[0],t=r[1]),s[e]&&t?t:(typeof t=="string"&&t.indexOf("(function(")===0&&(t=o(t)),f(e,t))},c={exports:{}};for(var h in n)s[h]=0;t(l,c.exports,c)})(this,function(e,t,n){var r=e("common")},{common:function(require,exports,module){function MetaEngine(){this.version="0.9.191",this.toString=function(){return"Oknosoft data engine. v:"+this.version}}function InterfaceObjs(){this.toString=function(){return"Объекты интерфейса пользователя"},this.clear_svgs=function(e){typeof e=="string"&&(e=document.getElementById(e));while(e.firstChild)e.removeChild(e.firstChild)},this.set_hash=function(e,t,n,r){e||(e=""),t||(t=""),n||(n=""),r||(r="");var i="obj="+e+"&ref="+t+"&frm="+n+"&view="+r;location.hash.substr(1)==i?this.hash_route():location.hash=i},this.hash_route=function(e){if(!$p.iface.before_route||$p.iface.before_route(e)!==!1)if($p.ajax.authorized){var t=$p.job_prm.parse_url(),n;t.ref&&typeof _md!="undefined"?(n=_md.mgr_by_class_name(t.obj),n&&n[t.frm||"form_obj"]($p.iface.docs,t.ref)):t.view&&$p.iface.swith_view&&$p.iface.swith_view(t.view)}if(e)return $p.cancel_bubble(e)},this.oninit=null,this.ontimer=null,setTimeout(function(){$p.iface.ontimer&&typeof $p.iface.ontimer=="function"&&setInterval($p.iface.ontimer,9e4)},2e4)}function JobPrm(){this.parse_url=function(){function e(e){var t={},n=[],r;if(e.substr(0,1)==="#"||e.substr(0,1)==="?")e=e.substr(1);if(e.length>2){r=decodeURI(e).split("&");for(var i in r){n=r[i].split("=");if(n[0]=="m")try{t[n[0]]=JSON.parse(n[1])}catch(s){t[n[0]]={}}else t[n[0]]=n[1]||""}}return t}return e(location.search)._mixin(e(location.hash))},this.check_browser_compatibility=!0,this.check_app_installed=!1,this.check_dhtmlx=!0,this.use_builder=!1,this.offline=!1,this.url_prm=this.parse_url(),typeof $p.settings=="function"&&$p.settings(this,$p.modifiers);for(var e in this)e!=="url_prm"&&typeof this[e]!="function"&&this.url_prm.hasOwnProperty[e]&&(this[e]=this.url_prm[e]);this.hs_url=function(){var e=this.hs_path||"/a/zd/%1/hs/upzp",t=$p.wsql.get_user_param("zone","number");return t?e.replace("%1",t):e.replace("%1/","")},this.rest_url=function(){var e=this.rest_path||"/a/zd/%1/odata/standard.odata/",t=$p.wsql.get_user_param("zone","number");return t?e.replace("%1",t):e.replace("%1/","")},this.unf_url=function(){return"/a/unf/%1/odata/standard.odata/".replace("%1",$p.wsql.get_user_param("zone_unf","number"))}}function input_keydown(e,t){return e.keyCode==8||e.keyCode==46?(t.setValue(""),t.grid.editStop(),t.source.on_select&&t.source.on_select.call(t.source)):e.keyCode==9||e.keyCode==13?t.grid.editStop():e.keyCode==115&&t.cell.firstChild.childNodes[1].onclick(e),$p.cancel_bubble(e)}function eXcell_ref(e){if(!e)return;var t=this,n,r=function(e){return input_keydown(e,t)},i=function(e){var n,r,i,s,o,u,a={initial_value:t.val.ref,parent:null,owner:null};t.mgr=null;if(t.source.slist)t.source.slist.call(t);else if(t.source.tabular_section){n=t.source.row._metadata.fields[t.source.col],t.mgr=_md.value_mgr(t.source.row,t.source.col,n.type);if(t.mgr){t.source.choice_links&&t.source.choice_links[t.source.tabular_section+"_"+t.source.col]?o=t.source.choice_links[t.source.tabular_section+"_"+t.source.col]:o=n.choice_links;if(o)for(var f in o)(s=o[f]).name[1]=="owner"&&(a.owner=s.path.length==2?t.source.row[s.path[1]].ref:t.source.o[s.path[0]].ref);t.mgr.form_selection(t.source,a)}}else{if(t.fpath.length<2){n=t.source.o._manager.metadata(t.fpath[0]),t.mgr=_md.value_mgr(t.source.o,t.fpath[0],n.type),t.source.choice_links&&t.source.choice_links[t.fpath[0]]?o=t.source.choice_links[t.fpath[0]]:o=n.choice_links;if(t.source.choice_params&&t.source.choice_params[t.fpath[0]])for(var f in t.source.choice_params[t.fpath[0]])a.selection||(a.selection=[]),a.selection.push(t.source.choice_params[t.fpath[0]][f])}else n=t.source.o._metadata.tabular_sections[t.fpath[0]].fields[t.fpath[1]],t.mgr=_md.value_mgr(t.source.row,t.source.col,n.type);if(t.mgr){if(o)for(var f in o){(s=o[f]).path.length==1?u=t.source.o[s.path[0]].ref:u=t.source.o[s.path[0]].ref;if(s.name[1]=="owner")a.owner=u;else if(s.name[0]=="selection"){a.selection||(a.selection=[]);var l={};l[s.name[1]]=u,a.selection.push(l)}}t.mgr.form_selection(t.source,a)}}return $p.cancel_bubble(e)};t.cell=e,t.grid=t.cell.parentNode.grid,t.open_selection=i,t.setValue=function(e){t.setCValue(e instanceof DataObj?e.presentation:e)},t.getValue=function(){if(t.source=t.grid.getUserData("","source")){if(t.source.tabular_section)return t.source.row=t.source.o[t.source.tabular_section].get(t.cell.parentNode.idd-1),t.source.col=t.source.fields[t.cell.cellIndex],t.source.cell=t,t.source.row[t.source.col];t.fpath=t.grid.getSelectedRowId().split("|");if(t.fpath.length<2)return t.source.o[t.fpath[0]];var e=t.source.o[t.fpath[0]].find(t.fpath[1]);if(e)return e.value||e["Значение"]}},t.edit=function(){var e;t.val=t.getValue(),t.source.tabular_section?t.cell.innerHTML='<div class="ref_div23"><input type="text" class="dhx_combo_edit" style="height: 22px;"><div class="ref_field23">&nbsp;</div></div>':t.cell.innerHTML='<div class="ref_div21"><input type="text" class="dhx_combo_edit" style="height: 20px;"><div class="ref_field21">&nbsp;</div></div>',n=t.cell.firstChild,e=n.childNodes[0],e.value=t.val?t.val.presentation:"",e.onclick=$p.cancel_bubble,e.readOnly=!0,e.focus(),e.onkeydown=r,n.childNodes[1].onclick=i},t.detach=function(){return t.cell.firstChild&&t.setValue(t.cell.firstChild.childNodes[0].value),!$p.is_equal(t.val,t.getValue())}}function eXcell_refc(e){if(!e)return;var t=this,n=function(){t.mgr=null;var e,n,r,i=[{value:"1",text:"One"}];if(t.source.slist)return t.source.slist.call(t);if(t.source.tabular_section)e=t.source.row._metadata.fields[t.source.col],t.mgr=_md.value_mgr(t.source.row,t.source.col,e.type);else if(t.fpath.length<2)e=t.source.o._manager.metadata(t.fpath[0]),t.mgr=_md.value_mgr(t.source.o,t.fpath[0],e.type);else{if(t.fpath[0]=="extra_fields"||t.fpath[0]=="params")return _cch.properties.slist(t.fpath[1]);e=t.source.o._metadata.tabular_sections[t.fpath[0]].fields[t.fpath[1]],t.mgr=_md.value_mgr(t.source.row,t.source.col,e.type)}return t.mgr&&(i=t.mgr.get_option_list(t.val)),i};t.cell=e,t.grid=t.cell.parentNode.grid,t.setValue=function(e){t.setCValue(e instanceof DataObj?e.presentation:e)},t.getValue=function(){if(t.source=t.grid.getUserData("","source")){if(t.source.tabular_section)return t.source.row=t.source.o[t.source.tabular_section].get(t.cell.parentNode.idd-1),t.source.col=t.source.fields[t.cell.cellIndex],t.source.cell=t,t.source.row[t.source.col];t.fpath=t.grid.getSelectedRowId().split("|");if(t.fpath.length<2)return t.source.o[t.fpath[0]];var e=t.source.o[t.fpath[0]],n=e.find?e.find(t.fpath[1]):$p._find(e,t.fpath[1]);if(n)return n.value||n["Значение"]}},t.edit=function(){if(t.combo)return;t.val=t.getValue(),t.cell.innerHTML="",t.combo=new dhtmlXCombo({parent:t.cell,items:n()}),t.combo.DOMelem.style.border="none",t.combo.DOMelem.style.height="21px",t.combo.DOMelem.style.width=t.cell.offsetWidth-8+"px",t.combo.DOMelem_input.style.fontSize="11px",t.combo.DOMelem_input.style.margin=0,t.combo.DOMlist.style.fontSize="11px",t.combo.setFocus(),t.combo.setComboValue(t.val.ref),t.combo.readonly(!0,!0),t.combo.openSelect(),t.combo.attachEvent("onChange",function(){if(t.source.on_select){var e=(t.mgr||$p.cat.property_values).get(t.combo.getSelectedValue(),!1);setTimeout(function(){t.source.on_select(e)},0)}})},t.detach=function(){return t.combo&&t.setValue(t.combo.getComboText()),!$p.is_equal(t.val,t.getValue())}}function data_to_grid(e,t){function n(e){var t;return e.is_folder?t="cell_ref_folder":t="cell_ref_elm",e.deleted&&(t+="_deleted"),t}var r="<?xml version='1.0' encoding='UTF-8'?><rows total_count='%1' pos='%2' set_parent='%3'>".replace("%1",e.length).replace("%2",t.start).replace("%3",t.set_parent||""),i=this.caption_flds(t),s;return r+=i.head,e.forEach(function(e){r+='<row id="'+e.ref+'"><cell class="'+n(e)+'">'+e[i.acols[0].id]+"</cell>";for(var t=1;t<i.acols.length;t++)s=i.acols[t].id,r+="<cell>"+((s=="svg"?$p.normalize_xml(e[s]):e[s])||"")+"</cell>";r+="</row>"}),r+"</rows>"}function eXcell_rsvg(e){e&&(this.cell=e,this.grid=this.cell.parentNode.grid),this.edit=function(){},this.isDisabled=function(){return!0},this.setValue=function(e){this.setCValue(e?$p.scale_svg(e,120,10):"нет эскиза")}}function OTooolBar(e){function t(e){for(var t=0;t<r.children.length;t++){var n=r.children[t];n.classList.contains("selected")&&n.classList.remove("selected")}e&&!this.classList.contains("selected")&&this.classList.add("selected")}var n=this,r=document.createElement("div"),i,s,o,u;$p.iface.popup||($p.iface.popup=new dhtmlXPopup),e.image_path||(e.image_path=dhtmlx.image_path+"custom_field/"),r.className="wb-tools",n.cell=r,n.buttons={},this.add=function(t){var a=$p.iface.add_button(r,e,t);dhtmlxEvent(a,"click",function(){var t=this.name.replace(e.name+"_","");e.onclick&&e.onclick.call(n,t)}),dhtmlxEvent(a,"mouseover",function(){t.title&&(s=!0,$p.iface.popup.attachHTML(t.title),t.sub||$p.iface.popup.show(dhx4.absLeft(a),dhx4.absTop(a),a.offsetWidth,a.offsetHeight))}),dhtmlxEvent(a,"mouseout",function(){s=!1,setTimeout(function(){s||$p.iface.popup.hide()},300)}),n.buttons[t.name]=a;if(t.sub){function f(){if(a.subdiv&&!o&&!u){while(a.subdiv.firstChild)a.subdiv.removeChild(a.subdiv.firstChild);a.subdiv.parentNode.removeChild(a.subdiv),a.subdiv=null}}a.onmouseover=function(){u=!0;if(!this.subdiv){this.subdiv=document.createElement("div"),this.subdiv.className="wb-tools",i=$p.get_offset(a),this.subdiv.style.left=i.left+"px",this.subdiv.style.top=i.top+r.offsetHeight+"px",this.subdiv.style.height="198px",this.subdiv.style.width="56px";for(var n in t.sub.buttons){var s=$p.iface.add_button(this.subdiv,e,t.sub.buttons[n]);s.onclick=a.onclick}e.wrapper.appendChild(this.subdiv),this.subdiv.onmouseover=function(){o=!0},this.subdiv.onmouseout=function(){o=!1,setTimeout(f,500)},t.title&&$p.iface.popup.show(dhx4.absLeft(this.subdiv),dhx4.absTop(this.subdiv),this.subdiv.offsetWidth,this.subdiv.offsetHeight)}},a.onmouseout=function(){u=!1,setTimeout(f,500)}}},this.select=function(n){for(var i=0;i<r.children.length;i++){var s=r.children[i];if(s.name==e.name+"_"+n){t.call(s,!0);return}}},this.unload=function(){while(r.firstChild)r.removeChild(r.firstChild);e.wrapper.removeChild(r)},e.wrapper.appendChild(r),r.style.width=e.width||"28px",r.style.height=e.height||"150px",r.style.position="absolute",e.top&&(r.style.top=e.top),e.left&&(r.style.left=e.left),e.bottom&&(r.style.bottom=e.bottom),e.right&&(r.style.right=e.right),e.buttons&&e.buttons.forEach(function(e){n.add(e)})}function eXcell_addr(e){if(!e)return;var t=this,n,r=function(e){return input_keydown(e,t)},i=function(e){return wnd_address(t.source),$p.cancel_bubble(e)};t.cell=e,t.grid=t.cell.parentNode.grid,t.open_selection=i,t.setValue=function(e){t.setCValue(e)},t.getValue=function(){if(t.source=t.grid.getUserData("","source"))return t.source.o.shipping_address},t.edit=function(){var e;t.val=t.getValue(),t.source.tabular_section?t.cell.innerHTML='<div class="ref_div23"><input type="text" class="dhx_combo_edit" style="height: 22px;"><div class="ref_field23">&nbsp;</div></div>':t.cell.innerHTML='<div class="ref_div21"><input type="text" class="dhx_combo_edit" style="height: 20px;"><div class="ref_field21">&nbsp;</div></div>',n=t.cell.firstChild,e=n.childNodes[0],e.value=t.val,e.onclick=$p.cancel_bubble,e.readOnly=!0,e.focus(),e.onkeydown=r,n.childNodes[1].onclick=i},t.detach=function(){return t.cell.firstChild&&t.cell.firstChild.childNodes[0]&&t.cell.firstChild.childNodes[0].length&&t.setValue(t.cell.firstChild.childNodes[0].value),!$p.is_equal(t.val,t.getValue())}}function wnd_address(e){function t(){var t={name:"wnd_addr",wnd:{id:"wnd_addr",top:130,left:200,width:800,height:560,modal:!0,center:!0,pwnd:e,allow_close:!0,allow_minmax:!0,on_close:m,caption:e.o.shipping_address}};g=$p.iface.dat_blank(null,t.wnd),g.elmnts.layout=g.attachLayout("2E"),g.elmnts.cell_frm=g.elmnts.layout.cells("a"),g.elmnts.cell_frm.setHeight("110"),g.elmnts.cell_frm.hideHeader(),g.elmnts.cell_frm.fixSize(0,1),g.elmnts.pgrid=g.elmnts.cell_frm.attachPropertyGrid(),g.elmnts.pgrid.setDateFormat("%d.%m.%Y %H:%i"),g.elmnts.pgrid.init(),g.elmnts.pgrid.loadXMLString(e.o._manager.get_property_grid_xml({" ":[{id:"delivery_area",path:"o.delivery_area",synonym:"Район доставки",type:"ref",txt:y.delivery_area.presentation},{id:"region",path:"o.region",synonym:"Регион",type:"ro",txt:y.region},{id:"city",path:"o.city",synonym:"Населенный пункт",type:"ed",txt:y.city},{id:"street",path:"o.street",synonym:"Улица, дом, корпус, литера, квартира",type:"ed",txt:y.street}]},y),function(){g.elmnts.pgrid.enableAutoHeight(!0),g.elmnts.pgrid.setSizes(),g.elmnts.pgrid.setUserData("","source",{o:y,grid:g.elmnts.pgrid,on_select:i,slist:n}),g.elmnts.pgrid.attachEvent("onPropertyChanged",v)}),g.elmnts.toolbar=g.attachToolbar(),g.elmnts.toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar_web/"),g.elmnts.toolbar.loadStruct('<toolbar><item id="btn_select" type="button" title="Установить адрес" text="&lt;b&gt;Выбрать&lt;/b&gt;" /></toolbar>',function(){this.attachEvent("onclick",r)}),g.elmnts.cell_map=g.elmnts.layout.cells("b"),g.elmnts.cell_map.hideHeader();var s={center:new google.maps.LatLng(y.latitude,y.longitude),zoom:y.street?15:12,mapTypeId:google.maps.MapTypeId.ROADMAP};g.elmnts.map=g.elmnts.cell_map.attachMap(s),y.marker=new google.maps.Marker({map:g.elmnts.map,draggable:!0,animation:google.maps.Animation.DROP,position:s.center}),google.maps.event.addListener(y.marker,"click",h),google.maps.event.addListener(y.marker,"dragend",d),o()}function n(){var e=[];return this.fpath[0]=="delivery_area"&&$p.cat.delivery_areas.form_selection(this.source,{initial_value:y.delivery_area.ref}),e}function r(t){t=="btn_select"&&(e.o.delivery_area=y.delivery_area,f(),e.grid.cells("shipping_address",1).setValue(e.o.shipping_address),e.o.coordinates=JSON.stringify([y.latitude,y.longitude])),g.close()}function i(e){if(e===undefined)return;var t=g.elmnts.pgrid.getSelectedRowId(),n=!1;y[t]!=undefined&&(n=y[t]!=e,y[t]=e),$p.is_data_obj(e)?(g.elmnts.pgrid.cells().setValue(e.presentation),s(n)):u()}function s(e){!y.delivery_area.empty()&&e&&(y.street=""),y.delivery_area.region?(y.region=y.delivery_area.region,g.elmnts.pgrid.cells("region",1).setValue(y.region)):e&&(y.region=""),y.delivery_area.city?(y.city=y.delivery_area.city,g.elmnts.pgrid.cells("city",1).setValue(y.city)):e&&(y.city="");if(y.delivery_area.latitude&&y.delivery_area.longitude){var t=new google.maps.LatLng(y.delivery_area.latitude,y.delivery_area.longitude);g.elmnts.map.setCenter(t),y.marker.setPosition(t)}o()}function o(){g.elmnts.pgrid.cells("region",1).setValue(y.region),g.elmnts.pgrid.cells("city",1).setValue(y.city),g.elmnts.pgrid.cells("street",1).setValue(y.street)}function u(){var e=y.street?15:12;g.elmnts.map.getZoom()!=e&&g.elmnts.map.setZoom(e),c(function(e,t){if(t==google.maps.GeocoderStatus.OK){var n=e[0].geometry.location;g.elmnts.map.setCenter(n),y.marker.setPosition(n),y.latitude=n.lat(),y.longitude=n.lng(),y.postal_code=p({},e[0].address_components).postal_code||""}})}function a(){return(y.street?y.street.replace(/,/g," ")+", ":"")+(y.city?y.city+", ":"")+(y.region?y.region+", ":"")+y.country+(y.postal_code?", "+y.postal_code:"")}function f(){e.o.shipping_address=a();var t='<КонтактнаяИнформация  				xmlns="http://www.v8.1c.ru/ssl/contactinfo" 				xmlns:xs="http://www.w3.org/2001/XMLSchema" 				xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   				Представление="%1">   					<Комментарий/>  					<Состав xsi:type="Адрес" Страна="РОССИЯ">   						<Состав xsi:type="АдресРФ">'.replace("%1",e.o.shipping_address);y.region&&(t+="\n<СубъектРФ>"+y.region+"</СубъектРФ>"),y.city&&(y.city.indexOf("г.")!=-1||y.city.indexOf("г ")!=-1||y.city.indexOf(" г")!=-1?t+="\n<Город>"+y.city+"</Город>":t+="\n<НаселПункт>"+y.city+"</НаселПункт>");if(y.street){var n=y.street.replace(/,/g," "),r,i,s,o,u,f,l;for(var c in $p.fias){if($p.fias[c].type==1)for(var h in $p.fias[c].syn)if((i=n.indexOf($p.fias[c].syn[h]))!=-1){u=c,r=n.substr(i+$p.fias[c].syn[h].length).trim(),n=n.substr(0,i).trim();break}if(u)break}u||(u="1010",(i=n.indexOf(" "))!=-1&&(r=n.substr(i),n=n.substr(0,i))),t+="\n<Улица>"+n.trim()+"</Улица>";if(r){s=r.toLowerCase(),r="";for(var c in $p.fias){if($p.fias[c].type==3)for(var h in $p.fias[c].syn)if((i=s.indexOf($p.fias[c].syn[h]))!=-1){f=c,r=s.substr(i+$p.fias[c].syn[h].length),s=s.substr(0,i);break}if(f)break}f||(f="2010",(i=s.indexOf(" "))!=-1&&(r=s.substr(i),s=s.substr(0,i))),t+='\n<ДопАдрЭл><Номер Тип="'+u+'" Значение="'+s.trim()+'"/></ДопАдрЭл>'}r&&(t+='\n<ДопАдрЭл><Номер Тип="'+f+'" Значение="'+r.trim()+'"/></ДопАдрЭл>')}y.postal_code&&(t+='<ДопАдрЭл ТипАдрЭл="10100000" Значение="'+y.postal_code+'"/>'),t+="</Состав> 					</Состав></КонтактнаяИнформация>",e.o.address_fields=t}function l(t){if(e.o.address_fields){y.xml=(new DOMParser).parseFromString(e.o.address_fields,"text/xml");var n={},r={building_room:""},i,s=[],o="СубъектРФ,Округ,СвРайМО,СвРайМО,ВнутригРайон,НаселПункт,Улица,Город,ДопАдрЭл,Адрес_по_документу,Местоположение".split(",");function u(e){if(e.attributes&&e.attributes.length==2){var t={};return t[e.attributes[0].value]=e.attributes[1].value,t}}for(var a in o)n[o[a]]=y.xml.getElementsByTagName(o[a]);for(var a in n)for(var f in n[a]){if(f=="length"||!n[a].hasOwnProperty(f))continue;if(i=u(n[a][f]))r[a]||(r[a]=[]),r[a].push(i);else if(n[a][f].childNodes.length)for(var l in n[a][f].childNodes){if(l=="length"||!n[a][f].childNodes.hasOwnProperty(l))continue;(i=u(n[a][f].childNodes[l]))?(r[a]||(r[a]=[]),r[a].push(i)):n[a][f].childNodes[l].nodeValue&&(r[a]?r[a]+=" "+n[a][f].childNodes[l].nodeValue:r[a]=n[a][f].childNodes[l].nodeValue)}}for(var a in r["ДопАдрЭл"]){for(var f in $p.fias){if(f.length!=4)continue;r["ДопАдрЭл"][a][f]&&(s[$p.fias[f].type]=$p.fias[f].name+" "+r["ДопАдрЭл"][a][f])}r["ДопАдрЭл"][a][101e5]&&(y.postal_code=r["ДопАдрЭл"][a][101e5])}y.address_fields=r,y.region=r["СубъектРФ"]||r["Округ"]||"",y.city=r["Город"]||r["НаселПункт"]||"",y.street=r["Улица"]||"";for(var a in s)y.street+=" "+s[a]}y.coordinates.length?(y.latitude=y.coordinates[0],y.longitude=y.coordinates[1],t()):e.o.shipping_address?c(function(e,n){n==google.maps.GeocoderStatus.OK&&(y.latitude=e[0].geometry.location.lat(),y.longitude=e[0].geometry.location.lng()),t()}):$p.ipinfo.latitude&&$p.ipinfo.longitude?(y.latitude=$p.ipinfo.latitude,y.longitude=$p.ipinfo.longitude,t()):(y.latitude=55.635924,y.longitude=37.6066379,t(),$p.msg.show_msg($p.msg.empty_geocoding))}function c(e){var t=a();$p.ipinfo.ggeocoder.geocode({address:t},e)}function h(){y.marker.getAnimation()!=null?y.marker.setAnimation(null):(y.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){y.marker.setAnimation(null)},1500))}function p(e,t){var n,r,i,s="",o="",u="";for(n in t){r=t[n];for(i in r.types)switch(r.types[i]){case"route":r.short_name.indexOf("Unnamed")==-1&&(s=r.short_name+(s?" "+s:""),o=$p.m.trim(r.long_name.replace("улица","")));break;case"administrative_area_level_1":e.region=r.long_name;break;case"administrative_area_level_2":e.city=r.short_name,e.city_long=r.long_name;break;case"locality":u=(u?u+" ":"")+r.short_name;break;case"street_number":s=(s?s+" ":"")+r.short_name;break;case"postal_code":e.postal_code=r.short_name;break;default:}}e.region==e.city_long?e.city.indexOf(u)==-1?e.city=u:e.city="":u&&e.city.indexOf(u)==-1&&e.region.indexOf(u)==-1&&(s=u+", "+s);if(!e.street||e.street.indexOf(o)==-1)e.street=s;return e}function d(e){$p.ipinfo.ggeocoder.geocode({latLng:e.latLng},function(t,n){if(n==google.maps.GeocoderStatus.OK&&t[0]){var r=t[0];g.setText(r.formatted_address),p(y,r.address_components),o();var i=y.street?15:12;g.elmnts.map.getZoom()!=i&&(g.elmnts.map.setZoom(i),g.elmnts.map.setCenter(e.latLng)),y.latitude=e.latLng.lat(),y.longitude=e.latLng.lng()}})}function v(e,t,n){e&&(y.delivery_area.empty()?(t=n,$p.msg.show_msg({type:"alert",text:$p.msg.delivery_area_empty,title:$p.msg.addr_title}),setTimeout(function(){g.elmnts.pgrid.selectRowById("delivery_area")},50)):i(t))}function m(t){return e.grid.editStop(),!t.error}var g,y={delivery_area:e.o.delivery_area,coordinates:e.o.coordinates?JSON.parse(e.o.coordinates):[],country:"Россия",region:"",city:"",street:"",postal_code:"",marker:{}};return l(t),g}function _load(e){function t(){function t(e,r){n=n+'<item text="'+e.presentation.replace(/"/g,"'")+'" id="'+e.ref+'" im0="folderClosed.gif">',$p._find_rows(r,{parent:e.ref},function(e){t(e,r)}),n+="</item>"}var n="<?xml version='1.0' encoding='UTF-8'?><tree id=\"0\">";if(i._cachable)return $p.wsql.promise(i.get_sql_struct(e),[]).then(function(e){return t({presentation:"...",ref:$p.blank.guid},[]),$p._find_rows(e,{parent:$p.blank.guid},function(n){t(n,e)}),n+"</tree>"})}function n(){}function r(){if(i._cachable)return $p.wsql.promise(i.get_sql_struct(e),[]).then(function(t){return data_to_grid.call(i,t,e)})}var i=_md.mgr_by_class_name(e.class_name),s;return e.action=="get_tree"&&(s=t())?s:e.action=="get_orders"&&(s=n())?s:e.action=="get_selection"&&(s=r())?s:$p.job_prm.offline?Promise.reject(Error($p.msg.offline_request)):(e.browser_uid=$p.wsql.get_user_param("browser_uid"),$p.ajax.post_ex($p.job_prm.hs_url(),JSON.stringify(e),!0).then(function(e){return e.response}))}function Meta(e,t){var n=JSON.parse(e.response),r;if(t){t=JSON.parse(t.response);for(var i in t)for(var s in t[i])n[i][s]||(n[i][s]={}),n[i][s]._mixin(t[i][s])}e=null,t=null,this.get=function(e,t){var r=e.split("."),i={multiline_mode:!1,note:"",synonym:"",tooltip:"",type:{is_ref:!1,types:["string"]}};return t?(r[0]=="doc"&&t=="number_doc"?(i.synonym="Номер",i.tooltip="Номер документа",i.type.str_len=11):r[0]=="doc"&&t=="date"?(i.synonym="Дата",i.tooltip="Дата документа",i.type.date_part="date_time",i.type.types[0]="date"):r[0]=="doc"&&t=="posted"?(i.synonym="Проведен",i.type.types[0]="boolean"):r[0]=="cat"&&t=="id"?i.synonym="Код":r[0]=="cat"&&t=="name"?i.synonym="Наименование":t=="deleted"?(i.synonym="Пометка удаления",i.type.types[0]="boolean"):t?i=n[r[0]][r[1]].fields[t]:i=n[r[0]][r[1]],i):n[r[0]][r[1]]},this.get_classes=function(){var e={};for(var t in n){e[t]=[];for(var r in n[t])e[t].push(r)}return e},this.create_tables=function(e){function t(t){typeof t=="number"?(r--,r==0?(e&&setTimeout(e,10),alasql.utils.saveFile("create_tables.sql",u)):n()):t.hasOwnProperty("message")&&($p.iface.docs.progressOff(),$p.msg.show_msg({title:$p.msg.error_critical,type:"alert-error",text:t.message}))}function n(){var e=i[r-1],n=e["class"][e.name].get_sql_struct();u+=n+";\n",t(1)}var r=0,i=[],s=this.get_classes(),o,u="USE md;\nCREATE TABLE IF NOT EXISTS refs (ref CHAR);\n";for(o in s.cat)i.push({"class":_cat,name:s.cat[o]});r=i.length;for(o in s.ireg)i.push({"class":_ireg,name:s.ireg[o]}),r++;for(o in s.doc)i.push({"class":_doc,name:s.doc[o]}),r++;for(o in s.enm)i.push({"class":_enm,name:s.enm[o]}),r++;for(o in s.cch)i.push({"class":_cch,name:s.cch[o]}),r++;for(o in s.cacc)i.push({"class":_cacc,name:s.cacc[o]}),r++;$p.wsql.exec(u),n()},this.sql_type=function(e,t,n){var r;return t=="type"&&e.table_name=="cch_properties"||t=="svg"&&e.table_name=="cat_production_params"?r=" JSON":n.is_ref||n.hasOwnProperty("str_len")?r=" CHAR":n.date_part?r=" Date":n.hasOwnProperty("digits")?n.fraction_figits==0?r=" INT":r=" FLOAT":n.types.indexOf("boolean")!=-1?r=" BOOLEAN":r=" CHAR",r},this.sql_mask=function(e,t){var n=["delete","set","value","json","primary","content"];return", "+(t?"_t_.":"")+(n.some(function(t){return e.indexOf(t)!=-1})?"`"+e+"`":e)},this.mgr_by_class_name=function(e){if(e){var t=e.split(".");if(t[1]&&$p[t[0]])return $p[t[0]][t[1]]}},this.value_mgr=function(e,t,n,r,i){function s(e){return e&&n.types.length==1&&(n._mgr=e),e}var o,u,a,f,l;if(n._mgr)return n._mgr;if(n.types.length==1){a=n.types[0].split(".");if(a.length>1&&$p[a[0]])return s($p[a[0]][a[1]])}else if(i&&i.type){a=i.type.split(".");if(a.length>1&&$p[a[0]])return s($p[a[0]][a[1]])}o=e.property||e.param;if(t!="value"||!o){f=[],n.types.forEach(function(e){a=e.split("."),a.length>1&&$p[a[0]][a[1]]&&f.push($p[a[0]][a[1]])});if(f.length==1)return s(f[0]);if(r)return f;if((o=e[t])instanceof DataObj)return o._manager;if($p.is_guid(o)&&o!=$p.blank.guid)for(var c in f){l=f[c];if(l.get(o,!1,!0))return l}}else{u=_cch.properties.get(o,!1);if($p.is_data_obj(u)){if(u.is_new())return _cat.property_values;for(f in u.type.types)if(u.type.types[f].indexOf(".")>-1){a=u.type.types[f].split(".");break}if(a&&a.length>1&&$p[a[0]])return s($p[a[0]][a[1]])}}},this.control_by_type=function(e){var t;return e.is_ref?e.types.join().indexOf("enm.")==-1?t="ref":t="refc":e.date_part?t="dhxCalendar":e.digits?e.fraction_figits<5?t="calck":t="edn":e.types[0]=="boolean"?t="ch":e.str_len&&e.str_len>=100?t="txt":t="ed",t},this.ts_captions=function(e,t,n){n||(n={});var r=this.get(e).tabular_sections[t],i=this.get(e).form,s=r.fields,o;if(i&&i.obj){if(!i.obj.tabular_sections[t])return;n._mixin(i.obj.tabular_sections[t])}else{t==="contact_information"&&(s={type:"",kind:"",presentation:""}),n.fields=["row"],n.headers="№",n.widths="40",n.min_widths="",n.aligns="",n.sortings="na",n.types="cntr";for(var u in s)o=r.fields[u],o.hide||(n.fields.push(u),n.headers+=","+(o.synonym?o.synonym.replace(/,/g," "):u),n.types+=","+this.control_by_type(o.type),n.sortings+=",na")}return!0},this.syns_js=function(e){var t={DeletionMark:"deleted",Description:"name",DataVersion:"data_version",IsFolder:"is_folder",Number:"number_doc",Date:"date",Posted:"posted",Code:"id"};return t[e]?t[e]:n.syns_js[n.syns_1с.indexOf(e)]||e},this.syns_1с=function(e){var t={deleted:"DeletionMark",name:"Description",data_version:"DataVersion",is_folder:"IsFolder",number_doc:"Number",date:"Date",posted:"Posted",id:"Code"};return t[e]?t[e]:n.syns_1с[n.syns_js.indexOf(e)]||e},this.printing_plates=function(e){if(e)for(var t in e.doc)n.doc[t].printing_plates=e.doc[t]},_md=$p.md=this;for(r in n.enm)_enm[r]=new EnumManager(n.enm[r],"enm."+r);for(r in n.cat)_cat[r]=new CatManager("cat."+r);for(r in n.doc)_doc[r]=new DocManager("doc."+r);for(r in n.ireg)_ireg[r]=new InfoRegManager("ireg."+r);for(r in n.dp)_dp[r]=new DataProcessorsManager("dp."+r);for(r in n.cch)_cch[r]=new ChartOfCharacteristicManager("cch."+r);for(r in n.cacc)_cacc[r]=new ChartOfAccountManager("cacc."+r);return $p.modifiers.execute(),{md_date:n.md_date,cat_date:n.cat_date}}function DataManager(class_name){var _metadata=_md.get(class_name),_cachable,_events={after_create:[],after_load:[],before_save:[],after_save:[],value_change:[]};class_name.indexOf("enm.")!=-1?_cachable=!0:$p.job_prm.offline?_cachable=!0:class_name.indexOf("doc.")!=-1||class_name.indexOf("dp.")!=-1||class_name.indexOf("rep.")!=-1?_cachable=!1:_cachable=!0,!$p.job_prm.offline&&_metadata.hasOwnProperty("cachable")&&(_cachable=_metadata.cachable),this._define("_cachable",{value:_cachable,writable:!0,enumerable:!1}),this._define("class_name",{value:class_name,writable:!1,enumerable:!1}),this._define("alatable",{get:function(){return $p.wsql.aladb.tables[this.table_name]?$p.wsql.aladb.tables[this.table_name].data:[]},enumerable:!1}),this._define("metadata",{value:function(e){return e?_metadata.fields[e]||_metadata.tabular_sections[e]:_metadata},enumerable:!1}),this.attache_event=function(e,t,n){n?_events[e].push(t):_events[e].push(t)},this.handle_event=function(e,t,n){var r;return _events[t].forEach(function(t){r!==!1&&(r=t.call(e,n))}),r};var _obj_сonstructor=this._obj_сonstructor||DataObj;if(!(this instanceof EnumManager)){var obj_сonstructor_name=class_name.split(".")[1];this._obj_сonstructor=eval("(function "+obj_сonstructor_name.charAt(0).toUpperCase()+obj_сonstructor_name.substr(1)+"(attr, manager){manager._obj_сonstructor.superclass.constructor.call(this, attr, manager)})"),this._obj_сonstructor._extend(_obj_сonstructor);if(this instanceof InfoRegManager){delete this._obj_сonstructor.prototype.deleted,delete this._obj_сonstructor.prototype.ref,delete this._obj_сonstructor.prototype.lc_changed;for(var f in this.metadata().dimensions)this._obj_сonstructor.prototype._define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0});for(var f in this.metadata().resources)this._obj_сonstructor.prototype._define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0})}else{this._ts_сonstructors={};for(var f in this.metadata().fields)this._obj_сonstructor.prototype._define(f,{get:new Function("return this._getter('"+f+"')"),set:new Function("v","this._setter('"+f+"',v)"),enumerable:!0});for(var f in this.metadata().tabular_sections){var row_сonstructor_name=obj_сonstructor_name.charAt(0).toUpperCase()+obj_сonstructor_name.substr(1)+f.charAt(0).toUpperCase()+f.substr(1)+"Row";this._ts_сonstructors[f]=eval("(function "+row_сonstructor_name+"(owner) 			{owner._owner._manager._ts_сonstructors[owner._name].superclass.constructor.call(this, owner)})"),this._ts_сonstructors[f]._extend(TabularSectionRow);for(var rf in this.metadata().tabular_sections[f].fields)this._ts_сonstructors[f].prototype._define(rf,{get:new Function("return this._getter('"+rf+"')"),set:new Function("v","this._setter('"+rf+"',v)"),enumerable:!0});this._obj_сonstructor.prototype._define(f,{get:new Function("return this._getter_ts('"+f+"')"),set:new Function("v","this._setter_ts('"+f+"',v)"),enumerable:!0})}}}_obj_сonstructor=null}function RefDataManager(e){var t=this,n={};RefDataManager.superclass.constructor.call(t,e),t.push=function(e,t){t&&t!=e.ref?(delete n[e.ref],n[t]=e):n[e.ref]=e},t.all=function(){return n},t.each=function(e){for(var t in n){if(!t||t==$p.blank.guid)continue;if(e.call(this,n[t])==1)break}},t.get=function(e,r,i){var s=n[e]||n[e=$p.fix_guid(e)];if(!s){if(i)return;s=new t._obj_сonstructor(e,t,!0)}return r===!1?s:r===undefined&&e===$p.blank.guid?s:!t._cachable||s.is_new()?s.load():r?Promise.resolve(s):s},t.create=function(e,r){var i=n[e.ref];if(!i){i=new t._obj_сonstructor(e,t);if(r){var s=i._obj;for(var o in t.metadata().fields)s[o]==undefined&&(s[o]="")}}return i},t.find=function(e){return $p._find(n,e)},t.find_rows=function(e,t){return $p._find_rows(n,e,t)},t.save=function(e){return e&&(e.specify||$p.is_guid(e.ref)&&!t._cachable)?_load({class_name:t.class_name,action:e.action||"save",attr:e}).then(JSON.parse):Promise.reject()},t.load_array=function(e){var r,i;for(var s in e)r=$p.fix_guid(e[s]),(i=n[r])?i.is_new()&&(i._mixin(e[s]),i._set_loaded()):new t._obj_сonstructor(e[s],t)},t.predefined=function(e){var n=t.metadata().predefined[e];return n?t.get(n.ref):undefined},t.first_folder=function(e){for(var r in n){var i=n[r];if(i.is_folder&&(!e||$p.is_equal(e,i.owner)))return i}return t.get()}}function DataProcessorsManager(e){DataProcessorsManager.superclass.constructor.call(this,e),this.create=function(){return new this._obj_сonstructor({},this)}}function EnumManager(e,t){EnumManager.superclass.constructor.call(this,t),this._obj_сonstructor=EnumObj,this.push=function(e,t){this._define(t,{value:e,enumerable:!1})},this.get=function(e){if(e instanceof EnumObj)return e;if(!e||e==$p.blank.guid)e="_";var t=this[e];return t||(t=new EnumObj({name:e},this)),t},this.each=function(e){this.alatable.forEach(function(t){t.ref&&t.ref!=$p.blank.guid&&e.call(this[t.ref])})};for(var n in e)new EnumObj(e[n],this)}function RegisterManager(e){var t={};this._obj_сonstructor=RegisterRow,RegisterManager.superclass.constructor.call(this,e),this.push=function(e,n){n&&n!=e.ref?(delete t[e.ref],t[n]=e):t[e.ref]=e},this.get=function(e,n,r){e||(e={}),e.action="select";var i=alasql(this.get_sql_struct(e),e._values),s;delete e.action,delete e._values;if(i.length)if(r)s=t[this.get_ref(i[0])];else{s=[];for(var o in i)s.push(t[this.get_ref(i[o])])}return n?Promise.resolve(s):s},this.load_array=function(e){var n,r,i=[];for(var s in e)n=this.get_ref(e[s]),(r=t[n])?r._mixin(e[s]):new this._obj_сonstructor(e[s],this),i.push(t[n]);return i}}function InfoRegManager(e){InfoRegManager.superclass.constructor.call(this,e)}function AccumRegManager(e){AccumRegManager.superclass.constructor.call(this,e)}function CatManager(e){this._obj_сonstructor=CatObj,CatManager.superclass.constructor.call(this,e),this.metadata().hierarchical&&this.metadata().group_hierarchy&&this._obj_сonstructor.prototype._define("is_folder",{get:function(){return this._obj.is_folder||!1},set:function(e){this._obj.is_folder=$p.fix_boolean(e)},enumerable:!0})}function ChartOfCharacteristicManager(e){this._obj_сonstructor=CatObj,ChartOfCharacteristicManager.superclass.constructor.call(this,e)}function ChartOfAccountManager(e){this._obj_сonstructor=CatObj,ChartOfAccountManager.superclass.constructor.call(this,e)}function DocManager(e){this._obj_сonstructor=DocObj,DocManager.superclass.constructor.call(this,e)}function TabularSection(e,t){t._obj[e]||(t._obj[e]=[]),this._define("_name",{value:e,enumerable:!1}),this._define("_owner",{value:t,enumerable:!1}),this._define("_obj",{value:t._obj[e],writable:!1,enumerable:!1})}function TabularSectionRow(e){var t={};this._define("_owner",{value:e,enumerable:!1}),this._define("_obj",{value:t,writable:!1,enumerable:!1})}function DataObj(e,t){var n,r,i={},s={data_version:""},o=!(this instanceof EnumObj);!(t instanceof DataProcessorsManager)&&!(t instanceof EnumManager)&&(r=t.get(e,!1,!0));if(r)return r;t instanceof EnumManager?s.ref=n=e.name:t instanceof RegisterManager?n=t.get_ref(e):(s.ref=n=$p.fix_guid(e),s.deleted=!1,s.lc_changed=0),this._define("_manager",{value:t,enumerable:!1}),this._define("is_new",{value:function(){return o},enumerable:!1}),this._define("_set_loaded",{value:function(e){o=!1,t.push(this,e)},enumerable:!1}),this._define("_obj",{value:s,writable:!1,enumerable:!1}),this._define("_ts_",{value:function(e){return i[e]||(i[e]=new TabularSection(e,this)),i[e]},enumerable:!1}),t.alatable&&t.push&&(t.alatable.push(s),t.push(this,n))}function CatObj(e,t){var n="";CatObj.superclass.constructor.call(this,e,t),this._define("presentation",{get:function(){return this.name||this.id?this.name||this.id||this._metadata.obj_presentation:n},set:function(e){e&&(n=String(e))},enumerable:!1}),e&&typeof e=="object"&&this._mixin(e),!$p.is_empty_guid(this.ref)&&(e.id||e.name)&&this._set_loaded(this.ref)}function DocObj(e,t){var n="";DocObj.superclass.constructor.call(this,e,t),this._define("presentation",{get:function(){return this.number_str||this.number_doc?this._metadata.obj_presentation+" №"+(this.number_str||this.number_doc)+" от "+$p.dateFormat(this.date,$p.dateFormat.masks.ru):n},set:function(e){e&&(n=String(e))},enumerable:!1}),e&&typeof e=="object"&&this._mixin(e),!$p.is_empty_guid(this.ref)&&e.number_doc&&this._set_loaded(this.ref)}function DataProcessorObj(e,t){DataProcessorObj.superclass.constructor.call(this,e,t);var n,r=t.metadata();for(n in r.fields)e[n]=$p.fetch_type("",r.fields[n].type);for(n in r.tabular_sections)e[n]=[];this._mixin(e),this.unload=function(){for(n in this)this[n]instanceof TabularSection?(this[n].clear(),delete this[n]):typeof this[n]!="function"&&delete this[n]}}function EnumObj(e,t){EnumObj.superclass.constructor.call(this,e,t),e&&typeof e=="object"&&this._mixin(e)}function RegisterRow(e,t){RegisterRow.superclass.constructor.call(this,e,t),e&&typeof e=="object"&&this._mixin(e)}function Rest(){this.filter_date=function(e,t,n){t||(t=new Date("2015-01-01"));var r=e+" gt datetime'"+$p.dateFormat(t,$p.dateFormat.masks.isoDateTime)+"'";return n&&(r+=" and "+e+" lt datetime'"+$p.dateFormat(n,$p.dateFormat.masks.isoDateTime)+"'"),r},this.to_data=function(e,t){var n={},r=t.metadata().fields,i=t.metadata().tabular_sections,s,o,u,a,f,l,c;t instanceof RefDataManager?(n.deleted=e.DeletionMark,n.data_version=e.DataVersion):r=[]._mixin(t.metadata().dimensions)._mixin(t.metadata().resources),t instanceof DocManager?(n.number_doc=e.Number,n.date=e.Date,n.posted=e.Posted):(t.metadata().main_presentation_name&&(n.name=e.Description),t.metadata().code_length&&(n.id=e.Code));for(o in r)f=_md.syns_1с(o),r[o].type.is_ref&&e[f+"_Key"]&&(f+="_Key"),n[o]=e[f];for(s in i)l=_md.syns_1с(s),n[s]=[],e[l].sort(function(e,t){return e.LineNumber>t.LineNumber}),e[l].forEach(function(e){a={};for(u in i[s].fields)f=_md.syns_1с(u),i[s].fields[u].type.is_ref&&e[f+"_Key"]&&(f+="_Key"),a[u]=e[f];n[s].push(a)});return n},this.ajax_to_data=function(e,t){return $p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){var n=[];return e.value.forEach(function(e){n.push(_rest.to_data(e,t))}),n})}}function wnd_appcache(e){function t(){r.wnd_appcache=e.iface.w.createWindow("wnd_appcache",0,0,490,250);var t=[{type:"block",name:"form_block_1",list:[{type:"label",name:"form_label_1",label:e.msg.sync_script},{type:"block",name:"form_block_2",list:[{type:"template",name:"img_long",className:"img_long"},{type:"newcolumn"},{type:"template",name:"text_processed"},{type:"template",name:"text_current"},{type:"template",name:"text_bottom"}]}]},{type:"button",name:"form_button_1",value:e.msg.sync_break}];r.frm_appcache=r.wnd_appcache.attachForm(t),r.frm_appcache.attachEvent("onButtonClick",function(e){r&&(r.do_break=!0)}),r.wnd_appcache.setText(e.msg.long_operation),r.wnd_appcache.denyResize(),r.wnd_appcache.centerOnScreen(),r.wnd_appcache.button("park").hide(),r.wnd_appcache.button("minmax").hide(),r.wnd_appcache.button("close").hide()}var n=e.iface.appcache={},r;n.create=function(e){r=e,t()},n.update=function(){r.frm_appcache.setItemValue("text_processed","Обработано элементов: "+r.loaded+" из "+r.total)},n.close=function(){r&&r.wnd_appcache&&(r.wnd_appcache.close(),delete r.wnd_appcache)}}var $p=new MetaEngine;window&&(window.$p=$p),typeof define=="function"&&define.amd?define("$p",$p):typeof module=="object"&&module&&(module.exports=$p),Object.defineProperty(Object.prototype,"_define",{value:function(e,t){return t?Object.defineProperty(this,e,t):Object.defineProperties(this,e),this},enumerable:!1}),Object.prototype._define("_extend",{value:function(e){var t=function(){};t.prototype=e.prototype,this.prototype=new t,this.prototype.constructor=this,this._define("superclass",{value:e.prototype,enumerable:!1})},enumerable:!1}),Object.prototype._define("_mixin",{value:function(e){var t={};for(var n in e)if(typeof t[n]=="undefined"||t[n]!=e[n])this[n]=e[n];return this},enumerable:!1}),Object.prototype._define("_clone",{value:function(){if(!this||"object"!=typeof this)return this;var e,t,n="function"==typeof this.pop?[]:{};for(e in this)this.hasOwnProperty(e)&&(t=this[e],t&&"object"==typeof t?n[e]=t._clone():n[e]=t);return n},enumerable:!1}),$p.load_script=function(e,t,n){var r=document.createElement(t);t=="script"?(r.type="text/javascript",r.src=e,n?(r.async=!0,r.addEventListener("load",n,!1)):r.async=!1):(r.type="text/css",r.rel="stylesheet",r.href=e),document.head.appendChild(r)},typeof Promise!="function"&&$p.load_script("https://www.promisejs.org/polyfills/promise-7.0.1.min.js","script"),function(e){var t,n,r,i=!0,s=!0;if("dhtmlx"in e){for(t in document.scripts){if(document.scripts[t].src.indexOf("metadata.js")!=-1){r="metadata.js",n=document.scripts[t].src;break}if(document.scripts[t].src.indexOf("metadata.min.js")!=-1){r="metadata.min.js",n=document.scripts[t].src;break}}for(t=0;t<document.styleSheets.length;t++)document.styleSheets[t].href&&(document.styleSheets[t].href.indexOf("dhtmlx.css")!=-1?i=!1:document.styleSheets[t].href.indexOf("metadata.css")!=-1&&(s=!1));i&&$p.load_script(n.replace(r,"dhtmlx.css"),"link"),s&&$p.load_script(n.replace(r,"metadata.css"),"link"),dhtmlx.image_path=n.replace(r,"imgs/"),dhtmlx.skin="dhx_web",dhx4.ajax.cache=!0}}(window||{}),$p.dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(e,t){e=String(e),t=t||2;while(e.length<t)e="0"+e;return e};return function(i,s,o){var u=$p.dateFormat;s||(s=$p.dateFormat.masks.ru),arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)&&(s=i,i=undefined),i=i?new Date(i):new Date,isNaN(i)&&(i=new Date(0)),s=String(u.masks[s]||s||u.masks["default"]),s.slice(0,4)=="UTC:"&&(s=s.slice(4),o=!0);var a=o?"getUTC":"get",f=i[a+"Date"](),l=i[a+"Day"](),c=i[a+"Month"](),h=i[a+"FullYear"](),p=i[a+"Hours"](),d=i[a+"Minutes"](),v=i[a+"Seconds"](),m=i[a+"Milliseconds"](),g=o?0:i.getTimezoneOffset(),y={d:f,dd:r(f),ddd:u.i18n.dayNames[l],dddd:u.i18n.dayNames[l+7],m:c+1,mm:r(c+1),mmm:u.i18n.monthNames[c],mmmm:u.i18n.monthNames[c+12],yy:String(h).slice(2),yyyy:h,h:p%12||12,hh:r(p%12||12),H:p,HH:r(p),M:d,MM:r(d),s:v,ss:r(v),l:r(m,3),L:r(m>99?Math.round(m/10):m),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:o?"UTC":(String(i).match(t)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+r(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10]};return s.replace(e,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}(),$p.dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",atom:"yyyy-mm-dd'T'HH:MM:ss'Z'",ru:"dd.mm.yyyy HH:MM",short_ru:"dd.mm.yyyy",date:"dd.mm.yy",date_time:"dd.mm.yy HH:MM"},$p.ajax=new function(){function e(e,t,n,r,i){return new Promise(function(s,o){var u=new XMLHttpRequest;if(r){var a,f;typeof r=="object"&&r.username&&r.hasOwnProperty("password")?(a=r.username,f=r.password):(a=$p.ajax.username,f=$p.ajax.password),u.open(e,t,!0,a,f),u.withCredentials=!0,u.setRequestHeader("Authorization","Basic "+btoa(unescape(encodeURIComponent(a+":"+f))))}else u.open(e,t,!0);i&&i.call(this,u),e=="POST"?this.hide_headers||(u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.setRequestHeader("X-Requested-With","XMLHttpRequest")):n=null,u.onload=function(){u.status==200&&(u.response instanceof Blob||u.response.substr(0,9)!=="<!DOCTYPE")?s(u):u.response?o({message:u.statusText,description:u.response,status:u.status}):o(Error(u.statusText))},u.onerror=function(){o(Error("Network Error"))},u.send(n)})}this.username="",this.password="",this.authorized=!1,this.get=function(n){return e("GET",n)},this.post=function(n,r){return arguments.length==1?r="":arguments.length==2&&typeof r=="function"?(onLoad=r,r=""):r=String(r),e("POST",n,r)},this.get_ex=function(n,r,i){return e("GET",n,null,r,i)},this.post_ex=function(n,r,i,s){return e("POST",n,r,i,s)},this.put_ex=function(n,r,i,s){return e("PUT",n,r,i,s)},this.delete_ex=function(n,r,i){return e("DELETE",n,null,r,i)},this.get_and_show_blob=function(e,t){var n="menubar=no,toolbar=no,location=no,status=no,directories=no,resizable=yes,scrollbars=yes",r;return this.post_ex(e,typeof t=="object"?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(function(t){return e=window.URL.createObjectURL(t.response),r=window.open(e,"wnd_print",n),r.onload=function(t){window.URL.revokeObjectURL(e)},r})},this.get_and_save_blob=function(e,t,n){return this.post_ex(e,typeof t=="object"?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(function(e){require("filesaver").saveAs(e.response,n)})},this.default_attr=function(e,t){e.url||(e.url=t),e.username||(e.username=this.username),e.password||(e.password=this.password)}},$p.m={point_pos:function(e,t,n,r,i,s){return Math.abs(n-i)<.2?(e-n)*(r-s):Math.abs(r-s)<.2?(t-r)*(i-n):(t-r)*(i-n)-(s-r)*(e-n)},arc_cntr:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d;if(s){var v=e,m=t;e=n,t=r,n=v,r=m}return e!=n?(o=(e*e-n*n-r*r+t*t)/(2*(e-n)),u=(r-t)/(e-n),a=u*u+1,f=-2*((e-o)*u+t),l=(e-o)*(e-o)-i*i+t*t,c=(-f+Math.sqrt(f*f-4*a*l))/(2*a),h=o+u*c,p=(-f-Math.sqrt(f*f-4*a*l))/(2*a),d=o+u*p):(o=(t*t-r*r-n*n+e*e)/(2*(t-r)),u=(n-e)/(t-r),a=u*u+1,f=-2*((t-o)*u+e),l=(t-o)*(t-o)-i*i+e*e,h=(-f-Math.sqrt(f*f-4*a*l))/(2*a),c=o+u*h,d=(-f+Math.sqrt(f*f-4*a*l))/(2*a),p=o+u*d),$p.m.point_pos(h,c,e,t,n,r)>0?{x:h,y:c}:{x:d,y:p}},arc_point:function(e,t,n,r,i,s,o){var u={x:(e+n)/2,y:(t+r)/2};if(i>0){var a=e-n,f=t-r,l=i*i-(a*a+f*f)/4,c,h,p;l>=0&&(p=$p.m.arc_cntr(e,t,n,r,i,s),a=p.x-u.x,f=u.y-p.y,c=Math.sqrt(a*a+f*f),o?h=i+Math.sqrt(l):h=i-Math.sqrt(l),u.x+=a*h/c,u.y+=f*h/c)}return u}},$p.blank=new function(){this.date=new Date("0001-01-01"),this.guid="00000000-0000-0000-0000-000000000000",this.by_type=function(e){var t;return e.is_ref?t=$p.blank.guid:e.date_part?t=$p.blank.date:e.digits?t=0:e.types&&e.types[0]=="boolean"?t=!1:t="",t}},$p.is_guid=function(e){return typeof e!="string"||e.length<36?!1:(e.length>36&&(e=e.substr(0,36)),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e))},$p.is_empty_guid=function(e){return!e||e===$p.blank.guid},$p.generate_guid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t=="x"?n:n&7|8).toString(16)})},$p.fix_guid=function(e,t){if(!e||typeof e!="string"){if(e instanceof DataObj)return e.ref;if(e&&typeof e=="object")if(e.presentation){if(e.ref)return e.ref;if(e.name)return e.name}else e=typeof e.ref=="object"&&e.ref.hasOwnProperty("ref")?e.ref.ref:e.ref}return $p.is_guid(e)||t===!1?e:t?$p.generate_guid():$p.blank.guid},$p.fix_number=function(e,t){var n=parseFloat(e);return isNaN(n)?t?0:e:n},$p.fix_boolean=function(e){return typeof e=="string"?!!e&&e.toLowerCase()!="false":!!e},$p.fix_date=function(e,t){var n=/(^\d{1,4}[\.|\\/|-]\d{1,2}[\.|\\/|-]\d{1,4})(\s*(?:0?[1-9]:[0-5]|1(?=[012])\d:[0-5])\d\s*[ap]m)?$/,r;if(e&&typeof e=="string"&&n.test(e.substr(0,10))){r=new Date(e);if(r&&r.getFullYear()>0)return r}return t?$p.blank.date:e},$p.date_add_day=function(e,t){var n=new Date;return n.setDate(e.getDate()+t),n},$p.cancel_bubble=function(e){var t=e||event;return t.stopPropagation&&t.stopPropagation(),t.cancelBubble||(t.cancelBubble=!0),!1},$p.scale_svg=function(e,t,n){var r,i,s,o,u,a,f={};u=e.indexOf(">"),s=e.substring(5,u).split(" "),o=e.substr(u+1),o=o.substr(0,o.length-6);for(r in s){e=s[r].split("=");if(e[0]=="width"||e[0]=="height")e[1]=Number(e[1].replace(/"/g,"")),f[e[0]]=e[1]}return a='viewBox="0 0 '+(f.width-n)+" "+(f.height-n)+'"',i=t/(f.height-n),f.height=t,f.width=Math.round(f.width*i),'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+f.width+'" height="'+f.height+'" xml:space="preserve" '+a+">"+o+"</svg>"},$p.normalize_xml=function(e){if(!e)return"";var t={"&":"&amp;",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;"};return e.replace(/[&"'<>]/g,function(e){return t[e]})},$p.bind_help=function(e,t){function n(e){if(!e.help_path){$p.msg.show_msg({title:"Справка",type:"alert-info",text:$p.msg.not_implemented});return}}e instanceof dhtmlXLayoutCell||(!e.help_path&&t&&(e.help_path=t),e.button("help").show(),e.button("help").enable(),e.attachEvent("onHelp",n))},$p.get_offset=function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},$p.msg=new function(){this.toString=function(){return"Интернационализация сообщений"},"dhtmlx"in(window||{})&&(this.show_msg=function(e,t){if(!e)return;if(typeof e=="string"){if($p.iface.synctxt){$p.iface.synctxt.show_message(e);return}e={type:"info",text:e}}t&&typeof t.setText=="function"&&t.setText(e.text),dhtmlx.message(e)},this.check_soap_result=function(e){if(!e)return $p.msg.show_msg({type:"alert-error",text:$p.msg.empty_response,title:$p.msg.error_critical}),!0;if(e.error=="limit_query")return $p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.limit_query.replace("%1",e.queries).replace("%2",e.queries_avalable),title:$p.msg.srv_overload}),!0;if(e.error=="network"||e.error=="empty")return $p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.error_network,title:$p.msg.error_critical}),!0;if(e.error&&e.error_description)return $p.iface.docs.progressOff(),e.error_description.indexOf("Недостаточно прав")!=-1&&(e.error_type="alert-warning",e.error_title=$p.msg.error_rights),$p.msg.show_msg({type:e.error_type||"alert-error",text:e.error_description,title:e.error_title||$p.msg.error_critical}),!0;if(e.error&&!e.messages)return $p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-error",title:$p.msg.error_critical,text:$p.msg.unknown_error.replace("%1","unknown_error")}),!0},this.show_not_implemented=function(){$p.msg.show_msg({type:"alert-warning",text:$p.msg.not_implemented,title:$p.msg.main_title})})},$p.iface=new InterfaceObjs,$p.eve=new function(){this.toString=function(){return"События при начале работы программы"},this.onload=[]},$p.modifiers=new function(){var e=[];this.push=function(n){e.push(n)},this.execute=function(){e.forEach(function(e){typeof e=="function"?e($p):require(e)($p)})}},$p.wsql=function(){},function(e){function t(e,t){return t=="object"?e?$p.fix_guid(JSON.parse(e)):{}:t=="number"?$p.fix_number(e,!0):t=="date"?$p.fix_date(e,!0):t=="boolean"?$p.fix_boolean(e):e}var n={},r=0;window.alasql?e.aladb=new alasql.Database("md"):r=1e3,e.exec=function(t,n,i,s){if(r<10){r++,setTimeout(function(){e.exec(t,n,i,s)},1e3);return}if(r<100)throw new TypeError("alasql init error");Array.isArray(n)||(n=[n]);var o,u=[];try{i?alasql(t,n,function(e){i(e,s)}):alasql(t,n)}catch(a){i&&i(a)}},e.promise=function(e,t){return new Promise(function(n,r){alasql(e,t,function(e,t){t?r(t):n(e)})})},e.set_user_param=function(e,t,r){var i=t;typeof t=="object"?i=JSON.stringify(t):t===!1&&(i=""),window&&window.localStorage&&localStorage.setItem(e,i),n[e]=t,r&&r([])},e.get_user_param=function(e,r){return!n.hasOwnProperty(e)&&localStorage&&(n[e]=t(localStorage.getItem(e),r)),n[e]},e.save_options=function(t,n){e.set_user_param(t+"_"+n.name,n)},e.restore_options=function(t,n){var r=e.get_user_param(t+"_"+n.name,"object");for(var i in r)if(typeof r[i]!="object")n[i]=r[i];else{n[i]||(n[i]={});for(var s in r[i])n[i][s]=r[i][s]}return n},e.init_params=function(t){var n=[{p:"user_name",v:"",t:"string"},{p:"user_pwd",v:"",t:"string"},{p:"browser_uid",v:$p.generate_guid(),t:"string"},{p:"zone",v:$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1,t:"number"},{p:"zone_unf",v:1,t:"number"},{p:"phantom_url",v:"/p/",t:"string"},{p:"enable_save_pwd",v:"",t:"boolean"},{p:"reset_local_data",v:"",t:"boolean"},{p:"autologin",v:"",t:"boolean"},{p:"cache_md_date",v:0,t:"number"},{p:"cache_cat_date",v:0,t:"number"},{p:"files_date",v:20150614e4,t:"number"},{p:"margin",v:60,t:"number"},{p:"discount",v:15,t:"number"},{p:"offline",v:$p.job_prm.offline,t:"boolean"}],i;$p.job_prm.additionsl_params&&(n=n.concat($p.job_prm.additionsl_params)),n.forEach(function(t){(e.get_user_param(t.p,t.t)==undefined||!e.get_user_param(t.p,t.t)&&(t.p.indexOf("url")!=-1||t.p.indexOf("zone")!=-1))&&e.set_user_param(t.p,t.v)}),e.set_user_param("cache_md_date",0),e.set_user_param("cache_cat_date",0),e.set_user_param("reset_local_data",""),$p.job_prm.url_prm.hasOwnProperty("zone")?i=$p.fix_number($p.job_prm.url_prm.zone,!0):(i=localStorage.getItem("hs_url"))&&(i=i.match(/\/[0-9]+\//))?i=$p.fix_number(i[0].replace("/","").replace("/","")):localStorage.getItem("zone")||(i=1),i&&(e.set_user_param("zone",i),localStorage.removeItem("hs_url"),localStorage.removeItem("ws_url"),localStorage.removeItem("rest_url"),localStorage.removeItem("unf_url")),window.alasql?$p.job_prm.create_tables?$p.job_prm.create_tables_sql?alasql($p.job_prm.create_tables_sql,[],function(){r=1e3,delete $p.job_prm.create_tables_sql,t([])}):$p.ajax.get($p.job_prm.create_tables).then(function(e){alasql(e.response,[],function(){r=1e3,t([])})}):t([]):t([])},e.drop_tables=function(e){function t(){i--,i<=0?setTimeout(e,10):n()}function n(){var e=s[i-1].tableid;e.substr(0,1)=="_"?t():alasql("drop table IF EXISTS "+e,[],t)}function r(e){s=e,(i=e.length)?n():t()}var i=0,s=[];alasql("SHOW TABLES",[],r)},e.dump=function(e){function t(t){t.forEach(function(e){i+=alasql("show create table "+e.tableid)+";\n"}),console.log(i),setTimeout(e,10)}var n=0,r=[],i="",s="";$p.wsql.exec("SHOW TABLES",[],t)},e.toString=function(){return"JavaScript SQL engine"}}($p.wsql);var msg=$p.msg;$p.dateFormat.i18n={dayNames:["Вс","Пн","Вт","Ср","Чт","Пт","Сб","Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],monthNames:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек","Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"]},"dhx4"in(window||{})&&(dhx4.dateFormat.ru="%d.%m.%Y",dhx4.dateLang="ru",dhx4.dateStrings={ru:{monthFullName:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShortName:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFullName:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShortName:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]}}),$p.fias=function(){},function(e){e.toString=function(){return"Коды адресного классификатора"},e.types=["владение","здание","помещение"],e[1010]={name:"дом",type:1,order:1,fid:2,syn:[" д."," д "," дом"]},e[1020]={name:"владение",type:1,order:2,fid:1,syn:[" вл."," вл "," влад."," влад "," владен."," владен "," владение"]},e[1030]={name:"домовладение",type:1,order:3,fid:3},e[1050]={name:"корпус",type:2,order:1,syn:[" к."," к "," корп."," корп ","корпус"]},e[1060]={name:"строение",type:2,order:2,fid:1,syn:[" стр."," стр "," строен."," строен ","строение"]},e[1080]={name:"литера",type:2,order:3,fid:3,syn:[" л."," л "," лит."," лит ","литера"]},e[1070]={name:"сооружение",type:2,order:4,fid:2,syn:[" соор."," соор "," сооруж."," сооруж ","сооружение"]},e[1040]={name:"участок",type:2,order:5,syn:[" уч."," уч ","участок"]},e[2010]={name:"квартира",type:3,order:1,syn:["кв.","кв ","кварт.","кварт ","квартира","-"]},e[2030]={name:"офис",type:3,order:2,syn:["оф.","оф ","офис","-"]},e[2040]={name:"бокс",type:3,order:3},e[2020]={name:"помещение",type:3,order:4},e[2050]={name:"комната",type:3,order:5,syn:["комн.","комн ","комната"]},e[101e5]={name:"Почтовый индекс"},e[102e5]={name:"Адресная точка"},e[103e5]={name:"Садовое товарищество"},e[104e5]={name:"Элемент улично-дорожной сети, планировочной структуры дополнительного адресного элемента"},e[105e5]={name:"Промышленная зона"},e[106e5]={name:"Гаражно-строительный кооператив"},e[107e5]={name:"Территория"}}($p.fias),msg.store_url_od="https://chrome.google.com/webstore/detail/hcncallbdlondnoadgjomnhifopfaage",msg.align_node_right="Уравнять вертикально вправо",msg.align_node_bottom="Уравнять горизонтально вниз",msg.align_node_top="Уравнять горизонтально вверх",msg.align_node_left="Уравнять вертикально влево",msg.align_set_right="Установить размер сдвигом вправо",msg.align_set_bottom="Установить размер сдвигом вниз",msg.align_set_top="Установить размер сдвигом вверх",msg.align_set_left="Установить размер сдвигом влево",msg.align_invalid_direction="Неприменимо для элемента с данной ориентацией",msg.argument_is_not_ref="Аргумент не является ссылкой",msg.addr_title="Ввод адреса",msg.cache_update_title="Обновление кеша браузера",msg.cache_update="Выполняется загрузка измененных файлов<br/>и их кеширование в хранилище браузера",msg.delivery_area_empty="Укажите район доставки",msg.empty_login_password="Не указаны имя пользователя или пароль",msg.empty_response="Пустой ответ сервера",msg.empty_geocoding="Пустой ответ геокодера. Вероятно, отслеживание адреса запрещено в настройках браузера",msg.error_auth="Авторизация пользователя не выполнена",msg.error_critical="Критическая ошибка",msg.error_metadata="Ошибка загрузки метаданных конфигурации",msg.error_network="Ошибка сети или сервера - запрос отклонен",msg.error_rights="Ограничение доступа",msg.file_size="Запрещена загрузка файлов<br/>размером более ",msg.file_confirm_delete="Подтвердите удаление файла ",msg.file_new_date="Файлы на сервере обновлены<br /> Рекомендуется закрыть браузер и войти<br />повторно для применения обновления",msg.file_new_date_title="Версия файлов",msg.init_catalogues="Загрузка справочников с сервера",msg.init_catalogues_meta=": Метаданные объектов",msg.init_catalogues_tables=": Реструктуризация таблиц",msg.init_catalogues_nom=": Базовые типы + номенклатура",msg.init_catalogues_sys=": Технологические справочники",msg.init_login="Укажите имя пользователя и пароль",msg.requery="Повторите попытку через 1-2 минуты",msg.limit_query="Превышено число обращений к серверу<br/>Запросов за минуту:%1<br/>Лимит запросов:%2<br/>"+msg.requery,msg.main_title="Окнософт: заказ дилера ",msg.meta_cat="Справочники",msg.meta_doc="Документы",msg.meta_cch="Планы видов характеристик",msg.meta_cacc="Планы счетов",msg.meta_ireg="Регистры сведений",msg.meta_areg="Регистры накопления",msg.meta_mgr="Менеджер",msg.meta_cat_mgr="Менеджер справочников",msg.meta_doc_mgr="Менеджер документов",msg.meta_enn_mgr="Менеджер перечислений",msg.meta_ireg_mgr="Менеджер регистров сведений",msg.meta_areg_mgr="Менеджер регистров накопления",msg.meta_accreg_mgr="Менеджер регистров бухгалтерии",msg.meta_dp_mgr="Менеджер обработок",msg.meta_reports_mgr="Менеджер отчетов",msg.meta_charts_of_accounts_mgr="Менеджер планов счетов",msg.meta_charts_of_characteristic_mgr="Менеджер планов видов характеристик",msg.meta_extender="Модификаторы объектов и менеджеров",msg.no_metadata="Не найдены метаданные объекта '%1'",msg.no_selected_row="Не выбрана строка табличной части '%1'",msg.no_dhtmlx="Библиотека dhtmlx не загружена",msg.not_implemented="Не реализовано в текущей версии",msg.offline_request="Запрос к серверу в автономном режиме",msg.onbeforeunload="Окнософт: легкий клиент. Закрыть программу?",msg.order_sent_title="Подтвердите отправку заказа",msg.order_sent_message="Отправленный заказ нельзя изменить.<br/>После проверки менеджером<br/>он будет запущен в работу",msg.request_title="Окнософт: Запрос регистрации",msg.request_message="Заявка зарегистрирована. После обработки менеджером будет сформировано ответное письмо",msg.srv_overload="Сервер перегружен",msg.sub_row_change_disabled="Текущая строка подчинена продукции.<br/>Строку нельзя изменить-удалить в документе<br/>только через построитель",msg.long_operation="Длительная операция",msg.sync_script="Обновление скриптов приложения:",msg.sync_data="Синхронизация с сервером выполняется:<br />* при первом старте программы<br /> * при обновлении метаданных<br /> * при изменении цен или технологических справочников",msg.sync_break="Прервать синхронизацию",msg.unsupported_browser_title="Браузер не поддерживается",msg.unsupported_browser="Несовместимая версия браузера<br/>Рекомендуется Google Chrome",msg.supported_browsers="Рекомендуется Chrome, Safari или Opera",msg.unsupported_mode_title="Режим не поддерживается",msg.unsupported_mode="Программа не установлена<br/> в <a href='"+msg.store_url_od+"'>приложениях Google Chrome</a>",msg.unknown_error="Неизвестная ошибка в функции '%1'",msg.bld_constructor="Конструктор объектов графического построителя",msg.bld_title="Графический построитель",msg.bld_empty_param="Не заполнен обязательный параметр <br />",msg.bld_not_product="В текущей строке нет изделия построителя",msg.bld_not_draw="Отсутствует эскиз или не указана система профилей",msg.bld_wnd_title="Построитель изделия № ",msg.bld_from_blocks_title="Выбор типового блока",msg.bld_from_blocks="Текущее изделие будет заменено конфигурацией типового блока. Продолжить?",msg.bld_split_imp="В параметрах продукции<br />'%1'<br />запрещены незамкнутые контуры<br />Для включения деления импостом,<br />установите это свойство в 'Истина'";var eXcell_proto=new eXcell;eXcell_ref.prototype=eXcell_proto,window.eXcell_ref=eXcell_ref,eXcell_refc.prototype=eXcell_proto,window.eXcell_refc=eXcell_refc,eXcell_rsvg.prototype=eXcell_proto,window.eXcell_rsvg=eXcell_rsvg,$p.iface.Svgs=function(e,t,n){function r(){u.style.display=f?"none":"";if(t.setSizes)t.setSizes();else{var e=t.getDimension();t.setDimension(e[0],e[1]),t.maximize()}f?(o.style.backgroundPositionX="-32px",o.style.top=t.setSizes?"16px":"-18px"):(o.style.backgroundPositionX="0px",o.style.top="0px")}function i(e){var t,n,r,i;$p.iface.clear_svgs(u);if(!!e.svgs.length)for(t in e.svgs){if(!e.svgs[t]||e.svgs[t].substr(0,1)!="<")continue;i=document.createElement("div"),u.appendChild(i),i.style["float"]="left",i.innerHTML=$p.scale_svg(e.svgs[t],88,22)}}var s=this,o=document.createElement("div"),u=document.createElement("div"),a=[],f=$p.wsql.get_user_param("svgs_area_hidden","boolean"),l=n.querySelector(".dhx_cell_statusbar_text");l&&(l.style.display="none"),u.className="svgs-area",n.firstChild?n.insertBefore(u,n.firstChild):n.appendChild(u),o.className="svgs-minmax",o.title="Скрыть/показать панель эскизов",o.onclick=function(){f=!f,$p.wsql.set_user_param("svgs_area_hidden",f),r(),!f&&a.length&&s.reload()},n.appendChild(o),r(),this.reload=function(t){t&&a.push(t),f||setTimeout(function(){a.length&&(e.save({ref:a.pop(),specify:"order_pics",action:"calc",async:!0}).then(i).catch(function(e){console.log(e)}),a.length=0)},300)}},$p.iface.Toolbar_filter=function(e){var t=this,n=350,r=0;e.pos||(e.pos=6);if(e.manager instanceof DocManager||e.period){function i(e,n){n=="min"?t.сalendar.setSensitiveRange(e.value,null):t.сalendar.setSensitiveRange(null,e.value)}function s(){r&&(clearTimeout(r),r=0),e.onchange.call(t,t.get_filter())}function o(){r&&clearTimeout(r),r=setTimeout(function(){r&&s()},600)}n=180,e.toolbar.addText("lbl_date_from",e.pos,"Период с:"),e.pos++,e.toolbar.addInput("input_date_from",e.pos,"",72),e.pos++,e.toolbar.addText("lbl_date_till",e.pos,"по:"),e.pos++,e.toolbar.addInput("input_date_till",e.pos,"",72),e.pos++,t.input_date_from=e.toolbar.getInput("input_date_from"),t.input_date_from.setAttribute("readOnly","true"),t.input_date_from.onclick=function(){i(t.input_date_till,"max")},t.input_date_till=e.toolbar.getInput("input_date_till"),t.input_date_till.setAttribute("readOnly","true"),t.input_date_till.onclick=function(){i(t.input_date_from,"min")},t.сalendar=new dhtmlXCalendarObject([t.input_date_from,t.input_date_till]),t.сalendar.attachEvent("onclick",s),e.date_from||(e.date_from=new Date((new Date).getFullYear().toFixed()+"-01-01")),e.date_till||(e.date_till=$p.date_add_day(new Date,1)),t.input_date_from.value=$p.dateFormat(e.date_from,$p.dateFormat.masks.short_ru),t.input_date_till.value=$p.dateFormat(e.date_till,$p.dateFormat.masks.short_ru)}e.hide_filter?e.toolbar.addSpacer("input_date_till"):(e.toolbar.addText("lbl_filter",e.pos,"Фильтр"),e.pos++,e.toolbar.addInput("input_filter",e.pos,"",n),t.input_filter=e.toolbar.getInput("input_filter"),t.input_filter.onchange=s,t.input_filter.onkeydown=o,t.input_filter.type="search",e.toolbar.addSpacer("input_filter")),t.get_filter=function(){return{date_from:t.input_date_from?dhx4.str2date(t.input_date_from.value):"",date_till:t.input_date_till?dhx4.str2date(t.input_date_till.value):"",filter:t.input_filter?t.input_filter.value:""}}},$p.iface.dat_gui=function(e,t){dat.GUI.DEFAULT_WIDTH="100%";var n=$p.iface.dat_blank(e,t),r=new dat.GUI({autoPlace:!1}),i=!1;return e=null,n.attachObject(r.domElement),n.setMinDimension(240,280),r.domElement.removeChild(r.__closeButton),delete r.__closeButton,t.parked&&n.park(),r.wnd=n,r.clear=function(){function e(t){for(var n in t.__folders)e(t.__folders[n]),delete t.__folders[n];while(t.__controllers.length)t.__controllers[0].remove();t.__ul.parentNode.removeChild(t.__ul)}for(var t in r.__folders)e(r.__folders[t]),delete r.__folders[t];while(r.__controllers.length)r.__controllers[0].remove()},r.update=function(){for(var e in r.__folders)r.__folders[e].__controllers.forEach(function(e){e.updateDisplay()});r.__controllers.forEach(function(e){e.updateDisplay()}),r.after_update&&r.after_update(),i=!1},r.lazy_update=function(){i||(i=!0,setTimeout(r.update,10))},r.first_obj=function(e){var t;for(var n in r.__folders)for(var i in r.__folders[n].__controllers){t=r.__folders[n].__controllers[i];if(t.object instanceof e)return t.object}for(var i in r.__controllers){t=r.__controllers[i];if(t.object instanceof e)return t.object}},r.close=function(){r.clear(),n.close(),n=null,r=null},r.wnd_options=n.wnd_options,r},$p.iface.dat_blank=function(e,t){t||(t={});var n=(e||$p.iface.w).createWindow({id:t.id||"wnd_dat_"+dhx4.newId(),left:t.left||900,top:t.top||20,width:t.width||220,height:t.height||300,move:!0,park:!t.allow_close,center:!!t.center,resize:!0,caption:t.caption||"Tools"});return e=null,t.allow_minmax||n.button("minmax").hide(),t.allow_close?n.button("park").hide():n.button("close").hide(),n.setIconCss("without_icon"),n.cell.parentNode.children[1].classList.add("dat_gui"),$p.bind_help(n,t.help_path),n.elmnts={},n.modified=!1,n.wnd_options=function(e){var t=n.getPosition(),r=n.getDimension(),i=n.isParked();e.left=t[0],e.top=t[1],e.width=r[0],e.parked=i,i||(e.height=r[1])},n.bottom_toolbar=function(e){var t={wrapper:n.cell,width:"100%",height:"28px",bottom:"0px",left:"0px",name:"tb_bottom",buttons:[{name:"btn_cancel",text:"Отмена",title:"Закрыть без сохранения",width:"60px","float":"right"},{name:"btn_ok",b:"Ок",title:"Применить изменения",width:"30px","float":"right"}],onclick:function(e){return!1}}._mixin(e),r=new OTooolBar(t),i=n.attachStatusBar({height:12});return i.style.zIndex=-1e3,i.firstChild.style.backgroundColor="transparent",i.firstChild.style.border="none",r},t.modal&&(t.pwnd&&t.pwnd.setModal&&t.pwnd.setModal(0),n.setModal(1)),n},$p.iface.dat_tree=function(e,t){var n=$p.iface.dat_blank(e,t),r=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=[{type:"combo",name:"cb_sys",label:"Система"},{type:"combo",name:"cb_clr",label:"Цвет"},{type:"settings",labelWidth:50,inputWidth:160,offsetLeft:0,offsetTop:0}];return e=null,n.setMinDimension(250,300),n.attachObject(r),r.appendChild(i),r.appendChild(s),n.cell_a=i,n.tree=new dhtmlXTreeObject(s,"100%","100%",0),n.tree.setImagePath(dhtmlx.image_path+"dhxtree_web/"),n.tree.setIconsPath(dhtmlx.image_path+"dhxtree_web/"),n.tree.enableCheckBoxes(!0,!0),n.tree.enableTreeImages(!1),n},$p.iface.dat_pgrid=function(e,t){var n=$p.iface.dat_blank(e,t);e=null,n.setMinDimension(320,300);var r=n.elmnts.pgrid=n.attachPropertyGrid();return r.setDateFormat("%d.%m.%Y %H:%i"),r.init(),t.grid_struct&&r.loadXMLString(t.o._manager.get_property_grid_xml(t.grid_struct,t.v),function(){r.enableAutoHeight(!1),r.setSizes(),r.setUserData("","source",{o:t.v,grid:r,on_select:$p.iface.pgrid_on_select,slist:t.grid_slist,grid_on_change:t.grid_on_change,wnd:n}),r.attachEvent("onPropertyChanged",$p.iface.pgrid_on_change),r.attachEvent("onCheckbox",$p.iface.pgrid_on_checkbox)}),n},$p.iface.pgrid_on_select=function(e){if(e===undefined)return;var t=this.grid instanceof dhtmlXGridObject?this.grid:this,n=t.getUserData("","source"),r=t.getSelectedRowId();if(n.o[r]!=undefined)typeof n.o[r]=="number"?n.o[r]=$p.fix_number(e,!0):n.o[r]=e;else if(r.indexOf("fprms")>-1){var i=$p._find(n.o.fprms,r.split("|")[1]);i.value=e}t.cells().setValue($p.is_data_obj(e)?e.presentation:e||""),n.wnd&&(n.wnd.modified=!0),n.grid_on_change&&n.grid_on_change.call(t,r,e)},$p.iface.pgrid_on_change=function(e,t,n){e&&$p.iface.pgrid_on_select.call(this,t)},$p.iface.pgrid_on_checkbox=function(e,t,n){var r=this.grid instanceof dhtmlXGridObject?this.grid:this,i=r.getUserData("","source");i.o[e]!=undefined&&(i.o[e]=n),i.wnd&&(i.wnd.modified=!0),i.grid_on_change&&i.grid_on_change(e,n)},$p.iface.layout_2u=function(e){var t=$p.iface;return t.main=new dhtmlXLayoutObject({parent:document.body,pattern:"2U"}),t.main.attachEvent("onCollapse",function(e){if(e=="b")return t.docs.expand(),!1}),t.docs=t.main.cells("b"),t.cell_tree=t.main.cells("a"),t.cell_tree.setText("Режим"),t.cell_tree.setWidth("190"),t.cell_tree.fixSize(!1,!1),t.cell_tree.collapse(),t.tree=t.cell_tree.attachTree(),t.tree.setImagePath(dhtmlx.image_path+"dhxtree_web/"),t.tree.setIconsPath(dhtmlx.image_path+"dhxtree_web/"),e?(t.tree.attachEvent("onSelect",e.onselect),new Promise(function(n,r){t.tree.loadXML(e.path+"?v="+$p.job_prm.files_date,function(){this.tree_filteres=e.path,n(this)})})):(t.tree.attachEvent("onSelect",function(e){var n=e.split(".");if(n.length>1&&t.swith_view(n[0])=="oper"){var r=$p.md.mgr_by_class_name(e.substr(5));typeof t.docs.close=="function"&&t.docs.close(),r&&r.form_list(t.docs,{})}}),Promise.resolve(t.tree))},$p.iface.frm_auth=function(e,t,n){function r(r,i,s){$p.ajax.username=r,$p.ajax.password=i,r?(s||$p.wsql.set_user_param("user_name",r),$p.is_guid($p.wsql.get_user_param("browser_uid"))||$p.wsql.set_user_param("browser_uid",$p.generate_guid()),$p.eve.log_in(e).then(t).catch(function(e){u=!0,n&&n(e)}).then(function(e){$p.iface.sync&&$p.iface.sync.close(),$p.iface.docs&&($p.iface.docs.progressOff(),u||$p.iface.docs.hideHeader()),$p.iface.cell_tree&&!u&&$p.iface.cell_tree.expand()})):this.validate()}function i(e){this.resetValidateCss(),this.getCheckedValue("type")=="guest"?(r.call(this,this.getItemValue("guest"),"",!0),$p.wsql.set_user_param("user_name","")):this.getCheckedValue("type")=="auth"&&r.call(this,this.getItemValue("login"),this.getItemValue("password"))}var s=$p.iface.auth=$p.iface.docs.attachForm(),o,u,a;e||(e=function(e){var t=$p.eve.stepper;switch(e){case $p.eve.steps.authorization:t.frm_sync.setItemValue("text_processed","Авторизация");break;case $p.eve.steps.load_meta:$p.iface.docs.progressOn(),$p.msg.show_msg($p.msg.init_catalogues+$p.msg.init_catalogues_meta,$p.iface.docs),$p.iface.sync||$p.iface.wnd_sync(),$p.iface.sync.create(t);break;case $p.eve.steps.create_managers:t.frm_sync.setItemValue("text_processed","Обработка метаданных"),t.frm_sync.setItemValue("text_bottom","Создаём объекты менеджеров данных...");break;case $p.eve.steps.process_access:break;case $p.eve.steps.load_data_files:t.frm_sync.setItemValue("text_processed","Загрузка начального образа"),t.frm_sync.setItemValue("text_bottom","Читаем файлы данных зоны...");break;case $p.eve.steps.load_data_db:t.frm_sync.setItemValue("text_processed","Загрузка изменений из 1С"),t.frm_sync.setItemValue("text_bottom","Читаем изменённые справочники");break;case $p.eve.steps.load_data_wsql:break;case $p.eve.steps.save_data_wsql:t.frm_sync.setItemValue("text_processed","Кеширование данных"),t.frm_sync.setItemValue("text_bottom","Сохраняем таблицы в локальном SQL...");break;default:}}),a=require("form_auth").replace(/\/imgs\//g,dhtmlx.image_path),s.loadStruct(a,function(){$p.wsql.get_user_param("user_name")&&(s.setItemValue("login",$p.wsql.get_user_param("user_name")),s.setItemValue("type","auth"),$p.wsql.get_user_param("enable_save_pwd")&&$p.wsql.get_user_param("user_pwd")&&(s.setItemValue("password",$p.wsql.get_user_param("user_pwd")),$p.wsql.get_user_param("autologin")&&i())),(o=($p.iface.docs.getWidth()-500)/2)>=10?s.cont.style.paddingLeft=o.toFixed()+"px":s.cont.style.paddingLeft="20px"}),s.attachEvent("onButtonClick",i),s.attachEvent("onKeyDown",function(e,t,n,r){t.keyCode==13&&(n=="password"||this.getCheckedValue("type")=="guest")&&i.call(this)}),$p.msg.show_msg($p.msg.init_login,$p.iface.docs),s.onerror=function(e){$p.ajax.authorized=!1;var t=e.message.toLowerCase();t.indexOf("auth")!=-1?($p.msg.show_msg({title:$p.msg.main_title+$p.version,type:"alert-error",text:$p.msg.error_auth}),s.setItemValue("password",""),s.validate()):(t.indexOf("gateway")!=-1||t.indexOf("net")!=-1)&&$p.msg.show_msg({title:$p.msg.main_title+$p.version,type:"alert-error",text:$p.msg.error_network})}},$p.iface.open_settings=function(e){return(e||event).preventDefault(),window.open(($p.job_prm.settings_url||"order_dealer/options.html")+"?v="+$p.job_prm.files_date),$p.cancel_bubble(e)},$p.iface.swith_view=function(e){var t,n=$p.iface,r=function(e){function t(e,t){if(e.text>t.text)return 1;if(e.text<t.text)return-1}if(n.tree._view==e||["rep","cal"].indexOf(e)!=-1)return;n.tree.deleteChildItems(0);if(e=="oper"){var r={id:0,item:[{id:"oper_cat",text:$p.msg.meta_cat,open:!0,item:[]},{id:"oper_doc",text:$p.msg.meta_doc,item:[]},{id:"oper_cch",text:$p.msg.meta_cch,item:[]},{id:"oper_cacc",text:$p.msg.meta_cacc,item:[]}]},i,s,o=r.item[0].item;for(i in _cat){if(typeof _cat[i]=="function")continue;s=_cat[i].metadata(),o.push({id:"oper.cat."+i,text:s.synonym||s.name,tooltip:s.illustration||s.list_presentation})}o.sort(t),o=r.item[1].item;for(i in _doc){if(typeof _doc[i]=="function")continue;s=_doc[i].metadata(),o.push({id:"oper.doc."+i,text:s.synonym||s.name,tooltip:s.illustration||s.list_presentation})}o.sort(t),o=r.item[2].item;for(i in _cch){if(typeof _cch[i]=="function")continue;s=_cch[i].metadata(),o.push({id:"oper.cch."+i,text:s.synonym||s.name,tooltip:s.illustration||s.list_presentation})}o.sort(t),o=r.item[3].item;for(i in _cacc){if(typeof _cacc[i]=="function")continue;s=_cacc[i].metadata(),o.push({id:"oper.cacc."+i,text:s.synonym||s.name,tooltip:s.illustration||s.list_presentation})}o.sort(t),n.tree.loadJSONObject(r,function(){var e=$p.job_prm.parse_url();e.obj&&n.tree.selectItem(e.view+"."+e.obj,!0)})}else n.tree.loadXML(n.tree.tree_filteres+"?v="+$p.job_prm.files_date,function(){});n.tree._view=e};if(e.indexOf(n.docs.getViewName())==0)return n.docs.getViewName();t=n.docs.showView(e),t==1&&e=="cal"&&!window.dhtmlXScheduler&&($p.load_script("lib/dhtmlxscheduler.js","script",function(){$p.load_script("lib/ext/dhtmlxscheduler_minical.js","script"),$p.load_script("lib/ext/dhtmlxscheduler_timeline.js","script"),$p.load_script("lib/ext/dhtmlxscheduler_locale_ru.js","script",function(){scheduler.config.first_hour=8,scheduler.config.last_hour=22,n.docs.scheduler=n.docs.attachScheduler(new Date("2015-03-20"),"week","scheduler_here"),n.docs.scheduler.attachEvent("onBeforeViewChange",function(e,t,n,r){return n=="timeline"?($p.msg.show_not_implemented(),!1):!0})})}),$p.load_script("lib/dhtmlxscheduler.css","link")),r(e),e=="def"?n.main.showStatusBar():n.main.hideStatusBar()},$p.iface.OTooolBar=OTooolBar,$p.iface.add_button=function(e,t,n){var r=document.createElement("div"),i="";return r.name=(t?t.name+"_":"")+n.name,e.appendChild(r),r.className="wb-button",n.img&&(i='<img src="'+(t?t.image_path:"")+n.img+'">'),n.b?i+='<b style="vertical-align: super;"> '+n.b+"</b>":n.text&&(i+='<span style="vertical-align: super;"> '+n.text+"</span>"),r.innerHTML=i,n.float&&(r.style.float=n.float),n.clear&&(r.style.clear=n.clear),n.width&&(r.style.width=n.width),r},eXcell_addr.prototype=eXcell_proto,window.eXcell_addr=eXcell_addr,$p.is_data_obj=function(e){return e&&e instanceof DataObj},$p.fetch_type=function(e,t){var n=e;return t.is_ref?n=$p.fix_guid(e):t.date_part?n=$p.fix_date(e,!0):t.digits?n=$p.fix_number(e,!0):t.types[0]=="boolean"&&(n=$p.fix_boolean(e)),n},$p.is_equal=function(e,t){return e==t?!0:typeof e==typeof t?!1:$p.fix_guid(e,false)==$p.fix_guid(t,false)},$p._find=function(e,t){var n,r,i;if(typeof t!="object")for(r in e){n=e[r];for(var s in n)if(typeof n[s]!="function"&&$p.is_equal(n[s],t))return n}else for(r in e){n=e[r],i=!0;for(var s in t)if(typeof n[s]!="function"&&!$p.is_equal(n[s],t[s])){i=!1;break}if(i)return n}},$p._find_rows=function(e,t,n){var r,i,s,o,u=[];for(s in e){i=e[s],r=!0;if(t)for(o in t)if(!$p.is_equal(i[o],t[o])){r=!1;break}if(r)if(n){if(n.call(this,i)===!1)break}else u.push(i)}return u};var _cat=$p.cat=new function(){this.toString=function(){return $p.msg.meta_cat_mgr}},_enm=$p.enm=new function(){this.toString=function(){return $p.msg.meta_enn_mgr}},_doc=$p.doc=new function(){this.toString=function(){return $p.msg.meta_doc_mgr}},_ireg=$p.ireg=new function(){this.toString=function(){return $p.msg.meta_ireg_mgr}},_areg=$p.areg=new function(){this.toString=function(){return $p.msg.meta_areg_mgr}},_aссreg=$p.aссreg=new function(){this.toString=function(){return $p.msg.meta_accreg_mgr}},_dp=$p.dp=new function(){this.toString=function(){return $p.msg.meta_dp_mgr}},_rep=$p.rep=new function(){this.toString=function(){return $p.msg.meta_reports_mgr}},_cacc=$p.cacc=new function(){this.toString=function(){return $p.msg.meta_charts_of_accounts_mgr}},_cch=$p.cch=new function(){this.toString=function(){return $p.msg.meta_charts_of_characteristic_mgr}},_md;_cat.load_soap_to_grid=function(e,t,n){function r(e){e.substr(0,1)=="{"&&(e=JSON.parse(e)),typeof e=="string"?t.loadXMLString(e,function(){n&&n(e)}):n&&n(e)}t.xmlFileUrl="exec";var i=_md.mgr_by_class_name(e.class_name);!i._cachable&&($p.job_prm.rest||e.rest)?i.rest_selection(e).then(r).catch(function(e){console.log(e)}):_load(e).then(r).catch(function(e){console.log(e)})},DataManager.prototype._define("family_name",{get:function(){return $p.msg["meta_"+this.class_name.split(".")[0]+"_mgr"].replace($p.msg.meta_mgr+" ","")},enumerable:!1}),DataManager.prototype.register_ex=function(){},DataManager.prototype.sync_grid=function(e,t){var n;!this._cachable&&($p.job_prm.rest||t.rest)&&(t.action=="get_tree"?n=this.rest_tree():t.action=="get_selection"&&(n=this.rest_selection()))},DataManager.prototype.get_option_list=function(e,t){function n(t){return $p.is_equal(t.value,e)&&(t.selected=!0),t}var r=[];return this.find_rows(t,function(e){r.push(n({text:e.presentation,value:e.ref}))}),r},DataManager.prototype.tabular_captions=function(e,t){},DataManager.prototype.get_property_grid_xml=function(e,t){var n,r,i,s,o,u,a=this,f,l="<rows>",c=function(){if(e)return;e={" ":[]},i=_md.get(a.class_name),t instanceof CatObj?(i.code_length&&e[" "].push("id"),i.main_presentation_name&&e[" "].push("name")):t instanceof DocObj&&(e[" "].push("number"),e[" "].push("date"));if(!t.is_folder)for(n in i.fields)i.fields[n].hide||e[" "].push(n);_md.get(a.class_name).tabular_sections.extra_fields&&(e["Дополнительные реквизиты"]=[])},h=function(e){o=_md.control_by_type(i.type),$p.is_data_obj(e)?u=e.presentation:u=e,i.type.is_ref||(i.type.date_part?u=$p.dateFormat(u,""):i.type.types[0]=="boolean"&&(u=u?"1":"0"))},p=function(e,n){if(n){var r=e.property||e.param||e["Параметр"],c=e.value||e["Значение"];r.empty()?(f=n+"|"+"empty",o="ro",u="",i={synonym:"?"}):(i={synonym:r.presentation,type:r.type},f=n+"|"+r.ref,h(c),o=="ref"?o="refc":o=="edn"&&(o="calck"),r.mandatory&&(o+='" class="cell_mandatory'))}else if(typeof e=="object")i={synonym:e.synonym},f=e.id,o=e.type,u=e.txt;else{if((s=t[e])===undefined)return;i=_md.get(a.class_name,e),f=e,h(s)}l+='<row id="'+f+'"><cell>'+(i.synonym||i.name)+'</cell><cell type="'+o+'">'+u+"</cell></row>"};c();for(n in e){n!=" "&&(l+='<row open="1"><cell>'+n+"</cell>");for(r in e[n])p(e[n][r]);if(n=="Дополнительные реквизиты"&&t.extra_fields)t.extra_fields.each(function(e){p(e,"extra_fields")});else if(n=="Свойства изделия"){var d=!1;t.params.each(function(e){e.cns_no==0&&!e.hide&&(p(e,"params"),d=!0)}),d||p({param:_cch.properties.get("",!1)},"params")}else if(n=="Параметры")for(var v in t.fprms){if(t.fprms[v].hide||t.fprms[v].param.empty())continue;p(t.fprms[v],"fprms")}n!=" "&&(l+="</row>")}return l+="</rows>",l},DataManager.prototype._define("table_name",{get:function(){return this.class_name.replace(".","_")},enumerable:!1}),DataManager.prototype.print=function(e,t,n){function r(e){n&&n.progressOff&&n.progressOff(),e&&e.focus()}n&&n.progressOn&&n.progressOn(),$p.ajax.get_and_show_blob($p.job_prm.hs_url(),{action:"print",class_name:this.class_name,ref:$p.fix_guid(e),model:t,browser_uid:$p.wsql.get_user_param("browser_uid")}).then(r).catch(function(e){console.log(e)}),setTimeout(r,3e3)},RefDataManager._extend(DataManager),RefDataManager.prototype.get_sql_struct=function(e){function t(){function t(){var e=[],t="_t_.ref, _t_.`deleted`";return s.form&&s.form.selection?s.form.selection.fields.forEach(function(t){e.push(t)}):i instanceof DocManager?(e.push("posted"),e.push("date"),e.push("number_doc")):(s.hierarchical&&s.group_hierarchy?e.push("is_folder"):e.push("0 as is_folder"),i instanceof ChartOfAccountManager?(e.push("id"),e.push("name as presentation")):s.main_presentation_name?e.push("name as presentation"):s.code_length?e.push("id as presentation"):e.push("'...' as presentation"),s.has_owners&&e.push("owner"),s.code_length&&e.push("id")),e.forEach(function(e){e.indexOf(" as ")!=-1?t+=", "+e:t+=_md.sql_mask(e,!0)}),t}function n(){var e="",t;if(s.form&&s.form.selection)for(var n in s.form.selection.fields){if(s.form.selection.fields[n].indexOf(" as ")==-1||s.form.selection.fields[n].indexOf("_t_.")!=-1)continue;t=s.form.selection.fields[n].split(" as "),t[0]=t[0].split("."),t[0].length>1&&(e&&(e+="\n"),e+="left outer join "+t[0][0]+" on "+t[0][0]+".ref = _t_."+t[1])}return e}function r(){var t;i instanceof ChartOfAccountManager?t=" WHERE ("+(h?0:1):s.hierarchical?s.has_owners?t=" WHERE ("+(a||h?1:0)+" OR _t_.parent = '"+f+"') AND ("+(l==$p.blank.guid?1:0)+" OR _t_.owner = '"+l+"') AND ("+(h?0:1):t=" WHERE ("+(a||h?1:0)+" OR _t_.parent = '"+f+"') AND ("+(h?0:1):s.has_owners?t=" WHERE ("+(l==$p.blank.guid?1:0)+" OR _t_.owner = '"+l+"') AND ("+(h?0:1):t=" WHERE ("+(h?0:1);if(i.sql_selection_where_flds)t+=i.sql_selection_where_flds(h);else if(i instanceof DocManager)t+=" OR _t_.number_doc LIKE '"+h+"'";else{if(s.main_presentation_name||i instanceof ChartOfAccountManager)t+=" OR _t_.name LIKE '"+h+"'";s.code_length&&(t+=" OR _t_.id LIKE '"+h+"'")}return t+=") AND (_t_.ref != '"+$p.blank.guid+"')",e.selection&&e.selection.forEach(function(e){for(var n in e)s.fields.hasOwnProperty(n)&&(e[n]===!0?t+="\n AND _t_."+n+" ":e[n]===!1?t+="\n AND (not _t_."+n+") ":typeof e[n]=="string"?t+="\n AND (_t_."+n+" = '"+e[n]+"') ":t+="\n AND (_t_."+n+" = "+e[n]+") ")}),t}function o(){return i instanceof ChartOfAccountManager?"ORDER BY id":s.hierarchical?s.group_hierarchy?"ORDER BY _t_.is_folder desc, is_initial_value, presentation":"ORDER BY _t_.parent desc, is_initial_value, presentation":"ORDER BY is_initial_value, presentation"}function u(){function t(t){t?(p=e.set_parent=t.parent.ref,f=p,a=!1):(!!h||!!a)&&i.class_name=="cat.base_blocks"&&(l==$p.blank.guid&&(l=_cat.bases.predefined("main")),f=i.first_folder(l).ref),h&&h.indexOf("%")==-1&&(h="%"+h+"%")}c!=$p.blank.guid&&a?s.hierarchical?t(i.get(c,!1)):t():t()}var a=!e.parent,f=e.parent||$p.blank.guid,l=e.owner||$p.blank.guid,c=e.initial_value||$p.blank.guid,h=e.filter||"",p=$p.blank.guid;u();var d;return i.sql_selection_list_flds?d=i.sql_selection_list_flds(c):d=("SELECT %2, case when _t_.ref = '"+c+"' then 0 else 1 end as is_initial_value FROM "+i.table_name+" AS _t_ %j %3 %4 LIMIT 300").replace("%2",t()).replace("%j",n()),d.replace("%3",r()).replace("%4",o())}function n(){var e="CREATE TABLE IF NOT EXISTS "+i.table_name+" (ref CHAR PRIMARY KEY NOT NULL, `deleted` BOOLEAN, lc_changed INT";i instanceof DocManager?e+=", posted BOOLEAN, date Date, number_doc CHAR":e+=", id CHAR, name CHAR, is_folder BOOLEAN";for(u in s.fields)e+=_md.sql_mask(u)+_md.sql_type(i,u,s.fields[u].type);for(u in s.tabular_sections)e+=", ts_"+u+" JSON";return e+=")",e}function r(){var e=["ref","deleted","lc_changed"],t="INSERT INTO "+i.table_name+" (ref, `deleted`, lc_changed",n="(?";i.class_name.substr(0,3)=="cat"?(t+=", id, name, is_folder",e.push("id"),e.push("name"),e.push("is_folder")):i.class_name.substr(0,3)=="doc"&&(t+=", posted, date, number_doc",e.push("posted"),e.push("date"),e.push("number_doc"));for(u in s.fields)t+=_md.sql_mask(u),e.push(u);for(u in s.tabular_sections)t+=", ts_"+u,e.push("ts_"+u);t+=") VALUES ";for(u=1;u<e.length;u++)n+=", ?";return n+=")",t+=n,{sql:t,fields:e,values:n}}var i=this,s=i.metadata(),o={},u,a=e&&e.action?e.action:"create_table";return a=="create_table"?o=n():["insert","update","replace"].indexOf(a)!=-1?o[i.table_name]=r():a=="select"?o="SELECT * FROM "+i.table_name+" WHERE ref = ?":a=="select_all"?o="SELECT * FROM "+i.table_name:a=="delete"?o="DELETE FROM "+i.table_name+" WHERE ref = ?":a=="drop"?o="DROP TABLE IF EXISTS "+i.table_name:a=="get_tree"?o="SELECT ref, parent, name as presentation FROM "+i.table_name+" WHERE is_folder order by parent, name":a=="get_selection"&&(o=t()),o},RefDataManager.prototype.caption_flds=function(e){function t(e,t,n,r,i,s){this.id=e,this.width=t,this.type=n,this.align=r,this.sort=i,this.caption=s}var n='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>',r=[],i=this.metadata(),s="";i.form&&i.form.selection?r=i.form.selection.cols:this instanceof DocManager?(r.push(new t("date","120","ro","left","server","Дата")),r.push(new t("number_doc","120","ro","left","server","Номер"))):this instanceof ChartOfAccountManager?(r.push(new t("id","120","ro","left","server","Код")),r.push(new t("presentation","*","ro","left","server","Наименование"))):r.push(new t("presentation","*","ro","left","server","Наименование"));if(e.get_header&&r.length){s="<head>";for(var o in r)s+=n.replace("%1",r[o].id).replace("%2",r[o].width).replace("%3",r[o].type).replace("%4",r[o].align).replace("%5",r[o].sort).replace("%6",r[o].caption);s+="</head>"}return{head:s,acols:r}},DataProcessorsManager._extend(DataManager),EnumManager._extend(RefDataManager),EnumManager.prototype.get_sql_struct=function(e){var t,n=e&&e.action?e.action:"create_table";return n=="create_table"?t="CREATE TABLE IF NOT EXISTS "+this.table_name+" (ref CHAR PRIMARY KEY NOT NULL, sequence INT, synonym CHAR)":["insert","update","replace"].indexOf(n)!=-1?(t={},t[this.table_name]={sql:"INSERT INTO "+this.table_name+" (ref, sequence, synonym) VALUES (?, ?, ?)",fields:["ref","sequence","synonym"],values:"(?, ?, ?)"}):n=="delete"&&(t="DELETE FROM "+this.table_name+" WHERE ref = ?"),t},EnumManager.prototype.get_option_list=function(e){function t(t){return $p.is_equal(t.value,e)&&(t.selected=!0),t}var n=[];return this.alatable.forEach(function(e){n.push(t({text:e.synonym,value:e.ref}))}),n},RegisterManager._extend(DataManager),RegisterManager.prototype.get_sql_struct=function(e){function t(){var e="CREATE TABLE IF NOT EXISTS "+i.table_name+" (",t=!0;for(u in s.dimensions)t?(e+=u,t=!1):e+=_md.sql_mask(u),e+=_md.sql_type(i,u,s.dimensions[u].type);for(u in s.resources)e+=_md.sql_mask(u)+_md.sql_type(i,u,s.resources[u].type);e+=", PRIMARY KEY (",t=!0;for(u in s.dimensions)t?(e+=u,t=!1):e+=_md.sql_mask(u);return e+="))",e}function n(){var e="INSERT OR REPLACE INTO "+i.table_name+" (",t=[],n=!0;for(u in s.dimensions)n?(e+=u,n=!1):e+=", "+u,t.push(u);for(u in s.resources)e+=", "+u,t.push(u);e+=") VALUES (?";for(u=1;u<t.length;u++)e+=", ?";return e+=")",{sql:e,fields:t}}function r(){var t="SELECT * FROM "+i.table_name+" WHERE ",n=!0;e._values=[];for(var r in e){if(r=="action"||r=="_values")continue;n?n=!1:t+=" and ",t+=r+"=?",e._values.push(e[r])}return n&&(t+="1"),t}var i=this,s=i.metadata(),o={},u,a=e&&e.action?e.action:"create_table";return a=="create_table"?o=t():a in{insert:"",update:"",replace:""}?o[i.table_name]=n():a=="select"?o=r():a=="select_all"?o=r():a=="delete"?o="DELETE FROM "+i.table_name+" WHERE ref = ?":a=="drop"&&(o="DROP TABLE IF EXISTS "+i.table_name),o},RegisterManager.prototype.get_ref=function(e){var t="",n,r=this.metadata().dimensions;e instanceof RegisterRow&&(e=e._obj);for(var i in r)t+=t?"_":"",r[i].type.is_ref?t+=$p.fix_guid(e[i]):!e[i]&&r[i].type.digits?t+="0":r[i].date_part?t+=$p.dateFormat(e[i]||$p.blank.date,$p.dateFormat.masks.atom):e[i]!=undefined?t+=String(e[i]):t+="$";return t},InfoRegManager._extend(RegisterManager),InfoRegManager.prototype.slice_first=function(e){},InfoRegManager.prototype.slice_last=function(e){},AccumRegManager._extend(RegisterManager),CatManager._extend(RefDataManager),CatManager.prototype.by_name=function(e){var t;return this.find_rows({name:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.by_id=function(e){var t;return this.find_rows({id:e},function(e){return t=e,!1}),t||(t=this.get()),t},ChartOfCharacteristicManager._extend(CatManager),ChartOfAccountManager._extend(CatManager),DocManager._extend(RefDataManager),TabularSection.prototype.toString=function(){return"Табличная часть "+this._owner._manager.class_name+"."+this._name},TabularSection.prototype.get=function(e){return this._obj[e]._row},TabularSection.prototype.count=function(){return this._obj.length},TabularSection.prototype.clear=function(){for(var e in this._obj)delete this._obj[e];this._obj.length=0},TabularSection.prototype.del=function(e){var t,n=this._obj,r=0;if(typeof e=="undefined")return;if(typeof e=="number")t=e;else for(var i in n)if(n[i]._row===e){t=Number(i),delete n[i]._row;break}if(t==undefined)return;n.splice(t,1);for(var i in n)r++,n[i].row=r},TabularSection.prototype.find=function(e){var t=$p._find(this._obj,e);if(t)return t._row},TabularSection.prototype.find_rows=function(e,t){var n,r,i,s,o=[],u=this._obj;for(i in u){r=u[i],n=!0;if(e)for(s in e)if(!$p.is_equal(r[s],e[s])){n=!1;break}if(n)if(t){if(t.call(this,r._row)===!1)break}else o.push(r._row)}return o},TabularSection.prototype.swap=function(e,t){var n=this._obj[e];this._obj[e]=this._obj[t],this._obj[t]=n},TabularSection.prototype.add=function(e){var t=new this._owner._manager._ts_сonstructors[this._name](this);e&&t._mixin(e||{});for(var n in t._metadata.fields)t._obj[n]==undefined&&(t[n]="");return t._obj.row=this._obj.push(t._obj),t._obj._define("_row",{value:t,enumerable:!1}),e=null,t},TabularSection.prototype.each=function(e){var t=this;t._obj.forEach(function(n){return e.call(t,n._row)})},TabularSection.prototype.load=function(e){this.clear();for(var t in e)this.add(e[t])},TabularSection.prototype.sync_grid=function(e){var t={rows:[]},n=e.getUserData("","source");e.clearAll(),e.setUserData("","source",n),this.each(function(e){var r=[];for(var i in n.fields)$p.is_data_obj(e[n.fields[i]])?r.push(e[n.fields[i]].presentation):r.push(e[n.fields[i]]);t.rows.push({id:e.row,data:r})});try{e.parse(t,"json")}catch(r){}e.callEvent("onGridReconstructed",[])},TabularSection.prototype.toJSON=function(){return this._obj},TabularSectionRow.prototype._define("_metadata",{get:function(){return this._owner._owner._metadata.tabular_sections[this._owner._name]},enumerable:!1}),TabularSectionRow.prototype._define("row",{get:function(){return this._obj.row||0},enumerable:!0}),TabularSectionRow.prototype._define("_clone",{value:function(){var e=(new this._owner._owner._manager._ts_сonstructors[this._owner._name](this._owner))._mixin(this._obj);return e},enumerable:!1}),DataObj.prototype.valueOf=function(){return this.ref},DataObj.prototype.toJSON=function(){return this._obj},DataObj.prototype._getter=function(e){var t=this._metadata.fields[e].type,n,r;return e=="type"&&typeof this._obj[e]=="object"?this._obj[e]:e=="ref"?this._obj[e]:t.is_ref?(n=_md.value_mgr(this._obj,e,t))?n.get(this._obj[e],!1):(console.log([e,t,this._obj]),null):t.date_part?$p.fix_date(this._obj[e],!0):t.digits?$p.fix_number(this._obj[e],!0):t.types[0]=="boolean"?$p.fix_boolean(this._obj[e]):this._obj[e]||""},DataObj.prototype._setter=function(e,t){var n=this._metadata.fields[e].type,r;e=="type"&&t.types?this._obj[e]=t:e=="ref"?this._obj[e]=$p.fix_guid(t):n.is_ref?(this._obj[e]=$p.fix_guid(t),r=_md.value_mgr(this._obj,e,n,!1,t),r?r instanceof EnumManager?typeof t=="string"?this._obj[e]=t:t?typeof t=="object"&&(this._obj[e]=t.ref||t.name||""):this._obj[e]="":t&&t.presentation&&(t.type&&!(t instanceof DataObj)&&delete t.type,r.create(t)):typeof t!="object"&&(this._obj[e]=t)):n.date_part?this._obj[e]=$p.fix_date(t,!0):n.digits?this._obj[e]=$p.fix_number(t,!0):n.types[0]=="boolean"?this._obj[e]=$p.fix_boolean(t):this._obj[e]=t},DataObj.prototype._getter_ts=function(e){return this._ts_(e)},DataObj.prototype._setter_ts=function(e,t){var n=this._ts_(e);n instanceof TabularSection&&Array.isArray(t)&&n.load(t)},DataObj.prototype.load=function(){function e(e){typeof e=="string"&&(e=JSON.parse(e));if($p.msg.check_soap_result(e))return;var n=$p.fix_guid(e);return t.is_new()&&!$p.is_empty_guid(n)&&t._set_loaded(n),t._mixin(e)}var t=this;return t._manager._cachable&&!t.is_new()?Promise.resolve(t):t.ref==$p.blank.guid?(t instanceof CatObj?t.id="000000000":t.number_doc="000000000",Promise.resolve(t)):!t._manager._cachable&&$p.job_prm.rest?t.load_rest():_load({class_name:t._manager.class_name,action:"load",ref:t.ref}).then(e)},DataObj.prototype.save=function(e,t){if(_manager.handle_event(this,"before_save")===!1)return Promise.resolve(this);this.save_rest({url:$p.job_prm.rest_url(),username:$p.ajax.username,password:$p.ajax.password,post:e,operational:t}).then(function(e){return _manager.handle_event(e,"after_save")})},DataObj.prototype.empty=function(){return $p.is_empty_guid(this._obj.ref)},DataObj.prototype._define("_metadata",{get:function(){return this._manager.metadata()},enumerable:!1}),DataObj.prototype._define("ref",{get:function(){return this._obj.ref},set:function(e){this._obj.ref=$p.fix_guid(e)},enumerable:!0,configurable:!0}),DataObj.prototype._define("deleted",{get:function(){return this._obj.deleted},set:function(e){this._obj.deleted=!!e},enumerable:!0,configurable:!0}),DataObj.prototype._define("data_version",{get:function(){return this._obj.data_version||""},set:function(e){this._obj.data_version=String(e)},enumerable:!0}),DataObj.prototype._define("lc_changed",{get:function(){return this._obj.lc_changed||0},set:function(e){this._obj.lc_changed=$p.fix_number(e,!0)},enumerable:!0,configurable:!0}),TabularSectionRow.prototype._getter=DataObj.prototype._getter,TabularSectionRow.prototype._setter=DataObj.prototype._setter,CatObj._extend(DataObj),CatObj.prototype._define("id",{get:function(){return this._obj.id||""},set:function(e){this._obj.id=e},enumerable:!0}),CatObj.prototype._define("name",{get:function(){return this._obj.name||""},set:function(e){this._obj.name=String(e)},enumerable:!0}),DocObj._extend(DataObj),DocObj.prototype._define("number_doc",{get:function(){return this._obj.number_doc||""},set:function(e){this._obj.number_doc=e},enumerable:!0}),DocObj.prototype._define("date",{get:function(){return this._obj.date||$p.blank.date},set:function(e){this._obj.date=$p.fix_date(e,!0)},enumerable:!0}),DocObj.prototype._define("posted",{get:function(){return this._obj.posted||!1},set:function(e){this._obj.posted=$p.fix_boolean(e)},enumerable:!0}),DataProcessorObj._extend(DataObj),EnumObj._extend(DataObj),EnumObj.prototype._define("order",{get:function(){return this._obj.sequence},set:function(e){this._obj.sequence=parseInt(e)},enumerable:!0}),EnumObj.prototype._define("name",{get:function(){return this._obj.ref},set:function(e){this._obj.ref=String(e)},enumerable:!0}),EnumObj.prototype._define("synonym",{get:function(){return this._obj.synonym||""},set:function(e){this._obj.synonym=String(e)},enumerable:!0}),EnumObj.prototype._define("presentation",{get:function(){return this.synonym||this.name},enumerable:!1}),EnumObj.prototype.empty=function(){return this.ref=="_"},RegisterRow._extend(DataObj),RegisterRow.prototype._define("_metadata",{get:function(){var e=this._manager.metadata();return e.fields||(e.fields={}._mixin(e.dimensions)._mixin(e.resources)),e},enumerable:!1}),RegisterRow.prototype._define("ref",{get:function(){return this._manager.get_ref(this)},enumerable:!0});var _rest=$p.rest=new Rest;DataManager.prototype._define("rest_name",{get:function(e){var t=this.class_name.split("."),n={cat:"Catalog",doc:"Document",ireg:"InformationRegister",areg:"AccumulationRegister"};return n[t[0]]+"_"+_md.syns_1с(t[1])+(e||"")},enumerable:!1}),DataManager.prototype.load_rest=function(e){return $p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=this.rest_name+"?allowedOnly=true&$format=json&$top=1000",_rest.ajax_to_data(e,this)},DataManager.prototype.rest_tree=function(e){},DataManager.prototype.rest_selection=function(e){function t(){var e="$select=Ref_Key,DeletionMark";return r.form&&r.form.selection?r.form.selection.fields.forEach(function(e){i.push(e)}):n instanceof DocManager?(i.push("posted"),i.push("date"),i.push("number_doc")):(r.hierarchical&&r.group_hierarchy?i.push("is_folder"):i.push("0 as is_folder"),r.main_presentation_name?i.push("name as presentation"):r.code_length?i.push("id as presentation"):i.push("'...' as presentation"),r.has_owners&&i.push("owner"),r.code_length&&i.push("id")),i.forEach(function(t){var r;if(t.indexOf(" as ")!=-1){r=t.split(" as ")[0].split(".");if(r.length==1)t=r[0];else{if(r[0]!="_t_")return;t=r[1]}}a=_md.syns_1с(t),_md.get(n.class_name,t).type.is_ref&&(a+="_Key"),e+=","+a}),i.push("ref"),i.push("deleted"),e}var n=this,r=n.metadata(),i=[],s=[],o,u,a,f,l=t();return $p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=this.rest_name+"?allowedOnly=true&$format=json&$top=1000&"+l,e.url+="&$filter="+_rest.filter_date("Date",e.date_from,e.date_till),$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(t){for(var r=0;r<t.value.length;r++)u=t.value[r],o={},i.forEach(function(e){if(e=="ref")o[e]=u.Ref_Key;else{a=_md.syns_1с(e),f=_md.get(n.class_name,e),f.type.is_ref&&(a+="_Key");if(f.type.date_part)o[e]=$p.dateFormat(u[a],$p.dateFormat.masks[f.type.date_part]);else if(f.type.is_ref)if(!u[a]||u[a]==$p.blank.guid)o[e]="";else{var t=_md.value_mgr(o,e,f.type,!1,u[a]);t?o[e]=t.get(u[a]).presentation:o[e]=""}else o[e]=u[a]}}),s.push(o);return data_to_grid.call(n,s,e)})},InfoRegManager.prototype.rest_slice_last=function(e){e.period||(e.period=$p.date_add_day(new Date,1));var t=this,n=t.metadata(),r="Period=datetime'"+$p.dateFormat(e.period,$p.dateFormat.masks.isoDateTime)+"'",i="";for(var s in n.dimensions){if(e[s]===undefined)continue;var o=_md.syns_1с(s);n.dimensions[s].type.is_ref?(o+="_Key",i&&(i+=" and "),i+=o+" eq guid'"+e[s].ref+"'"):(i&&(i+=" and "),n.dimensions[s].type.digits?i+=o+" eq "+$p.fix_number(e[s]):n.dimensions[s].type.date_part?i+=o+" eq datetime'"+$p.dateFormat(e[s],$p.dateFormat.masks.isoDateTime)+"'":i+=o+" eq '"+e[s]+"'")}return i&&(r+=",Condition='"+i+"'"),$p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=this.rest_name+"/SliceLast(%sl)?allowedOnly=true&$format=json&$top=1000".replace("%sl",r),_rest.ajax_to_data(e,t).then(function(e){return t.load_array(e)})},DataObj.prototype.to_atom=function(e){function t(e){var t=e._metadata.fields,n=e instanceof TabularSectionRow?"\n	<d:":"\n<d:";for(i in t)s=t[i],f=_md.syns_1с(i),l=e[i],l instanceof EnumObj?l=l.name:l instanceof DataObj?(f+="_Key",l=l.ref):s.type.date_part&&(l=$p.dateFormat(l,$p.dateFormat.masks.atom)),r+=n+f+">"+l+"</d:"+f+">"}var n='<entry><category term="StandardODATA.%n" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"/>				\n<title type="text"/><updated>%d</updated><author/><summary/><content type="application/xml">				\n<m:properties xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">			%p			\n</m:properties></content></entry>'.replace("%n",this._manager.rest_name).replace("%d",$p.dateFormat(new Date,$p.dateFormat.masks.atom)),r="\n<d:Ref_Key>"+this.ref+"</d:Ref_Key>"+"\n<d:DeletionMark>"+this.deleted+"</d:DeletionMark>"+"\n<d:DataVersion>"+this.data_version+"</d:DataVersion>",i,s,o,u,a,f,l;this instanceof DocObj?(r+="\n<d:Date>"+$p.dateFormat(this.date,$p.dateFormat.masks.atom)+"</d:Date>",r+="\n<d:Number>"+this.number_doc+"</d:Number>"):(this._metadata.main_presentation_name&&(r+="\n<d:Description>"+this.name+"</d:Description>"),this._metadata.code_length&&(r+="\n<d:Code>"+this.id+"</d:Code>"),this._metadata.hierarchical&&this._metadata.group_hierarchy&&(r+="\n<d:IsFolder>"+this.is_folder+"</d:IsFolder>")),t(this);for(o in this._metadata.tabular_sections)a=this._metadata.tabular_sections[o],f="StandardODATA."+this._manager.rest_name+"_"+_md.syns_1с(o)+"_RowType",u=this[o],u.count()?(r+="\n<d:"+_md.syns_1с(o)+' m:type="Collection('+f+')">',u.each(function(e){r+='\n	<d:element m:type="'+f+'">',r+="\n	<d:LineNumber>"+e.row+"</d:LineNumber>",t(e),r+="\n	</d:element>"}),r+="\n</d:"+_md.syns_1с(o)+">"):r+="\n<d:"+_md.syns_1с(o)+' m:type="Collection('+f+')" />';return n.replace("%p",r)},DataObj.prototype.save_rest=function(e){return e.url+=this._manager.rest_name,Promise.resolve(this)},DataObj.prototype.load_rest=function(){var e={},t=this;return $p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=t._manager.rest_name+"(guid'"+t.ref+"')?$format=json",$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){return t._mixin(_rest.to_data(e,t._manager))})},DataManager.prototype.export=function(e){function t(){$p.wsql.restore_options("data_manager",f),f.wnd.caption="Экспорт "+o.family_name+" '"+(o.metadata().synonym||o.metadata().name)+"'",a=$p.iface.dat_blank(null,f.wnd),a.bottom_toolbar({buttons:[{name:"btn_cancel",img:"tb_delete.png",text:"Отмена",title:"Отмена",width:"80px","float":"right"},{name:"btn_ok",img:"save.png",b:"Ок",title:"Выполнить экспорт",width:"50px","float":"right"}],onclick:function(e){return e=="btn_ok"?i():a.close(),!1}}),a.button("close").show(),a.button("park").hide(),a.attachEvent("onClose",s);var t=[{type:"fieldset",name:"form_range",label:"Выгрузить",offsetLeft:"20",list:[{type:"settings",labelWidth:300,labelAlign:"left",position:"label-right"},{type:"radio",name:"range",label:"Выделенные строки",value:"selected"},{type:"radio",name:"range",label:"Весь справочник",value:"all"}]},{type:"block",name:"form_block_1",list:[{type:"fieldset",name:"fieldset_format",label:"Формат файла",list:[{type:"settings",labelWidth:60,labelAlign:"left",position:"label-right"},{type:"radio",name:"format",label:"json",value:"json",tooltip:"Выгрузить в формате JSON"},{type:"radio",name:"format",label:"xlsx",value:"xlsx",tooltip:"Выгрузить в офисном формате XLSX"}]},{type:"newcolumn"},{type:"fieldset",name:"form_fieldset_2",label:"Дополнительно выгрузить",offsetLeft:"10",list:[{type:"settings",position:"label-right"},{type:"checkbox",name:"meta",label:"Описание метаданных",labelAlign:"left",position:"label-right",checked:f.meta},{type:"checkbox",name:"relation",label:"Связанные объекты по ссылкам",position:"label-right",checked:f.relation,tooltip:"Пока не реализовано"}]}]}];a.elmnts.frm=a.attachForm(t),a.elmnts.frm.setItemValue("range",f.range||"all"),e.items&&e.items.length==1?(e.obj?a.elmnts.frm.setItemLabel("range","selected","Тек. объект: "+e.items[0].presentation):o.get(e.items[0],!0).then(function(e){a.elmnts.frm.setItemLabel("range","selected","Тек. объект: "+e.presentation)}),a.elmnts.frm.setItemValue("range","selected")):e.items&&e.items.length&&a.elmnts.frm.setItemLabel("range","selected","Выделенные строки ("+e.items.length+" элем.)"),o instanceof DocManager&&a.elmnts.frm.setItemLabel("range","all","Все документы из кеша (0 элем.)"),a.elmnts.frm.setItemValue("format",f.format||"json"),a.elmnts.frm.attachEvent("onChange",n),n()}function n(){a.elmnts.frm.setItemValue("relation",!1),a.elmnts.frm.disableItem("relation"),a.elmnts.frm.getItemValue("format")=="json"?a.elmnts.frm.enableItem("meta"):a.elmnts.frm.getItemValue("format")=="sql"?(a.elmnts.frm.setItemValue("meta",!1),a.elmnts.frm.disableItem("meta")):(a.elmnts.frm.setItemValue("meta",!1),a.elmnts.frm.disableItem("meta"))}function r(){return f.format=a.elmnts.frm.getItemValue("format"),f.range=a.elmnts.frm.getItemValue("range"),f.meta=a.elmnts.frm.getItemValue("meta"),f.relation=a.elmnts.frm.getItemValue("relation"),f}function i(){function t(){e.obj?alasql("SELECT * INTO XLSX('"+o.table_name+".xlsx',{headers:true}) FROM ?",[e.items[0]._obj]):alasql("SELECT * INTO XLSX('"+o.table_name+".xlsx',{headers:true}) FROM "+o.table_name)}r();var n={meta:{},items:{}},i=n.items[o.class_name]=[];f.meta&&(n.meta[o.class_name]=o.metadata()),f.format=="json"?(e.obj?i.push(e.items[0]._obj):o.each(function(t){(f.range=="all"||e.items.indexOf(t.ref)!=-1)&&i.push(t._obj)}),e.items.length&&!i.length?o.get(e.items[0],!0).then(function(e){i.push(e._obj),alasql.utils.saveFile(o.table_name+".json",JSON.stringify(n,null,4))}):alasql.utils.saveFile(o.table_name+".json",JSON.stringify(n,null,4))):f.format=="xlsx"?window.xlsx?t():$p.load_script("lib/xlsx.core.min.js","script",t):$p.msg.show_not_implemented()}function s(e){return $p.iface.popup.hide(),a.wnd_options(f.wnd),$p.wsql.save_options("data_manager",r()),!0}e&&"string"==typeof e?e={items:e.split(",")}:e||(e={items:[]});var o=this,u=e.pwnd,a,f={name:"export",wnd:{top:130,left:200,width:470,height:300}};t()},$p.iface.wnd_sync=function(){function e(){var e={name:"wnd_sync",wnd:{id:"wnd_sync",top:130,left:200,width:496,height:290,modal:!0,center:!0,caption:$p.msg.long_operation}};n.wnd_sync=$p.iface.dat_blank(null,e.wnd);var t=[{type:"block",name:"form_block_1",list:[{type:"label",name:"form_label_1",label:$p.msg.sync_data},{type:"block",name:"form_block_2",list:[{type:"template",name:"img_long",className:"img_long"},{type:"newcolumn"},{type:"template",name:"text_processed"},{type:"template",name:"text_current"},{type:"template",name:"text_bottom"}]}]},{type:"button",name:"form_button_1",value:$p.msg.sync_break}];n.frm_sync=n.wnd_sync.attachForm(t),n.frm_sync.attachEvent("onButtonClick",function(e){n&&(n.do_break=!0)}),n.frm_sync.setItemValue("text_processed","Подготовка данных"),n.frm_sync.setItemValue("text_bottom","Загружается структура таблиц...")}var t=$p.iface.sync={},n;t.create=function(t){n=t,e()},t.update=function(e){n.frm_sync.setItemValue("text_processed","Обработано элементов: "+n.step*n.step_size+" из "+n.count_all);var t="",r,i=0;for(var s in e){i++;if(i>4)break;t&&(t+="<br />"),r=$p.cat[s].metadata(),t+=(r.list_presentation||r.synonym)+" ("+e[s].length+")"}n.frm_sync.setItemValue("text_current","Текущий запрос: "+n.step+" ("+Math.round(n.step*n.step_size*100/n.count_all)+"%)"),n.frm_sync.setItemValue("text_bottom",t)},t.close=function(){n&&n.wnd_sync&&(n.wnd_sync.close(),delete n.wnd_sync)}},DataManager.prototype.form_obj=function(e,t){function n(){x=$p.iface.w.createWindow(w.class_name,0,0,900,600),x.reflect_change=function(e){e&&E._mixin(e),u(),h()},r()}function r(){x.elmnts={},x.modified=!1,x.setText((S.obj_presentation||S.synonym)+": "+E.presentation),x.centerOnScreen(),x.button("stick").hide(),x.button("park").hide(),x.attachEvent("onClose",g),$p.bind_help(x),x.elmnts.frm_tabs=x.attachTabbar(),x.elmnts.frm_tabs.addTab("tab_header","&nbsp;Реквизиты&nbsp;",null,null,!0),x.elmnts.tabs={tab_header:x.elmnts.frm_tabs.cells("tab_header")};if(!E.is_folder)for(var e in S.tabular_sections){if(e==="extra_fields")continue;E[e]instanceof TabularSection&&c(e)}x.attachEvent("onResizeFinish",function(e){x.elmnts.pg_header.enableAutoHeight(!1,x.elmnts.tabs.tab_header._getHeight()-20,!0)}),x.elmnts.pg_header=x.elmnts.tabs.tab_header.attachPropertyGrid(),x.elmnts.pg_header.setDateFormat("%d.%m.%Y %H:%i"),x.elmnts.pg_header.init(),x.elmnts.pg_header.loadXMLString(w.get_property_grid_xml(null,E),function(){x.elmnts.pg_header.enableAutoHeight(!1,x.elmnts.tabs.tab_header._getHeight()-20,!0),x.elmnts.pg_header.setSizes(),x.elmnts.pg_header.setUserData("","source",{o:E,wnd:x,grid:x.elmnts.pg_header,on_select:$p.iface.pgrid_on_select,grid_on_change:l}),x.elmnts.pg_header.attachEvent("onPropertyChanged",$p.iface.pgrid_on_change),x.elmnts.pg_header.attachEvent("onCheckbox",$p.iface.pgrid_on_checkbox)}),x.elmnts.frm_toolbar=x.attachToolbar(),x.elmnts.frm_toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar_web/"),x.elmnts.frm_toolbar.loadStruct(require("toolbar_obj"),function(){this.addSpacer("btn_unpost"),this.attachEvent("onclick",i),E.hasOwnProperty("posted")?(this.enableItem("btn_post"),this.enableItem("btn_unpost")):(this.hideItem("btn_post"),this.hideItem("btn_unpost"));var e=S.printing_plates;for(var t in e)this.addListOption("bs_print",t,"~","button",e[t]);x.elmnts.vault_pop=new dhtmlXPopup({toolbar:this,id:"btn_files"}),x.elmnts.vault_pop.attachEvent("onShow",o)})}function i(e){e=="btn_save_close"?m("close"):e=="btn_save"?m("save"):e=="btn_add_row"?y():e=="btn_delete_row"?v():e=="btn_go_connection"?s():e.substr(0,4)=="prn_"?w.print(E.ref,e,x):e=="btn_import"?$p.msg.show_not_implemented():e=="btn_export"&&w.export(E.ref)}function s(){$p.msg.show_not_implemented()}function o(){x.elmnts.vault||(x.elmnts.vault=x.elmnts.vault_pop.attachVault(400,250,{uploadUrl:$p.job_prm.hs_url()+"/files/?class_name="+w.class_name+"&ref="+E.ref,buttonClear:!1,autoStart:!0,filesLimit:10}),x.elmnts.vault.conf.wnd=x,x.elmnts.vault.attachEvent("onUploadFile",function(e,t){}),x.elmnts.vault.attachEvent("onBeforeFileAdd",function(e){return e.size<=this.getMaxFileSize()?!0:($p.msg.show_msg({type:"alert-warning",text:$p.msg.file_size+this._readableSize(this.getMaxFileSize()),title:$p.msg.main_title}),!1)}),x.elmnts.vault.attachEvent("onBeforeFileRemove",function(e){return x.elmnts.vault.file_data[e.id].delete_confirmed?!0:(dhtmlx.confirm({title:$p.msg.main_title,text:$p.msg.file_confirm_delete+e.name,cancel:"Отмена",callback:function(t){t&&$p.ajax.post_ex(x.elmnts.vault.actionUrl(e.id,"drop"),"",!0).then(function(t){x.elmnts.vault.file_data[e.id].delete_confirmed=!0,x.elmnts.vault._removeFileFromQueue(e.id)})}}),!1)}))}function u(){for(var e in S.tabular_sections)e!=="extra_fields"&&E[e]instanceof TabularSection&&E[e].sync_grid(x.elmnts["grid_"+name])}function a(e){if(e===undefined)return;var t=w.handle_event(E,"value_change",{field:this.col,value:e,tabular_section:this.tabular_section,grid:x.elmnts["grid_"+this.tabular_section],row:this.row,wnd:x});typeof t!="boolean"&&(this.row[this.col]=e,this.cell.setValue(e.presentation))}function f(e,t,n,r,i){if(e!=2||r==i)return!0;var s=this.getUserData("","source"),o=E[s.tabular_section].get(t-1),u=s.fields[n],a=w.handle_event(E,"value_change",{field:u,value:r,tabular_section:s.tabular_section,grid:this,row:o,cell:this.cells(t,n),wnd:x});return typeof a!="boolean"&&(o[u]=$p.fetch_type(r,o._metadata.fields[u].type),a=!0),a}function l(e,t){w.handle_event(E,"value_change",{field:e,value:t,tabular_section:"",grid:this,cell:this.cells(),wnd:x})}function c(e){var t={o:E,wnd:x,on_select:a,tabular_section:e};if(!_md.ts_captions(w.class_name,e,t))return;x.elmnts.frm_tabs.addTab("tab_"+e,"&nbsp;"+S.tabular_sections[e].synonym+"&nbsp;"),x.elmnts.tabs["tab_"+e]=x.elmnts.frm_tabs.cells("tab_"+e);var n=x.elmnts["tb_"+e]=x.elmnts.tabs["tab_"+e].attachToolbar();n.setIconsPath(dhtmlx.image_path+"dhxtoolbar_web/"),n.loadStruct(require("toolbar_add_del"),function(){this.attachEvent("onclick",i)});var r=x.elmnts["grid_"+e]=x.elmnts.tabs["tab_"+e].attachGrid();r.setIconsPath(dhtmlx.image_path),r.setImagePath(dhtmlx.image_path),r.setHeader(t.headers),t.min_widths&&r.setInitWidths(t.widths),t.min_widths&&r.setColumnMinWidth(t.min_widths),t.aligns&&r.setColAlign(t.aligns),r.setColSorting(t.sortings),r.setColTypes(t.types),r.setColumnIds(t.fields.join(",")),r.enableAutoWidth(!0,1200,600),r.enableEditTabOnly(!0),r.init(),r.setUserData("","source",t),r.attachEvent("onEditCell",f),E[e].sync_grid(r)}function h(){function e(e){if(typeof e=="string"){var t=E[e];if(t!=undefined)$p.is_data_obj(t)?this.cells(e,1).setValue(t.presentation):t instanceof Date?this.cells(e,1).setValue($p.dateFormat(t,"")):this.cells(e,1).setValue(t);else if(e.indexOf("extra_fields")>-1)var n=E.extra_fields.find(e.split("|")[1])}}x.elmnts.pg_header.forEachRow(function(t){e.call(x.elmnts.pg_header,t)})}function p(){var e=E.production.add({qty:1,quantity:1,discount_percent_internal:$p.wsql.get_user_param("discount","number")});return u(),x.elmnts.detales_grid.selectRowById(e.row),e}function d(){var e=x.elmnts.detales_grid.getSelectedRowId();if(e&&!isNaN(Number(e)))return Number(e)-1;$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1","Продукция"),title:S.obj_presentation+": "+E.presentation})}function v(){var e=d(),t;if(e==undefined)return;t=E.production.get(e)}function m(e){function t(){}t(),e=="close"&&x.close()}function g(e){return x.elmnts.vault&&x.elmnts.vault.unload(),x.elmnts.vault_pop&&x.elmnts.vault_pop.unload(),!0}function y(){var e=p(),t,n=x.elmnts.detales_grid;n.selectCell(e.row-1,n.getColIndexById("nom"),!1,!0,!0),t=n.cells(),t.edit(),t.open_selection()}var b=require("wnd/wnd_"+this.class_name.replace(".","_")+"_obj");if(b)return b($p,e,t);var w=this,E=t.o,S=w.metadata(),x;$p.is_data_obj(E)?n():(e.progressOn(),w.get(t.hasOwnProperty("ref")?t.ref:t,!0).then(function(t){E=t,t=null,e.progressOff(),n()}).catch(function(t){e.progressOff(),console.log(t)}))},DataManager.prototype.form_selection=function(e,t){function n(){e instanceof dhtmlXLayoutCell?(v=e,v.showHeader(),v.close=function(){(v||e).detachToolbar(),(v||e).detachStatusBar(),(v||e).detachObject(!0),a()}):(v=$p.iface.w.createWindow("wnd_"+h.class_name.replace(".","_")+"_select",0,0,900,600),v.centerOnScreen(),v.setModal(1),v.button("park").hide(),v.button("minmax").show(),v.button("minmax").enable(),v.attachEvent("onClose",f)),$p.bind_help(v),v.setText("Список "+(h.class_name.indexOf("doc.")==-1?'справочника "':'документов "')+(p.list_presentation||p.synonym)+'"'),dhtmlxEvent(document.body,"keydown",r),v.elmnts={status_bar:v.attachStatusBar()},v.elmnts.status_bar.setText("<div id='"+h.class_name.replace(".","_")+"_select_recinfoArea'></div>"),v.elmnts.toolbar=v.attachToolbar(),v.elmnts.toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar_web/"),v.elmnts.toolbar.loadStruct(require("toolbar_selection"),function(){this.attachEvent("onclick",o),v.elmnts.filter=new $p.iface.Toolbar_filter({manager:h,toolbar:this,onchange:i}),!e.on_select&&$p.iface.docs.getViewName&&$p.iface.docs.getViewName()=="oper"?(this.hideItem("btn_select"),this.hideItem("sep1"),this.addListOption("bs_more","btn_order_list","~","button","Список заказов","tb_autocad.png"),this.addListOption("bs_more","btn_import","~","button","Загрузить из файла","document_load.png"),this.addListOption("bs_more","btn_export","~","button","Выгрузить в файл","document_save.png")):(this.disableItem("btn_new"),this.disableItem("btn_edit"),this.disableItem("btn_delete")),s()})}function r(e){if(v&&(e.keyCode==113||e.keyCode==115))return setTimeout(function(){v.elmnts.filter.input_filter.focus()},0),$p.cancel_bubble(e)}function i(e){d&&(e.filter?v.elmnts.cell_tree.collapse():v.elmnts.cell_tree.expand()),v.elmnts.grid.reload()}function s(){var e,t,n,r,i,s;d?(e=v.attachLayout("2U"),n=e.cells("b"),n.hideHeader(),i=v.elmnts.grid=n.attachGrid(),t=v.elmnts.cell_tree=e.cells("a"),t.setWidth("220"),t.hideHeader(),t.setCollapsedText("Дерево"),r=v.elmnts.tree=t.attachTree(),r.setImagePath(dhtmlx.image_path+"dhxtree_web/"),r.setIconsPath(dhtmlx.image_path+"dhxtree_web/"),r.enableKeyboardNavigation(!0),r.attachEvent("onSelect",function(){this.do_not_reload?delete this.do_not_reload:i.reload()}),$p.cat.load_soap_to_grid({action:"get_tree",class_name:h.class_name},v.elmnts.tree,function(){setTimeout(function(){i.reload()},20)})):(n=v,i=v.elmnts.grid=v.attachGrid(),setTimeout(function(){i.reload()},20)),i.setIconsPath(dhtmlx.image_path),i.setImagePath(dhtmlx.image_path),i.setPagingWTMode(!0,!0,!0,[20,30,60]),i.enablePaging(!0,30,8,h.class_name.replace(".","_")+"_select_recinfoArea"),i.setPagingSkin("toolbar",dhtmlx.skin),i.attachEvent("onBeforeSorting",c),i.attachEvent("onBeforePageChanged",function(){return!!this.getRowsNum()}),i.attachEvent("onXLE",function(){n.progressOff()}),i.attachEvent("onXLS",function(){n.progressOn()}),i.attachEvent("onDynXLS",function(e,t){var n=l(e,t);if(!n)return;return $p.cat.load_soap_to_grid(n,i),!1}),i.attachEvent("onRowDblClicked",function(e,t){var n=null;r&&(n=r.getIndexById(e)),n!=null?r.selectItem(e,!0):u(e)}),$p.iface.docs.getViewName&&$p.iface.docs.getViewName()=="oper"&&i.enableMultiselect(!0),i.reload=function(){var e=l();if(!e)return;n.progressOn(),i.clearAll(),$p.cat.load_soap_to_grid(e,i,function(t){if(typeof t=="object")$p.msg.check_soap_result(t);else if(!s){if(e.initial_value){var o=t.indexOf("set_parent"),u=t.indexOf("'>",o),a=t.substr(o+12,u-o-12);$p.is_guid(a)&&d&&(r.do_not_reload=!0,r.selectItem(a,!1)),i.selectRowById(e.initial_value)}else e.parent&&$p.is_guid(e.parent)&&d&&(r.do_not_reload=!0,r.selectItem(e.parent,!1));i.setColumnMinWidth(200,i.getColIndexById("presentation")),i.enableAutoWidth(!0,1200,600),i.setSizes(),s=!0,v.elmnts.filter.input_filter.focus()}g&&s&&i.setSortImgState(!0,m,g),n.progressOff()})}}function o(e){if(e=="btn_select")u();else if(e=="btn_new")$p.msg.show_not_implemented();else if(e=="btn_edit"){var t=v.elmnts.grid.getSelectedRowId();t?$p.iface.set_hash(h.class_name,t):$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",""),title:$p.msg.main_title})}else e=="btn_order_list"?$p.iface.set_hash("","","","def"):e=="btn_delete"?$p.msg.show_not_implemented():e=="btn_import"?$p.msg.show_not_implemented():e=="btn_export"?h.export(v.elmnts.grid.getSelectedRowId()):e=="btn_requery"&&v.elmnts.grid.reload()}function u(t){t||(t=v.elmnts.grid.getSelectedRowId());if(v.elmnts.tree&&v.elmnts.tree.getIndexById(t)!=null){v.elmnts.tree.selectItem(t,!0);return}if(t&&e.on_select){var n=h.get(t);v.close(),e.on_select.call(e.grid||e,n)}}function a(){h=null,v=null,p=null,y=null,document.body.removeEventListener("keydown",r)}function f(t){return setTimeout(a,10),e.on_unload&&e.on_unload.call(e.grid||e),!0}function l(e,n){var r=v.elmnts.filter.get_filter()._mixin({action:"get_selection",class_name:h.class_name,order_by:m,direction:g,start:e||((v.elmnts.grid.currentPage||1)-1)*v.elmnts.grid.rowsBufferOutSize,count:n||v.elmnts.grid.rowsBufferOutSize,get_header:y.get_header==undefined})._mixin(t),i=d?v.elmnts.tree.getSelectedItemId():null;r.parent=(i||t.parent)&&!r.filter?i||t.parent:null,d&&!r.parent&&(r.parent=$p.blank.guid);for(var s in r)if(y[s]!=r[s])return y=r,r}function c(e){var t=v.elmnts.grid.getSortingState();return m=e,g=t[1]=="des"?"asc":"des",v.elmnts.grid.reload(),!0}var h=this,p=h.metadata(),d=p.hierarchical&&!(h instanceof ChartOfAccountManager),v,m=0,g="asc",y={};return d&&t.initial_value&&t.initial_value!=$p.blank.guid&&!t.parent?h.get(t.initial_value,!0).then(function(e){t.parent=e.parent.ref,t.set_parent=t.parent,n()}):n(),v},DataManager.prototype.form_list=function(e,t){return this.form_selection(e,t)},window&&function(e){var t=$p.eve,n=$p.iface,r=$p.msg,i={},s=!1,o;t.set_offline=function(e){var t=$p.job_prm.offline;$p.job_prm.offline=!!e||!!$p.wsql.get_user_param("offline","boolean"),t!=$p.job_prm["offline"]&&(t=$p.job_prm.offline)},e.addEventListener("online",t.set_offline),e.addEventListener("offline",function(){t.set_offline(!0)}),e.addEventListener("load",function(){function u(){$p.ajax.authorized||(t.redirect=!0,location.reload(!0))}function a(e){!i.wnd_appcache&&$p.iface.appcache?$p.iface.appcache.create(i):s||(s=!0,setTimeout(u,25e3)),$p.iface.appcache&&(i.loaded=e.loaded||0,i.total=e.total||140,$p.iface.appcache.update()),i.do_break&&($p.iface.appcache.close(),setTimeout(u,1e3))}$p.job_prm=new JobPrm,navigator.geolocation&&$p.job_prm.use_google_geo&&($p.ipinfo=new function(){function e(){this.geocode=function(e){return Promise.resolve(!1)}}var t,n,r="";this._define("yageocoder",{get:function(){return t||(t=new e),t},enumerable:!1,configurable:!1}),this._define("ggeocoder",{get:function(){return n},enumerable:!1,configurable:!1}),this._define("addr",{get:function(){return r},enumerable:!0,configurable:!1}),this.location_callback=function(){n=new google.maps.Geocoder,navigator.geolocation.getCurrentPosition(function(e){$p.ipinfo.latitude=e.coords.latitude,$p.ipinfo.longitude=e.coords.longitude;var t=new google.maps.LatLng($p.ipinfo.latitude,$p.ipinfo.longitude);n.geocode({latLng:t},function(e,t){t==google.maps.GeocoderStatus.OK&&(!e[1]||e[0].address_components.length>=e[1].address_components.length?r=e[0].formatted_address:r=e[1].formatted_address)})},function(e){e&&($p.ipinfo.err=e.message)},{timeout:3e4})}},!window.google||!window.google.maps?$p.eve.onload.push(function(){setTimeout(function(){$p.load_script(location.protocol+"//maps.google.com/maps/api/js?sensor=false&callback=$p.ipinfo.location_callback","script",function(){})},100)}):location_callback()),"dhtmlx"in e&&($p.iface.w=new dhtmlXWindows,$p.iface.w.setSkin(dhtmlx.skin));if($p.job_prm.check_browser_compatibility&&(!e.JSON||!e.indexedDB||!e.localStorage)){t.redirect=!0,r.show_msg({type:"alert-error",text:r.unsupported_browser,title:r.unsupported_browser_title}),setTimeout(function(){location.replace(r.store_url_od)},6e3);return}if($p.job_prm.check_app_installed&&e.chrome&&e.chrome.app&&!e.chrome.app.isInstalled&&!location.hostname.match(/.local/)){t.redirect=!0,r.show_msg({type:"alert-error",text:r.unsupported_mode,title:r.unsupported_mode_title}),setTimeout(function(){location.replace(r.store_url_od)},6e3);return}setTimeout(function(){$p.wsql.init_params(function(){t.set_offline(!navigator.onLine),t.update_files_version();if(document.documentElement.webkitRequestFullScreen&&navigator.userAgent.match(/Android|iPhone|iPad|iPod/i)){function i(){document.documentElement.webkitRequestFullScreen(),e.removeEventListener("touchstart",i)}e.addEventListener("touchstart",i,!1)}if($p.job_prm.use_builder||$p.job_prm.use_wrapper)$p.wrapper=document.getElementById("owb_wrapper"),$p.risdiv=document.getElementById("risdiv"),$p.ft=document.getElementById("msgfooter"),$p.ft&&($p.ft.style.display="none");t.onload.forEach(function(e){typeof e=="function"&&e()}),document&&document.querySelector("#splash")&&document.querySelector("#splash").parentNode.removeChild(document.querySelector("#splash")),$p.job_prm.use_builder&&$p.ft?dhtmlxEvent($p.ft,"click",function(e){$p.cancel_bubble(e),e.qualifier=="ready"?n.oninit():$p.eve.builder_click&&$p.eve.builder_click(e)}):setTimeout(n.oninit,100);if(o=e.applicationCache)o.addEventListener("noupdate",function(e){},!1),o.addEventListener("cached",function(e){s=!0,$p.iface.appcache&&$p.iface.appcache.close()},!1),o.addEventListener("downloading",a,!1),o.addEventListener("progress",a,!1),o.addEventListener("updateready",function(e){try{o.swapCache(),$p.iface.appcache&&$p.iface.appcache.close()}catch(e){}u()},!1),o.addEventListener("error",function(t){!!e.JSON&&!!e.openDatabase&&typeof e.openDatabase=="function"&&r.show_msg({type:"alert-error",text:t.message||r.unknown_error,title:r.error_critical})},!1)})},100)},!1),e.onbeforeunload=function(){if(!t.redirect)return r.onbeforeunload},e.addEventListener("popstat",$p.iface.hash_route),e.addEventListener("hashchange",$p.iface.hash_route)}(window),$p.eve.steps={load_meta:0,authorization:1,create_managers:2,process_access:3,load_data_files:4,load_data_db:5,load_data_wsql:6,save_data_wsql:7},$p.eve.stepper={step:0,count_all:0,cat_date:0,step_size:57,files:0,cat_ini_date:$p.wsql.get_user_param("cache_cat_date","number")||0},$p.eve.ontimer=function(){$p.eve.update_files_version()},setInterval($p.eve.ontimer,18e4),$p.eve.update_files_version=function(){$p.job_prm.files_date||($p.job_prm.files_date=$p.wsql.get_user_param("files_date","number"));if($p.job_prm.offline||!$p.job_prm.data_url)return;$p.ajax.get($p.job_prm.data_url+"sync.json?v="+Date.now()).then(function(e){var t=JSON.parse(e.response);!$p.job_prm.confirmation&&$p.job_prm.files_date!=t.files_date&&($p.wsql.set_user_param("files_date",t.files_date),$p.job_prm.confirmation=!0,dhtmlx.confirm({title:$p.msg.file_new_date_title,text:$p.msg.file_new_date,ok:"Перезагрузка",cancel:"Продолжить",callback:function(e){delete $p.job_prm.confirmation,e&&($p.eve.redirect=!0,location.reload(!0))}}))}).catch(function(e){console.log(e)})},$p.eve.pop=function(e){function t(e){return _load({action:"get_cachable_portion",cache_cat_date:r,step_size:$p.eve.stepper.step_size,step:e||0})}function n(e){$p.eve.stepper.cat_ini_date>$p.wsql.get_user_param("cache_cat_date","number")&&$p.wsql.set_user_param("cache_cat_date",$p.eve.stepper.cat_ini_date),e&&setTimeout(function(){$p.eve.pop(!0)},1e4)}var r=$p.eve.stepper.cat_ini_date;return $p.job_prm.offline?Promise.resolve(!1):$p.job_prm.rest?Promise.resolve(!1):t().then(function(t){return $p.eve.from_json_to_data_obj(t,e)}).then(function(r){if(r)return t(1).then(function(t){return $p.eve.from_json_to_data_obj(t,e)}).then(function(e){n(e)});n(r)})},$p.eve.push=function(){},$p.eve.from_json_to_data_obj=function(e){var t=$p.eve.stepper,n;typeof e=="string"?e=JSON.parse(e):e instanceof XMLHttpRequest&&(e.response?e=JSON.parse(e.response):e={});if(t.do_break)$p.iface.sync.close(),$p.eve.redirect=!0,location.reload(!0);else if(e.cat_date||e.force){e.cat_date>t.cat_ini_date&&(t.cat_ini_date=e.cat_date),e.cat_date>t.cat_date&&(t.cat_date=e.cat_date),e.count_all&&(t.count_all=e.count_all),e.current&&(t.current=e.current);for(n in e.cch)_cch[n].load_array(e.cch[n]);for(n in e.cacc)_cacc[n].load_array(e.cacc[n]);for(n in e.cat)_cat[n].load_array(e.cat[n]);for(n in e.doc)_doc[n].load_array(e.doc[n]);for(n in e.ireg)_ireg[n].load_array(e.ireg[n]);for(n in e.areg)_areg[n].load_array(e.areg[n]);return e.current&&e.current>=t.step_size}},$p.eve.reduce_promices=function(e){return e.reduce(function(e,t){return e.then(function(){return t}).then($p.eve.from_json_to_data_obj)},Promise.resolve())},$p.eve.log_in=function(e){var t=$p.eve.stepper,n,r=$p.job_prm.data_url||"/data/";return e($p.eve.steps.load_meta),$p.ajax.get(r+"meta.json?v="+$p.job_prm.files_date).then(function(t){return e($p.eve.steps.create_managers),$p.ajax.get(r+"meta_patch.json?v="+$p.job_prm.files_date).then(function(e){return new Meta(t,e)}).catch(function(){return new Meta(t,rep)})}).then(function(n){return e($p.eve.steps.authorization),$p.job_prm.offline?n:$p.job_prm.rest?$p.ajax.get_ex($p.job_prm.rest_url()+"?$format=json",!0):_load({action:"get_meta",cache_md_date:$p.wsql.get_user_param("cache_md_date","number"),cache_cat_date:t.cat_ini_date,now_js:Date.now(),margin:$p.wsql.get_user_param("margin","number"),ipinfo:$p.ipinfo.hasOwnProperty("latitude")?JSON.stringify($p.ipinfo):""})}).catch(function(e){throw $p.iface.auth.onerror&&$p.iface.auth.onerror(e),e}).then(function(t){e($p.eve.steps.load_data_files);if($p.job_prm.offline)return t;$p.ajax.authorized=!0,typeof t=="string"&&(t=JSON.parse(t));if($p.msg.check_soap_result(t))return;return $p.wsql.get_user_param("enable_save_pwd")?$p.wsql.set_user_param("user_pwd",$p.ajax.password):$p.wsql.get_user_param("user_pwd")&&$p.wsql.set_user_param("user_pwd",""),$p.wsql.set_user_param("time_diff",t["now_1с"]-t.now_js),t.cat&&t.cat.clrs&&(_md.get("cat.clrs").predefined.white.ref=t.cat.clrs.predefined.white.ref),t.cat&&t.cat.bases&&(_md.get("cat.bases").predefined.main.ref=t.cat.bases.predefined.main.ref),t}).then(function(e){return n=e,t.zone=($p.job_prm.demo?"1":$p.wsql.get_user_param("zone"))+"/",$p.ajax.get(r+"zones/"+t.zone+"p_0.json?v="+$p.job_prm.files_date)}).then(function(e){var n=JSON.parse(e.response);t.files=n.files-1,t.step_size=n.files>0?Math.round(n.count_all/n.files):57,t.cat_ini_date=n.cat_date,$p.eve.from_json_to_data_obj(n)}).then(function(){var e=[];for(var n=1;n<=t.files;n++)e.push($p.ajax.get(r+"zones/"+t.zone+"p_"+n+".json?v="+$p.job_prm.files_date));return e.push($p.ajax.get(r+"zones/"+t.zone+"ireg.json?v="+$p.job_prm.files_date)),$p.eve.reduce_promices(e)}).then(function(n){return e($p.eve.steps.load_data_db),t.step_size=57,$p.eve.pop()}).then(function(){n.access&&(n.access.force=!0,$p.eve.from_json_to_data_obj(n.access)),_md.printing_plates(n.printing_plates),$p.ajax.root=!!n.root}).then(function(){e($p.eve.steps.save_data_wsql)})}},filesaver:function(e,t,n){var r=r||function(e){"use strict";if(typeof navigator!="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent))return;var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in r,s=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},o=e.webkitRequestFileSystem,u=e.requestFileSystem||o||e.mozRequestFileSystem,a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},f="application/octet-stream",l=0,c=500,h=function(t){var r=function(){typeof t=="string"?n().revokeObjectURL(t):t.remove()};e.chrome?r():setTimeout(r,c)},p=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i=="function")try{i.call(e,n||e)}catch(s){a(s)}}},d=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["﻿",e],{type:e.type}):e},v=function(t,a){t=d(t);var c=this,v=t.type,m=!1,g,y,b=function(){p(c,"writestart progress write writeend".split(" "))},w=function(){if(m||!g)g=n().createObjectURL(t);if(y)y.location.href=g;else{var r=e.open(g,"_blank");r==undefined&&typeof safari!="undefined"&&(e.location.href=g)}c.readyState=c.DONE,b(),h(g)},E=function(e){return function(){if(c.readyState!==c.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1},x;c.readyState=c.INIT,a||(a="download");if(i){g=n().createObjectURL(t),r.href=g,r.download=a,s(r),c.readyState=c.DONE,b(),h(g);return}e.chrome&&v&&v!==f&&(x=t.slice||t.webkitSlice,t=x.call(t,0,t.size,f),m=!0),o&&a!=="download"&&(a+=".download");if(v===f||o)y=e;if(!u){w();return}l+=t.size,u(e.TEMPORARY,l,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(a,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){y.location.href=e.toURL(),c.readyState=c.DONE,p(c,"writeend",t),h(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=c["on"+e]}),n.write(t),c.abort=function(){n.abort(),c.readyState=c.DONE},c.readyState=c.WRITING}),w)}),w)};e.getFile(a,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():w()}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};return typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob?function(e,t){return navigator.msSaveOrOpenBlob(d(e),t)}:(m.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,g)}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof n!="undefined"&&n.exports?n.exports.saveAs=r:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return r})},form_auth:'<?xml version="1.0" encoding="UTF-8"?>\n<items>\n	<item type="settings" position="label-left" labelWidth="150" inputWidth="230" noteWidth="230"/>\n	<item type="fieldset" name="data" inputWidth="auto" label="Авторизация">\n\n        <item type="radio" name="type" labelWidth="auto" position="label-right" checked="true" value="guest" label="Гостевой (демо) режим">\n            <item type="select" name="guest" label="Роль">\n                <option value="Дилер" label="Дилер"/>\n            </item>\n        </item>\n\n		<item type="radio" name="type" labelWidth="auto" position="label-right" value="auth" label="Есть учетная запись">\n			<item type="input" value="" name="login" label="Имя пользователя" validate="NotEmpty" />\n			<item type="password" value="" name="password" label="Пароль" validate="NotEmpty" />\n		</item>\n\n		<item type="button" value="Войти" name="submit"/>\n\n        <item type="template" name="text_options" className="order_dealer_options" inputWidth="231"\n              value="&lt;a href=\'#\' onclick=\'$p.iface.open_settings();\' &gt; &lt;img src=\'/imgs/dhxtoolbar_web/tb_settings.png\' align=\'top\' /&gt; Настройки &lt;/a&gt; &lt;img src=\'/imgs/dhxtoolbar_web/blank9.png\' align=\'top\' /&gt; &lt;a href=\'//www.oknosoft.ru/feedback\' target=\'_blank\' &gt; &lt;img src=\'/imgs/dhxtoolbar_web/cloud-question.png\' align=\'top\' /&gt; Задать вопрос &lt;/a&gt;"  />\n\n	</item>\n</items>\n',toolbar_add_del:'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item type="button" id="btn_add"    text="Добавить" title="Добавить строку" img="tb_new.png"  />\r\n    <item type="button" id="btn_delete" text="Удалить"  title="Удалить строку" img="tb_delete.png"   imgdis="tb_delete_dis.png" />\r\n</toolbar>',toolbar_obj:'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item type="button" id="btn_save_close" text="Записать и закрыть" img="save.gif" imgdis="" title="Рассчитать, записать и закрыть" />\r\n    <item type="button" id="btn_save" text="Записать" img="tb_calculate.png" title="Рассчитать и записать данные"/>\r\n    <item type="button" id="btn_post" img="tb_post.png" imgdis="tb_post.png" enabled="false" title="Провести документ" />\r\n    <item type="button" id="btn_unpost" img="tb_unpost.png" imgdis="tb_unpost.png" enabled="false" title="Отмена проведения" />\r\n\r\n    <item type="button" id="btn_files" text="Файлы" img="tb_screpka.png" imgdis="tb_screpka_dis.png" title="Присоединенные файлы"/>\r\n\r\n    <item type="buttonSelect" id="bs_create_by_virtue" text="Создать" title="Создать на основании" openAll="true" >\r\n        <item type="button" id="btn_message" enabled="false" text="Сообщение" image="" />\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_go_to" text="Перейти" title="" openAll="true" >\r\n        <item type="button" id="btn_go_connection" enabled="false" text="Связи" />\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_print"         img="print.gif"         text="Печать" openAll="true">\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"        img="tb_more_w.png"  title="Дополнительно" openAll="true">\r\n        <item type="button" id="btn_import" img="document_load.png" text="Загрузить из файла" />\r\n        <item type="button" id="btn_export" img="document_save.png" text="Выгрузить в файл" />\r\n    </item>\r\n\r\n</toolbar>\r\n',toolbar_ok_cancel:'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="btn_ok"       type="button"   img=""  imgdis=""   text="&lt;b&gt;Ок&lt;/b&gt;"  />\r\n    <item id="btn_cancel"   type="button"	img=""  imgdis=""   text="Отмена" />\r\n</toolbar>',toolbar_selection:'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="btn_select"   type="button"   img=""              imgdis=""               title="Выбрать элемент списка" text="&lt;b&gt;Выбрать&lt;/b&gt;"  />\r\n\r\n    <item id="sep1" type="separator"/>\r\n    <item id="btn_new"      type="button"	img="tb_new.png"	imgdis="tb_new_dis.png"	title="Создать" />\r\n    <item id="btn_edit"     type="button"	img="tb_edit.png"	imgdis="tb_edit_dis.png"	title="Изменить" />\r\n    <item id="btn_delete"   type="button"	img="tb_delete.png"	imgdis="tb_delete_dis.png"	title="Удалить" />\r\n    <item id="sep2" type="separator"/>\r\n\r\n    <item type="buttonSelect"   id="bs_more"        img="tb_more_w.png"     title="Дополнительно" openAll="true">\r\n\r\n    </item>\r\n\r\n</toolbar>'},{},{})